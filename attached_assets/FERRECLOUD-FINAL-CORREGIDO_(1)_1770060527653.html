<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bruzzone ERP - Sistema Completo</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: #f8f9fa; color: #333; }
        
        .sidebar {
            width: 280px; background: #1e293b; height: 100vh;
            position: fixed; left: 0; top: 0; color: white;
            overflow-y: auto; box-shadow: 5px 0 30px rgba(0,0,0,0.3);
        }
        
        .sidebar-header {
            padding: 25px 20px; border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex; align-items: center; gap: 12px;
        }
        
        .logo {
            width: 45px; height: 45px; background: #ff6b35;
            border-radius: 12px; display: flex; align-items: center;
            justify-content: center; font-size: 24px;
        }
        
        .brand-text { font-size: 22px; font-weight: 700; }
        
        .accesos-rapidos {
            padding: 20px; border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .accesos-title {
            font-size: 11px; color: #94a3b8; text-transform: uppercase;
            letter-spacing: 1px; font-weight: 600; margin-bottom: 15px;
        }
        
        .accesos-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
        }
        
        .acceso-item {
            aspect-ratio: 1; background: rgba(255,255,255,0.05);
            border-radius: 12px; display: flex; align-items: center;
            justify-content: center; font-size: 20px; cursor: pointer;
            transition: all 0.3s; border: 1px solid transparent;
        }
        
        .acceso-item:hover {
            background: rgba(255,255,255,0.1);
            border-color: rgba(255,255,255,0.2);
        }
        
        .menu-section {
            padding: 20px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .section-header {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 12px; cursor: pointer; border-radius: 8px;
            transition: background 0.3s; margin-bottom: 5px;
        }
        
        .section-header:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .section-title {
            font-size: 11px; color: #94a3b8; text-transform: uppercase;
            letter-spacing: 1px; font-weight: 700; display: flex;
            align-items: center; gap: 8px;
        }
        
        .section-icon { font-size: 14px; }
        .chevron { font-size: 12px; transition: transform 0.3s; }
        .section-header.collapsed .chevron { transform: rotate(-90deg); }
        
        .menu-items {
            display: flex; flex-direction: column; gap: 2px;
            max-height: 500px; overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .menu-items.hidden { max-height: 0; }
        
        .menu-item {
            display: flex; align-items: center; gap: 12px;
            padding: 12px 16px; color: #cbd5e1; cursor: pointer;
            transition: all 0.3s; border-radius: 8px; font-size: 14px;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.08); color: white;
        }
        
        .menu-item.active {
            background: #ff6b35; color: white;
            box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }
        
        .menu-item-icon { font-size: 18px; }
        
        .menu-item.destacado {
            background: #ff6b35; color: white;
            font-weight: 600; box-shadow: 0 4px 12px rgba(255, 107, 53, 0.4);
        }
        
        .main-content { margin-left: 280px; min-height: 100vh; }
        
        .topbar {
            background: white; padding: 25px 40px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 100;
        }
        
        .topbar-title { font-size: 32px; font-weight: 800; color: #1a1f2e; }
        
        .sync-badge {
            display: flex; align-items: center; gap: 10px;
            padding: 10px 20px; background: #dcfce7;
            color: #059669; border-radius: 12px; font-size: 13px;
            font-weight: 700; text-transform: uppercase;
        }
        
        .content { padding: 40px; }
        
        .card {
            background: white; border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); margin-bottom: 30px;
        }
        
        .card-header {
            padding: 25px 30px; border-bottom: 1px solid #f3f4f6;
            display: flex; align-items: center; justify-content: space-between;
        }
        
        .card-title { font-size: 22px; font-weight: 700; }
        .card-body { padding: 30px; }
        
        .btn-primary {
            padding: 12px 24px; background: linear-gradient(135deg, #ff6b35 0%, #ff8c42 100%);
            color: white; border: none; border-radius: 12px; font-weight: 700;
            cursor: pointer; transition: all 0.3s; font-size: 14px;
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }
        
        .btn-primary:hover { transform: translateY(-2px); }
        
        table { width: 100%; border-collapse: collapse; }
        thead { background: #f8f9fa; }
        th {
            padding: 15px; text-align: left; font-weight: 700;
            font-size: 12px; color: #6b7280; text-transform: uppercase;
        }
        td { padding: 15px; border-top: 1px solid #f3f4f6; }
        tbody tr:hover { background: #fafafa; }
        
        .input-field {
            width: 100%; padding: 14px 18px; border: 2px solid #f3f4f6;
            border-radius: 12px; font-size: 15px; margin-bottom: 20px;
        }
        
        .input-field:focus {
            outline: none; border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        .badge {
            display: inline-block; padding: 4px 10px; border-radius: 8px;
            font-size: 12px; font-weight: 600; background: #f3f4f6;
        }
        
        .btn-action {
            padding: 6px 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            color: white;
            font-weight: 600;
        }
        
        .btn-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }
        
        .tab-producto {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            font-weight: 600;
            color: #6b7280;
        }
        
        .tab-producto:hover {
            background: #e5e7eb;
        }
        
        .tab-producto.active {
            background: #ff6b35;
            color: white;
        }
        
        .tab-content-producto {
            display: none;
        }
        
        .tab-content-producto.active {
            display: block;
        }
        
        /* Switch Toggle */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            flex-shrink: 0;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #cbd5e1;
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #ff6b35;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .modal {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%; background: rgba(0,0,0,0.7);
            z-index: 10000; align-items: center; justify-content: center;
        }
        
        .modal.show { display: flex; }
        
        .modal-content {
            background: white; padding: 40px; border-radius: 20px;
            width: 90%; max-width: 500px;
        }
        
        #resultadosBusqueda table {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        #buscadorProducto {
            font-size: 16px;
            font-weight: 500;
        }
        
        #buscadorProducto:focus {
            border-color: #ff6b35;
            box-shadow: 0 0 0 4px rgba(255, 107, 53, 0.15);
        }
        
        .opcion-precio {
            padding: 20px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: white;
        }
        
        .opcion-precio:hover {
            border-color: #ff6b35;
            background: #fff7f5;
        }
        
        .opcion-precio.selected {
            border-color: #ff6b35;
            background: #fff7f5;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        .radio-custom {
            width: 24px;
            height: 24px;
            border: 2px solid #cbd5e1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
        }
        
        .opcion-precio.selected .radio-custom {
            border-color: #ff6b35;
            background: #ff6b35;
        }
        
        .radio-custom input[type="radio"] {
            display: none;
        }
        
        .opcion-precio.selected .radio-custom::after {
            content: '‚úì';
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        
        .tab-config {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            font-size: 14px;
            color: #6b7280;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab-config:hover {
            color: #ff6b35;
            background: #fff7f5;
        }
        
        .tab-config.active {
            color: #ff6b35;
            border-bottom-color: #ff6b35;
            background: #fff7f5;
        }
        
        .config-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .config-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Wizard de Importaci√≥n */
        .import-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            position: relative;
            z-index: 1;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: white;
            border: 2px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #9ca3af;
            transition: all 0.3s;
        }
        
        .import-step.active .step-number {
            background: #ff6b35;
            border-color: #ff6b35;
            color: white;
        }
        
        .import-step.completed .step-number {
            background: #059669;
            border-color: #059669;
            color: white;
        }
        
        .step-label {
            font-size: 11px;
            font-weight: 600;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .import-step.active .step-label {
            color: #ff6b35;
        }
        
        .import-content {
            display: none;
        }
        
        .import-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        .import-type-card {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .import-type-card:hover {
            border-color: #ff6b35;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(255, 107, 53, 0.15);
        }
        
        .icon-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .type-title {
            font-weight: 700;
            font-size: 16px;
            margin-bottom: 8px;
            color: #1a1f2e;
        }
        
        .type-description {
            font-size: 13px;
            color: #6b7280;
        }
    

.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 28px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #cbd5e1;
    transition: .3s;
    border-radius: 28px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 22px;
    width: 22px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .3s;
    border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
    background-color: #3b82f6;
}

.toggle-switch input:checked + .toggle-slider:before {
    transform: translateX(22px);
}

</style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">üîß</div>
            <div class="brand-text">Sistemas Nova</div>
        </div>
        
        <!-- Accesos R√°pidos -->
        <div class="accesos-rapidos">
            <div class="accesos-title">ACCESOS R√ÅPIDOS</div>
            <div class="accesos-grid">
                <div class="acceso-item" title="Nuevo">üí∞</div>
                <div class="acceso-item" title="Productos">üì¶</div>
                <div class="acceso-item" title="Pagos">üí≥</div>
                <div class="acceso-item" title="Agregar">‚ûï</div>
            </div>
        </div>
        
        <!-- PRINCIPAL -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">üè†</span>
                    PRINCIPAL
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="cargarModulo('dashboard')">
                    <span class="menu-item-icon">üìä</span>
                    <span>Dashboard</span>
                </div>
            </div>
        </div>
        
        <!-- COMERCIAL -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">üíº</span>
                    COMERCIAL
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item active" onclick="cargarModulo('ventas')">
                    <span class="menu-item-icon">üí∞</span>
                    <span>Ventas</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('remitos')">
                    <span class="menu-item-icon">üìã</span>
                    <span>Remitos</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('cotizaciones')">
                    <span class="menu-item-icon">üí¨</span>
                    <span>Cotizaciones</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('pedidos')">
                    <span class="menu-item-icon">üìù</span>
                    <span>Pedidos</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('clientes')">
                    <span class="menu-item-icon">üë•</span>
                    <span>Clientes</span>
                </div>
                <div class="menu-item destacado" onclick="cargarModulo('fidelizacion')">
                    <span class="menu-item-icon">üéÅ</span>
                    <span>Fidelizaci√≥n</span>
                </div>
            </div>
        </div>
        
        <!-- E-COMMERCE -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">üåê</span>
                    E-COMMERCE
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="cargarModulo('ecommerce')">
                    <span class="menu-item-icon">üõí</span>
                    <span>Tienda Online</span>
                </div>
            </div>
        </div>
        
        <!-- PRODUCTOS & ABASTECIMIENTO -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">üì¶</span>
                    PRODUCTOS & ABASTECIMIENTO
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="cargarModulo('inventario')">
                    <span class="menu-item-icon">üì¶</span>
                    <span>Inventario</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('faltantes')">
                    <span class="menu-item-icon">‚ö†Ô∏è</span>
                    <span>Faltantes</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('ajuste-stock')">
                    <span class="menu-item-icon">‚ûï</span>
                    <span>Ajuste de Stock</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('modificacion-masiva')">
                    <span class="menu-item-icon">üìä</span>
                    <span>Modificaci√≥n Masiva</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('deposito')">
                    <span class="menu-item-icon">üè¢</span>
                    <span>Dep√≥sito</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('sucursales')">
                    <span class="menu-item-icon">üè™</span>
                    <span>Sucursales</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('pedidos-compra')">
                    <span class="menu-item-icon">üìù</span>
                    <span>Pedidos Compra</span>
                </div>
            </div>
        </div>
        
        <!-- PROVEEDORES -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">üöö</span>
                    PROVEEDORES
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="cargarModulo('proveedores')">
                    <span class="menu-item-icon">üöö</span>
                    <span>Proveedores</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('compras')">
                    <span class="menu-item-icon">ü§ñ</span>
                    <span>Compras con IA</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('lista-precios')">
                    <span class="menu-item-icon">üí≤</span>
                    <span>Lista Precios</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('importar-datos')">
                    <span class="menu-item-icon">üì•</span>
                    <span>Importar Datos</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('marcas-rubros')">
                    <span class="menu-item-icon">üè∑Ô∏è</span>
                    <span>Marcas & Rubros</span>
                </div>
            </div>
        </div>
        
        <!-- ADMINISTRACI√ìN & FINANZAS -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">üíº</span>
                    ADMINISTRACI√ìN & FINANZAS
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="cargarModulo('cajas-pagos')">
                    <span class="menu-item-icon">üíµ</span>
                    <span>Cajas y Pagos</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('saldos-deudas')">
                    <span class="menu-item-icon">‚öñÔ∏è</span>
                    <span>Saldos y Deudas</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('cuotas-internas')">
                    <span class="menu-item-icon">üí≥</span>
                    <span>Cuotas Internas</span>
                </div>
            </div>
        </div>
        
        <!-- FINANZAS -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">üìà</span>
                    FINANZAS
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="cargarModulo('finanzas')">
                    <span class="menu-item-icon">üìà</span>
                    <span>Finanzas</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('informes-iva')">
                    <span class="menu-item-icon">üìä</span>
                    <span>Informes e IVA</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('contabilidad')">
                    <span class="menu-item-icon">üìö</span>
                    <span>Contabilidad</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('comprobantes')">
                    <span class="menu-item-icon">üìÑ</span>
                    <span>Comprobantes</span>
                </div>
            </div>
        </div>
        
        <!-- SISTEMA -->
        <div class="menu-section">
            <div class="section-header" onclick="toggleSection(this)">
                <div class="section-title">
                    <span class="section-icon">‚öôÔ∏è</span>
                    SISTEMA
                </div>
                <span class="chevron">‚ñº</span>
            </div>
            <div class="menu-items">
                <div class="menu-item" onclick="cargarModulo('personal-accesos')">
                    <span class="menu-item-icon">üë§</span>
                    <span>Personal y Accesos</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('configuracion')">
                    <span class="menu-item-icon">‚öôÔ∏è</span>
                    <span>Configuraci√≥n</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('importar-datos')">
                    <span class="menu-item-icon">üì•</span>
                    <span>Importar Datos</span>
                </div>
                <div class="menu-item" onclick="cargarModulo('integraciones')">
                    <span class="menu-item-icon">üîå</span>
                    <span>Integraciones</span>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="topbar">
            <h2 class="topbar-title" id="tituloModulo">Ventas</h2>
            <div class="sync-badge">
                <span style="width: 8px; height: 8px; background: #059669; border-radius: 50%;"></span>
                <span>Sincronizado</span>
            </div>
        </div>
        <div class="content" id="contenido"></div>
    </div>

    <!-- Modal Producto R√°pido -->
    <div id="modalProductoRapido" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 25px;">‚ûï Agregar Producto R√°pido</h3>
            <input type="text" id="codigo" class="input-field" placeholder="C√≥digo">
            <input type="text" id="nombre" class="input-field" placeholder="Nombre">
            <input type="text" id="marca" class="input-field" placeholder="Marca">
            <input type="number" id="precio" class="input-field" placeholder="Precio">
            <input type="number" id="cantidad" class="input-field" placeholder="Cantidad" value="1">
            <button class="btn-primary" onclick="guardarProductoRapido()">Agregar</button>
            <button class="btn-primary" style="background: #6b7280; margin-left: 10px;" onclick="cerrarModal()">Cancelar</button>
        </div>
    </div>

    <!-- Modal Pedido -->
    <div id="modalPedido" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 25px;">üì¶ Generar Pedido</h3>
            <select class="input-field">
                <option>Seleccionar Proveedor</option>
                <option>Proveedor 1</option>
                <option>Proveedor 2</option>
            </select>
            <textarea class="input-field" rows="6" placeholder="Detalle..."></textarea>
            <button class="btn-primary" onclick="alert('Pedido generado!'); cerrarModalPedido()">Generar</button>
            <button class="btn-primary" style="background: #6b7280; margin-left: 10px;" onclick="cerrarModalPedido()">Cancelar</button>
        </div>
    </div>

    <!-- Modal Editar Item de Venta -->
    <div id="modalEditarItem" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 25px;">‚úèÔ∏è Editar Producto</h3>
            <input type="hidden" id="editIndex">
            <div class="input-field" style="background: #f3f4f6; font-weight: 600; cursor: not-allowed;" disabled>
                C√≥digo: <span id="editCodigo"></span>
            </div>
            <input type="text" id="editNombre" class="input-field" placeholder="Nombre">
            <input type="text" id="editMarca" class="input-field" placeholder="Marca">
            <input type="number" id="editPrecio" class="input-field" placeholder="Precio" step="any">
            <button class="btn-primary" onclick="guardarEdicionItem()">üíæ Guardar Cambios</button>
            <button class="btn-primary" style="background: #6b7280; margin-left: 10px;" onclick="cerrarModalEditarItem()">Cancelar</button>
        </div>
    </div>

    <!-- Modal Formulario Producto Completo -->
    <div id="modalFormularioProducto" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
            <h3 style="margin-bottom: 25px; padding-bottom: 15px; border-bottom: 2px solid #f3f4f6;">
                üì¶ Nuevo Producto
            </h3>
            
            <div style="display: flex; gap: 20px; flex: 1; overflow: hidden;">
                <!-- Men√∫ lateral de pesta√±as -->
                <div style="width: 200px; flex-shrink: 0;">
                    <div class="tab-producto active" onclick="cambiarTabProducto('general')" data-tab="general">
                        <span style="font-size: 18px;">‚öôÔ∏è</span>
                        <span>GENERAL</span>
                    </div>
                    <div class="tab-producto" onclick="cambiarTabProducto('costos')" data-tab="costos">
                        <span style="font-size: 18px;">üí≤</span>
                        <span>COSTOS Y PRECIOS</span>
                    </div>
                    <div class="tab-producto" onclick="cambiarTabProducto('inventario')" data-tab="inventario">
                        <span style="font-size: 18px;">üì¶</span>
                        <span>INVENTARIO F√çSICO</span>
                    </div>
                    <div class="tab-producto" onclick="cambiarTabProducto('fraccionada')" data-tab="fraccionada">
                        <span style="font-size: 18px;">üî¢</span>
                        <span>VENTA FRACCIONADA</span>
                    </div>
                    <div class="tab-producto" onclick="cambiarTabProducto('ecommerce')" data-tab="ecommerce">
                        <span style="font-size: 18px;">üåê</span>
                        <span>E-COMMERCE</span>
                    </div>
                </div>
                
                <!-- Contenido de las pesta√±as -->
                <div style="flex: 1; overflow-y: auto; padding-right: 10px;">
                    <!-- GENERAL -->
                    <div id="tab-general" class="tab-content-producto active">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üìã DATOS GENERALES</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    NOMBRE DEL PRODUCTO *
                                </label>
                                <input type="text" id="formNombre" class="input-field" placeholder="Ej: Martillo Stanley 20oz" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    SKU / C√ìDIGO INTERNO *
                                </label>
                                <input type="text" id="formCodigo" class="input-field" placeholder="Ej: MST-20Z" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    UNIDAD PRIMARIA (STOCK) *
                                </label>
                                <select id="formUnidadStock" class="input-field" style="margin: 0;">
                                    <option>Unidad</option>
                                    <option>Caja</option>
                                    <option>Paquete</option>
                                    <option>Metro</option>
                                    <option>Kilo</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    UNIDAD DE VENTA *
                                </label>
                                <select id="formUnidadVenta" class="input-field" style="margin: 0;">
                                    <option>Unidad</option>
                                    <option>Caja</option>
                                    <option>Paquete</option>
                                    <option>Metro</option>
                                    <option>Kilo</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    CATEGOR√çA / RUBRO
                                </label>
                                <input type="text" id="formCategoria" class="input-field" placeholder="Ej: Herramientas Manuales" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    MARCA
                                </label>
                                <input type="text" id="formMarca" class="input-field" placeholder="Ej: Stanley" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    C√ìD. PROVEEDOR
                                </label>
                                <input type="text" id="formCodProveedor" class="input-field" placeholder="Ej: ST201-M" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    MONEDA DE VENTA
                                </label>
                                <select id="formMoneda" class="input-field" style="margin: 0;">
                                    <option>ARS - Pesos Argentinos</option>
                                    <option>USD - D√≥lares</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 10px;">
                                üñºÔ∏è IMAGEN DEL PRODUCTO
                            </label>
                            <div style="border: 2px dashed #e5e7eb; border-radius: 12px; padding: 40px; text-align: center; background: #fafafa;">
                                <div style="font-size: 48px; margin-bottom: 10px;">üì∑</div>
                                <button class="btn-primary" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);">
                                    ‚¨ÜÔ∏è SUBIR IMAGEN
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- COSTOS Y PRECIOS -->
                    <div id="tab-costos" class="tab-content-producto">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üí≤ ESTRUCTURA DE COSTOS Y PRECIOS</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    COSTO BASE UNITARIO ($) *
                                </label>
                                <input type="number" id="formCosto" class="input-field" placeholder="0.00" step="any" style="margin: 0;" onchange="calcularPrecioFinal()">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    IVA (%)
                                </label>
                                <input type="number" id="formIva" class="input-field" placeholder="21" value="21" style="margin: 0;" onchange="calcularPrecioFinal()">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    GANANCIA (MARKUP %)
                                </label>
                                <input type="number" id="formGanancia" class="input-field" placeholder="30" value="30" style="margin: 0;" onchange="calcularPrecioFinal()">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    PROVEEDOR PRINCIPAL
                                </label>
                                <select id="formProveedor" class="input-field" style="margin: 0;">
                                    <option>Ninguno</option>
                                    <option>Proveedor 1</option>
                                    <option>Proveedor 2</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; background: #1e293b; padding: 30px; border-radius: 12px; text-align: center;">
                            <div style="font-size: 14px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px;">
                                PRECIO FINAL SUGERIDO
                            </div>
                            <div style="font-size: 48px; font-weight: 800; color: #ff6b35;" id="precioFinalSugerido">
                                $0,00
                            </div>
                        </div>
                    </div>
                    
                    <!-- INVENTARIO F√çSICO -->
                    <div id="tab-inventario" class="tab-content-producto">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üì¶ DETALLES DE INVENTARIO</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    STOCK ACTUAL
                                </label>
                                <input type="number" id="formStock" class="input-field" placeholder="0" value="0" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    M√çNIMO DE ALERTA
                                </label>
                                <input type="number" id="formStockMin" class="input-field" placeholder="5" value="5" style="margin: 0;">
                            </div>
                            
                            <div style="grid-column: 1 / -1;">
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    UBICACI√ìN
                                </label>
                                <input type="text" id="formUbicacion" class="input-field" placeholder="Ej: A-05" style="margin: 0;">
                            </div>
                        </div>
                    </div>
                    
                    <!-- VENTA FRACCIONADA -->
                    <div id="tab-fraccionada" class="tab-content-producto">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üî¢ VENTA FRACCIONADA</h4>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 15px;">
                            <label class="switch">
                                <input type="checkbox" id="formFraccionada">
                                <span class="slider"></span>
                            </label>
                            <div>
                                <div style="font-weight: 600; font-size: 16px; margin-bottom: 5px;">HABILITAR FRACCIONADO</div>
                                <div style="font-size: 13px; color: #6b7280;">Permite vender en una unidad distinta al stock.</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- E-COMMERCE -->
                    <div id="tab-ecommerce" class="tab-content-producto">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üåê E-COMMERCE</h4>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 15px;">
                            <label class="switch">
                                <input type="checkbox" id="formPublicarOnline">
                                <span class="slider"></span>
                            </label>
                            <div>
                                <div style="font-weight: 600; font-size: 16px; margin-bottom: 5px;">PUBLICAR ONLINE</div>
                                <div style="font-size: 13px; color: #6b7280;">El producto ser√° visible en tu tienda online.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botones de acci√≥n -->
            <div style="border-top: 2px solid #f3f4f6; padding-top: 20px; margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-primary" style="background: #6b7280;" onclick="cerrarFormularioProducto()">CANCELAR</button>
                <button class="btn-primary" onclick="guardarProducto()">üíæ GUARDAR</button>
            </div>
        </div>
    </div>

    <script>
        const productos = [
            { codigo: 'T001', nombre: 'Tornillo 1/4"', marca: 'Fischer', stock: 150, precio: 25 },
            { codigo: 'P002', nombre: 'Pinza Universal 8"', marca: 'Stanley', stock: 25, precio: 890 },
            { codigo: 'M003', nombre: 'Martillo Carpintero', marca: 'Bahco', stock: 5, precio: 1450 },
            { codigo: 'P004', nombre: 'Pintura Latex 20L', marca: 'Alba', stock: 45, precio: 23900 }
        ];

        const clientes = [
            { 
                id: 1, 
                nombre: 'Juan P√©rez', 
                cuit: '20-12345678-9',
                tipo: 'Consumidor Final',
                telefono: '3516789012',
                whatsapp: '3516789012',
                email: 'juan.perez@email.com',
                direccion: 'Av. Col√≥n 1234, C√≥rdoba',
                condicion: 'Cuenta Corriente',
                limiteCredito: 500000,
                saldo: -15000,
                descuentoEspecial: 10,
                listaPreciosEspecial: 'Lista Mayorista',
                autorizados: [
                    { nombre: 'Mar√≠a P√©rez', dni: '33445566', telefono: '3517890123' }
                ],
                activo: true
            },
            { 
                id: 2, 
                nombre: 'Mar√≠a Garc√≠a', 
                cuit: '27-98765432-1',
                tipo: 'Monotributista',
                telefono: '3517890123',
                whatsapp: '3517890123',
                email: 'maria.garcia@email.com',
                direccion: 'San Mart√≠n 567, C√≥rdoba',
                condicion: 'Contado',
                limiteCredito: 0,
                saldo: 0,
                descuentoEspecial: 0,
                listaPreciosEspecial: null,
                autorizados: [],
                activo: true
            },
            { 
                id: 3, 
                nombre: 'Construcciones SA', 
                cuit: '30-55555555-5',
                tipo: 'Responsable Inscripto',
                telefono: '3518901234',
                whatsapp: '3518901234',
                email: 'ventas@construccionessa.com',
                direccion: 'Ruta 9 Km 5, C√≥rdoba',
                condicion: 'Cuenta Corriente',
                limiteCredito: 2000000,
                saldo: -450000,
                descuentoEspecial: 15,
                listaPreciosEspecial: 'Lista Constructoras',
                autorizados: [
                    { nombre: 'Roberto G√≥mez', dni: '22334455', telefono: '3519012345' },
                    { nombre: 'Laura Mart√≠nez', dni: '44556677', telefono: '3519012346' }
                ],
                activo: true
            },
            { 
                id: 4, 
                nombre: 'Roberto L√≥pez', 
                cuit: '20-11223344-5',
                tipo: 'Consumidor Final',
                telefono: '3519012345',
                whatsapp: '3519012345',
                email: 'roberto.lopez@email.com',
                direccion: 'Belgrano 890, C√≥rdoba',
                condicion: 'Contado',
                limiteCredito: 0,
                saldo: 25000,
                descuentoEspecial: 5,
                listaPreciosEspecial: null,
                autorizados: [],
                activo: true
            }
        ];

        // Cajas del sistema
        const cajas = [
            {
                id: 1,
                nombre: 'Caja Colch√≥n',
                tipo: 'efectivo',
                saldo: 0,
                responsable: 'Sistema',
                sucursal: 'Casa Central',
                activa: true,
                icono: 'üíµ'
            },
            {
                id: 2,
                nombre: 'Caja Administrativa',
                tipo: 'efectivo',
                saldo: 0,
                responsable: 'Sistema',
                sucursal: 'Casa Central',
                activa: true,
                icono: 'üíº'
            },
            {
                id: 3,
                nombre: 'Banco Naci√≥n',
                tipo: 'banco',
                saldo: 0,
                responsable: 'Sistema',
                sucursal: 'Casa Central',
                activa: true,
                icono: 'üè¶'
            },
            {
                id: 4,
                nombre: 'Mercado Pago',
                tipo: 'digital',
                saldo: 0,
                responsable: 'Sistema',
                sucursal: 'Casa Central',
                activa: true,
                icono: 'üí≥'
            }
        ];

        // Categor√≠as de gastos
        const categoriasGastos = [
            { id: 1, nombre: 'Sueldos', tipo: 'fijo', icono: 'üë•', color: '#3b82f6' },
            { id: 2, nombre: 'Alquileres', tipo: 'fijo', icono: 'üè¢', color: '#8b5cf6' },
            { id: 3, nombre: 'Servicios', tipo: 'fijo', icono: '‚ö°', color: '#f59e0b' },
            { id: 4, nombre: 'Impuestos', tipo: 'fijo', icono: 'üìã', color: '#ef4444' },
            { id: 5, nombre: 'Compras', tipo: 'variable', icono: 'üõí', color: '#10b981' },
            { id: 6, nombre: 'Mantenimiento', tipo: 'variable', icono: 'üîß', color: '#6366f1' },
            { id: 7, nombre: 'Marketing', tipo: 'variable', icono: 'üì¢', color: '#ec4899' },
            { id: 8, nombre: 'Otros', tipo: 'variable', icono: 'üì¶', color: '#64748b' }
        ];

        // Variable de caja activa
        let cajaActiva = 1;

        // Movimientos de cuenta corriente (ejemplo)
        const movimientosCuentaCorriente = [
            { id: 1, clienteId: 1, fecha: '2026-01-15', tipo: 'Factura', nro: 'FAC-0001', detalle: 'Venta productos', debe: 15000, haber: 0, saldo: -15000 },
            { id: 2, clienteId: 3, fecha: '2026-01-10', tipo: 'Factura', nro: 'FAC-0002', detalle: 'Venta construcci√≥n', debe: 500000, haber: 0, saldo: -500000 },
            { id: 3, clienteId: 3, fecha: '2026-01-20', tipo: 'Recibo', nro: 'REC-0001', detalle: 'Pago efectivo', debe: 0, haber: 50000, saldo: -450000 },
            { id: 4, clienteId: 4, fecha: '2026-01-25', tipo: 'Nota de Cr√©dito', nro: 'NC-0001', detalle: 'Devoluci√≥n productos', debe: 0, haber: 25000, saldo: 25000 }
        ];

        // Formas de pago configurables
        const formasPago = [
            { 
                id: 1, 
                nombre: 'Efectivo', 
                activa: true, 
                recargo: 0, 
                tipoRecargo: 'porcentaje', // 'porcentaje' o 'fijo'
                permiteCuotas: false,
                cuotas: []
            },
            { 
                id: 2, 
                nombre: 'Transferencia', 
                activa: true, 
                recargo: 0, 
                tipoRecargo: 'porcentaje',
                permiteCuotas: false,
                cuotas: []
            },
            { 
                id: 3, 
                nombre: 'Tarjeta D√©bito', 
                activa: true, 
                recargo: 3, 
                tipoRecargo: 'porcentaje',
                permiteCuotas: false,
                cuotas: []
            },
            { 
                id: 4, 
                nombre: 'Tarjeta Cr√©dito', 
                activa: true, 
                recargo: 5, 
                tipoRecargo: 'porcentaje',
                permiteCuotas: true,
                cuotas: [
                    { cantidad: 3, interes: 10, descripcion: '3 cuotas - 10% inter√©s' },
                    { cantidad: 6, interes: 20, descripcion: '6 cuotas - 20% inter√©s' },
                    { cantidad: 12, interes: 35, descripcion: '12 cuotas - 35% inter√©s' }
                ]
            },
            { 
                id: 5, 
                nombre: 'Mercado Pago', 
                activa: true, 
                recargo: 4, 
                tipoRecargo: 'porcentaje',
                permiteCuotas: false,
                cuotas: []
            },
            { 
                id: 6, 
                nombre: 'Cheque', 
                activa: true, 
                recargo: 0, 
                tipoRecargo: 'porcentaje',
                permiteCuotas: false,
                cuotas: []
            }
        ];

        // Configuraci√≥n de impresi√≥n de comprobantes
        const tiposComprobantes = [
            {
                id: 1,
                nombre: 'Factura A',
                activo: true,
                impresora: 'Impresora L√°ser',
                tamanioPapel: 'A4',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: true,
                incluirCAE: true,
                incluirDetalleItems: true,
                incluirObservaciones: true,
                copias: 2,
                abrirCajon: true
            },
            {
                id: 2,
                nombre: 'Factura B',
                activo: true,
                impresora: 'Impresora L√°ser',
                tamanioPapel: 'A4',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: true,
                incluirCAE: true,
                incluirDetalleItems: true,
                incluirObservaciones: true,
                copias: 2,
                abrirCajon: true
            },
            {
                id: 3,
                nombre: 'Factura C',
                activo: true,
                impresora: 'Impresora L√°ser',
                tamanioPapel: 'A4',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: false,
                incluirCAE: true,
                incluirDetalleItems: true,
                incluirObservaciones: true,
                copias: 1,
                abrirCajon: true
            },
            {
                id: 4,
                nombre: 'Remito',
                activo: true,
                impresora: 'Impresora T√©rmica',
                tamanioPapel: 'Ticket 80mm',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: false,
                incluirCAE: false,
                incluirDetalleItems: true,
                incluirObservaciones: true,
                copias: 2,
                abrirCajon: false
            },
            {
                id: 5,
                nombre: 'Recibo',
                activo: true,
                impresora: 'Impresora T√©rmica',
                tamanioPapel: 'Ticket 80mm',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: false,
                incluirCAE: false,
                incluirDetalleItems: false,
                incluirObservaciones: true,
                copias: 1,
                abrirCajon: true
            },
            {
                id: 6,
                nombre: 'Presupuesto',
                activo: true,
                impresora: 'Impresora L√°ser',
                tamanioPapel: 'A4',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: false,
                incluirCAE: false,
                incluirDetalleItems: true,
                incluirObservaciones: true,
                copias: 1,
                abrirCajon: false
            },
            {
                id: 7,
                nombre: 'Nota de Cr√©dito',
                activo: true,
                impresora: 'Impresora L√°ser',
                tamanioPapel: 'A4',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: true,
                incluirCAE: true,
                incluirDetalleItems: true,
                incluirObservaciones: true,
                copias: 2,
                abrirCajon: false
            },
            {
                id: 8,
                nombre: 'Nota de D√©bito',
                activo: true,
                impresora: 'Impresora L√°ser',
                tamanioPapel: 'A4',
                orientacion: 'vertical',
                incluirLogo: true,
                incluirQR: true,
                incluirCAE: true,
                incluirDetalleItems: true,
                incluirObservaciones: true,
                copias: 2,
                abrirCajon: false
            }
        ];

        const remitos = [
            { id: 'R-001', fecha: '2026-01-25', cliente: 'Juan P√©rez', items: [{codigo: 'T001', nombre: 'Tornillo 1/4"', marca: 'Fischer', cantidad: 50, precio: 25}], total: 1250, facturado: false, nroFactura: null },
            { id: 'R-002', fecha: '2026-01-26', cliente: 'Mar√≠a Garc√≠a', items: [{codigo: 'P002', nombre: 'Pinza Universal 8"', marca: 'Stanley', cantidad: 10, precio: 890}], total: 8900, facturado: false, nroFactura: null },
            { id: 'R-003', fecha: '2026-01-27', cliente: 'Juan P√©rez', items: [{codigo: 'M003', nombre: 'Martillo Carpintero', marca: 'Bahco', cantidad: 5, precio: 1450}], total: 7250, facturado: true, nroFactura: 'FAC-0001' },
            { id: 'R-004', fecha: '2026-01-28', cliente: 'Construcciones SA', items: [{codigo: 'P004', nombre: 'Pintura Latex 20L', marca: 'Alba', cantidad: 20, precio: 23900}], total: 478000, facturado: false, nroFactura: null },
            { id: 'R-005', fecha: '2026-01-29', cliente: 'Mar√≠a Garc√≠a', items: [{codigo: 'T001', nombre: 'Tornillo 1/4"', marca: 'Fischer', cantidad: 100, precio: 25}], total: 2500, facturado: false, nroFactura: null }
        ];

        // ========== VARIABLES M√ìDULOS NUEVOS ==========
        let pestanaRemitosActiva = 'pendientes';
        const preFacturas = [];
        let siguienteIdPreFactura = 1;

        let itemsVenta = [];
        let remitosSeleccionados = [];
        let contadorFacturas = 2; // Empieza en 2 porque FAC-0001 ya existe
        let contadorRecibos = 2; // REC-0001 ya existe
        let contadorNotasCredito = 2;
        let contadorNotasDebito = 1;
        let clienteCtaCorrienteActual = null;

        function toggleSection(header) {
            const items = header.nextElementSibling;
            items.classList.toggle('hidden');
            header.classList.toggle('collapsed');
        }

        function cargarModulo(modulo) {
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            
            // Buscar y activar el men√∫ item correcto
            document.querySelectorAll('.menu-item').forEach(item => {
                const onclick = item.getAttribute('onclick');
                if (onclick && onclick.includes(`'${modulo}'`)) {
                    item.classList.add('active');
                }
            });
            
            const titulos = {
                'dashboard': 'Dashboard',
                'ventas': 'Ventas',
                'remitos': 'Remitos',
                'cotizaciones': 'Cotizaciones',
                'pedidos': 'Pedidos',
                'clientes': 'Clientes',
                'fidelizacion': 'Fidelizaci√≥n',
                'ecommerce': 'E-Commerce',
                'inventario': 'Inventario',
                'faltantes': 'Productos Faltantes',
                'ajuste-stock': 'Ajuste de Stock',
                'modificacion-masiva': 'Modificaci√≥n Masiva',
                'deposito': 'Dep√≥sito',
                'pedidos-compra': 'Pedidos de Compra',
                'proveedores': 'Proveedores',
                'lista-precios': 'Lista de Precios',
                'importar-datos': 'Importar Datos',
                'marcas-rubros': 'Marcas & Rubros',
                'cajas-pagos': 'Cajas y Pagos',
                'saldos-deudas': 'Saldos y Deudas',
                'cuotas-internas': 'Cuotas Internas',
                'finanzas': 'Finanzas',
                'informes-iva': 'Informes e IVA',
                'personal-accesos': 'Personal y Accesos',
                'configuracion': 'Configuraci√≥n',
                'integraciones': 'Integraciones'
            };
            
            document.getElementById('tituloModulo').textContent = titulos[modulo] || modulo;
            
            if (modulo === 'dashboard') {
                document.getElementById('contenido').innerHTML = getDashboardHTML();
            } else if (modulo === 'ventas') {
                document.getElementById('contenido').innerHTML = getVentasHTML();
            } else if (modulo === 'inventario') {
                document.getElementById('contenido').innerHTML = getInventarioHTML();
            } else if (modulo === 'remitos') {
                document.getElementById('contenido').innerHTML = getRemitosHTML();
            } else if (modulo === 'clientes') {
                document.getElementById('contenido').innerHTML = getClientesHTML();
            } else if (modulo === 'configuracion') {
                document.getElementById('contenido').innerHTML = getConfiguracionHTML();
            } else if (modulo === 'importar-datos') {
                document.getElementById('contenido').innerHTML = getImportarDatosHTML();
            } else if (modulo === 'cajas-pagos') {
                document.getElementById('contenido').innerHTML = getCajasPagosHTML();
            } else if (modulo === 'saldos-deudas') {
                document.getElementById('contenido').innerHTML = getSaldosDeudasHTML();
            } else if (modulo === 'cuotas-internas') {
                document.getElementById('contenido').innerHTML = getCuotasInternasHTML();
            } else if (modulo === 'personal-accesos') {
                document.getElementById('contenido').innerHTML = getPersonalAccesosHTML();
            } else if (modulo === 'proveedores') {
                document.getElementById('contenido').innerHTML = getProveedoresHTML();
            } else if (modulo === 'lista-precios') {
                document.getElementById('contenido').innerHTML = getListaPreciosHTML();
            } else if (modulo === 'pedidos-compra') {
                document.getElementById('contenido').innerHTML = getPedidosCompraHTML();
            } else if (modulo === 'informes-iva') {
                document.getElementById('contenido').innerHTML = getInformesHTML();
            } else if (modulo === 'finanzas') {
                document.getElementById('contenido').innerHTML = getFinanzasHTML();
            } else if (modulo === 'sucursales') {
                document.getElementById('contenido').innerHTML = getSucursalesHTML();
            } else if (modulo === 'contabilidad') {
                document.getElementById('contenido').innerHTML = getContabilidadHTML();
            } else if (modulo === 'comprobantes') {
                document.getElementById('contenido').innerHTML = getComprobantesHTML();
            } else if (modulo === 'ecommerce') {
                document.getElementById('contenido').innerHTML = getEcommerceHTML();
            } else if (modulo === 'compras') {
                document.getElementById('contenido').innerHTML = getComprasHTML();
            } else {
                document.getElementById('contenido').innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">${titulos[modulo]}</h3>
                        </div>
                        <div class="card-body">
                            <p style="text-align: center; padding: 60px; color: #999;">
                                M√≥dulo en desarrollo
                            </p>
                        </div>
                    </div>
                `;
            }
        }


        // ==================== DASHBOARD ====================
        function getDashboardHTML() {
            // Calcular m√©tricas
            const remitosPendientes = remitos.filter(r => !r.facturado).length;
            const remitosFacturados = remitos.filter(r => r.facturado).length;
            const totalProductos = productos.length;
            const productosStockBajo = productos.filter(p => p.stock < 10).length;
            const valorInventario = productos.reduce((sum, p) => sum + (p.stock * p.precio), 0);
            const totalEnCajas = cajas.reduce((sum, c) => sum + c.saldo, 0);
            const clientesActivos = clientes.length;
            const preFacturasPendientes = preFacturas.filter(pf => pf.estado === 'Pendiente').length;
            const preFacturasAprobadas = preFacturas.filter(pf => pf.estado === 'Aprobada').length;
            
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 5px;">üìä Dashboard</h2>
                    <p style="color: #6b7280;">Vista general del negocio en tiempo real</p>
                </div>
                
                <!-- M√©tricas Principales -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                    <!-- Remitos por Facturar -->
                    <div class="card" style="border-left: 4px solid #f59e0b; cursor: pointer;" onclick="cargarModulo('remitos')">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">REMITOS POR FACTURAR</div>
                        <div style="font-size: 36px; font-weight: 800; color: #f59e0b; margin-bottom: 5px;">${remitosPendientes}</div>
                        <div style="font-size: 10px; color: #6b7280;">
                            ${remitosPendientes > 0 ? '‚ö†Ô∏è Requieren atenci√≥n' : '‚úÖ Todo facturado'}
                        </div>
                    </div>
                    
                    <!-- Total en Cajas -->
                    <div class="card" style="border-left: 4px solid #10b981; cursor: pointer;" onclick="cargarModulo('cajas-pagos')">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">TOTAL EN CAJAS</div>
                        <div style="font-size: 36px; font-weight: 800; color: #10b981; margin-bottom: 5px;">$${(totalEnCajas/1000).toFixed(0)}K</div>
                        <div style="font-size: 10px; color: #6b7280;">
                            ${cajas.filter(c => c.activa).length} cajas activas
                        </div>
                    </div>
                    
                    <!-- Valor Inventario -->
                    <div class="card" style="border-left: 4px solid #3b82f6; cursor: pointer;" onclick="cargarModulo('inventario')">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">VALOR INVENTARIO</div>
                        <div style="font-size: 36px; font-weight: 800; color: #3b82f6; margin-bottom: 5px;">$${(valorInventario/1000000).toFixed(1)}M</div>
                        <div style="font-size: 10px; color: #6b7280;">
                            ${productosStockBajo > 0 ? `‚ö†Ô∏è ${productosStockBajo} con stock bajo` : '‚úÖ Stock adecuado'}
                        </div>
                    </div>
                    
                    <!-- Clientes Activos -->
                    <div class="card" style="border-left: 4px solid #8b5cf6; cursor: pointer;" onclick="cargarModulo('clientes')">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">CLIENTES ACTIVOS</div>
                        <div style="font-size: 36px; font-weight: 800; color: #8b5cf6; margin-bottom: 5px;">${clientesActivos}</div>
                        <div style="font-size: 10px; color: #6b7280;">
                            ${clientes.filter(c => c.saldo > 0).length} con cuenta corriente
                        </div>
                    </div>
                </div>
                
                <!-- Tareas Pendientes y Accesos R√°pidos -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <!-- Tareas Pendientes -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ö†Ô∏è Tareas Pendientes</h3>
                        </div>
                        <div class="card-body">
                            ${getTareasPendientes()}
                        </div>
                    </div>
                    
                    <!-- Accesos R√°pidos -->
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">‚ö° Accesos R√°pidos</h3>
                        </div>
                        <div class="card-body">
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button class="btn-primary" onclick="cargarModulo('ventas')" style="justify-content: flex-start; padding: 12px 16px;">
                                    üí∞ Nueva Venta
                                </button>
                                <button class="btn-primary" onclick="cambiarPestanaRemitos('agrupar'); cargarModulo('remitos');" style="justify-content: flex-start; padding: 12px 16px; background: #f59e0b;">
                                    üîó Agrupar Remitos
                                </button>
                                <button class="btn-primary" onclick="arquearCajaRapido()" style="justify-content: flex-start; padding: 12px 16px; background: #10b981;">
                                    üíµ Arqueo de Caja
                                </button>
                                <button class="btn-primary" onclick="cargarModulo('inventario')" style="justify-content: flex-start; padding: 12px 16px; background: #3b82f6;">
                                    üì¶ Inventario
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Resumen General -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìà Resumen General</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px;">
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 8px;">TOTAL REMITOS</div>
                                <div style="font-size: 24px; font-weight: 800; color: #1a1f2e;">${remitos.length}</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 8px;">FACTURADOS</div>
                                <div style="font-size: 24px; font-weight: 800; color: #10b981;">${remitosFacturados}</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 8px;">PRE-FACTURAS</div>
                                <div style="font-size: 24px; font-weight: 800; color: #8b5cf6;">${preFacturas.length}</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 8px;">CAJAS ACTIVAS</div>
                                <div style="font-size: 24px; font-weight: 800; color: #3b82f6;">${cajas.filter(c => c.activa).length}</div>
                            </div>
                            <div style="text-align: center; padding: 15px; background: #f9fafb; border-radius: 8px;">
                                <div style="font-size: 10px; color: #6b7280; font-weight: 600; margin-bottom: 8px;">PRODUCTOS</div>
                                <div style="font-size: 24px; font-weight: 800; color: #f59e0b;">${totalProductos}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getTareasPendientes() {
            const tareas = [];
            
            // Remitos por facturar
            const remitosPendientes = remitos.filter(r => !r.facturado).length;
            if (remitosPendientes > 0) {
                tareas.push(`
                    <div style="padding: 15px; background: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 8px; margin-bottom: 10px; cursor: pointer;" onclick="cargarModulo('remitos')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 700; color: #92400e; margin-bottom: 5px;">üì¶ Remitos por Facturar</div>
                                <div style="font-size: 13px; color: #92400e;">Hay ${remitosPendientes} remito${remitosPendientes > 1 ? 's' : ''} pendiente${remitosPendientes > 1 ? 's' : ''} de facturaci√≥n</div>
                            </div>
                            <div style="font-size: 24px; font-weight: 800; color: #f59e0b;">${remitosPendientes}</div>
                        </div>
                    </div>
                `);
            }
            
            // Pre-facturas pendientes
            const preFacturasPendientes = preFacturas.filter(pf => pf.estado === 'Pendiente').length;
            if (preFacturasPendientes > 0) {
                tareas.push(`
                    <div style="padding: 15px; background: #dbeafe; border-left: 4px solid #3b82f6; border-radius: 8px; margin-bottom: 10px; cursor: pointer;" onclick="cambiarPestanaRemitos('prefacturas'); cargarModulo('remitos');">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 700; color: #1e40af; margin-bottom: 5px;">üìÑ Pre-Facturas para Revisar</div>
                                <div style="font-size: 13px; color: #1e40af;">Hay ${preFacturasPendientes} pre-factura${preFacturasPendientes > 1 ? 's' : ''} pendiente${preFacturasPendientes > 1 ? 's' : ''} de aprobaci√≥n</div>
                            </div>
                            <div style="font-size: 24px; font-weight: 800; color: #3b82f6;">${preFacturasPendientes}</div>
                        </div>
                    </div>
                `);
            }
            
            // Stock bajo
            const productosStockBajo = productos.filter(p => p.stock < 10).length;
            if (productosStockBajo > 0) {
                tareas.push(`
                    <div style="padding: 15px; background: #fee2e2; border-left: 4px solid #ef4444; border-radius: 8px; margin-bottom: 10px; cursor: pointer;" onclick="cargarModulo('inventario')">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <div style="font-weight: 700; color: #991b1b; margin-bottom: 5px;">‚ö†Ô∏è Productos con Stock Bajo</div>
                                <div style="font-size: 13px; color: #991b1b;">${productosStockBajo} producto${productosStockBajo > 1 ? 's' : ''} con menos de 10 unidades</div>
                            </div>
                            <div style="font-size: 24px; font-weight: 800; color: #ef4444;">${productosStockBajo}</div>
                        </div>
                    </div>
                `);
            }
            
            // Si no hay tareas pendientes
            if (tareas.length === 0) {
                return `
                    <div style="padding: 40px; text-align: center;">
                        <div style="font-size: 48px; margin-bottom: 15px;">‚úÖ</div>
                        <div style="font-size: 16px; font-weight: 700; color: #10b981; margin-bottom: 8px;">¬°Todo al d√≠a!</div>
                        <div style="font-size: 14px; color: #6b7280;">No hay tareas pendientes en este momento</div>
                    </div>
                `;
            }
            
            return tareas.join('');
        }
        
        function arquearCajaRapido() {
            if (cajas.length === 0) {
                alert('‚ö†Ô∏è No hay cajas configuradas');
                return;
            }
            
            cargarModulo('cajas-pagos');
        }


        function getVentasHTML() {

            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Nueva Venta</h3>
                        <select class="input-field" style="max-width: 200px; margin: 0;">
                            <option>Venta</option>
                            <option>Factura ARCA</option>
                            <option>Remito</option>
                            <option>Presupuesto</option>
                        </select>
                    </div>
                    <div class="card-body">
                        <!-- B√∫squeda de Cliente -->
                        <div style="margin-bottom: 25px; padding: 15px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #3b82f6;">
                            <label style="display: block; font-weight: 700; margin-bottom: 10px; font-size: 14px; color: #1e40af;">üë§ Cliente</label>
                            <div style="display: flex; gap: 10px;">
                                <input type="text" id="buscadorCliente" class="input-field" 
                                    placeholder="üîç Buscar cliente por nombre, tel√©fono o CUIT..." 
                                    style="margin: 0; flex: 1;"
                                    onkeyup="buscarCliente(this.value)">
                                <button class="btn-primary" onclick="agregarClienteRapido()" style="white-space: nowrap;">
                                    ‚ûï Cliente Nuevo
                                </button>
                            </div>
                            <div id="resultadosBusquedaCliente" style="margin-top: 10px;"></div>
                            <div id="clienteSeleccionado" style="margin-top: 10px;"></div>
                        </div>
                        
                        <!-- B√∫squeda de Productos -->
                        <div style="display: flex; gap: 10px; margin-bottom: 25px;">
                            <input type="text" id="buscadorProducto" class="input-field" 
                                placeholder="üîç Buscar producto por c√≥digo, nombre o marca..." 
                                style="margin: 0; flex: 1;"
                                onkeyup="buscarProducto(this.value)">
                            <button class="btn-primary" onclick="abrirModal()" style="white-space: nowrap;">
                                ‚ûï Producto R√°pido
                            </button>
                        </div>
                        
                        <!-- Resultados de b√∫squeda -->
                        <div id="resultadosBusqueda" style="margin-bottom: 25px;"></div>
                        
                        <h4 style="margin: 20px 0 15px 0;">üõí Items de la Venta</h4>
                        <table>
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Producto</th>
                                    <th>Marca</th>
                                    <th>Cant</th>
                                    <th>Precio</th>
                                    <th>Subtotal</th>
                                    <th style="text-align: center;">Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="tablaItems">
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                                        No hay productos agregados
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div style="margin-top: 25px; padding: 20px; background: #f8f9fa; border-radius: 12px;">
                            <div style="display: flex; justify-content: space-between; padding-top: 15px; border-top: 2px solid #ddd;">
                                <span style="font-weight: 800; font-size: 24px; color: #ff6b35;">TOTAL:</span>
                                <span id="total" style="font-weight: 800; font-size: 24px; color: #ff6b35;">$0</span>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px; display: flex; gap: 15px;">
                            <button class="btn-primary" onclick="finalizarVenta()">üí∞ Finalizar Venta</button>
                            <button class="btn-primary" style="background: #6b7280;" onclick="limpiarVenta()">üóëÔ∏è Limpiar</button>
                        </div>
                    </div>
                </div>
            `;
        }


        // ========== FUNCIONES DE VENTAS ==========
        let clienteSeleccionadoVenta = null;
        let carritoVenta = [];
        
        function buscarCliente(texto) {
            const resultadosDiv = document.getElementById('resultadosBusquedaCliente');
            
            if (!texto || texto.length < 2) {
                resultadosDiv.innerHTML = '';
                return;
            }
            
            const textoBusqueda = texto.toLowerCase();
            const resultados = clientes.filter(c => 
                c.nombre.toLowerCase().includes(textoBusqueda) ||
                c.telefono.includes(textoBusqueda) ||
                (c.cuit && c.cuit.includes(textoBusqueda))
            ).slice(0, 5);
            
            if (resultados.length === 0) {
                resultadosDiv.innerHTML = '<div style="padding: 10px; color: #6b7280; font-size: 13px;">No se encontraron clientes</div>';
                return;
            }
            
            resultadosDiv.innerHTML = `
                <div style="max-height: 200px; overflow-y: auto; border: 2px solid #e5e7eb; border-radius: 8px; background: white;">
                    ${resultados.map(c => `
                        <div style="padding: 12px; border-bottom: 1px solid #e5e7eb; cursor: pointer; display: flex; justify-content: space-between; align-items: center;"
                            onmouseover="this.style.background='#f3f4f6'"
                            onmouseout="this.style.background='white'"
                            onclick="seleccionarCliente(${c.id})">
                            <div>
                                <div style="font-weight: 700; font-size: 14px;">${c.nombre}</div>
                                <div style="font-size: 12px; color: #6b7280;">${c.telefono}${c.cuit ? ' ‚Ä¢ ' + c.cuit : ''}</div>
                            </div>
                            <span style="font-size: 20px;">üëâ</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function seleccionarCliente(id) {
            clienteSeleccionadoVenta = clientes.find(c => c.id === id);
            
            if (clienteSeleccionadoVenta) {
                document.getElementById('resultadosBusquedaCliente').innerHTML = '';
                document.getElementById('buscadorCliente').value = clienteSeleccionadoVenta.nombre;
                
                document.getElementById('clienteSeleccionado').innerHTML = `
                    <div style="padding: 12px; background: #dcfce7; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-weight: 700; color: #166534;">‚úÖ ${clienteSeleccionadoVenta.nombre}</div>
                            <div style="font-size: 12px; color: #166534;">${clienteSeleccionadoVenta.telefono}${clienteSeleccionadoVenta.cuit ? ' ‚Ä¢ ' + clienteSeleccionadoVenta.cuit : ''}</div>
                        </div>
                        <button onclick="quitarCliente()" style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 12px;">
                            ‚ùå Quitar
                        </button>
                    </div>
                `;
            }
        }
        
        function quitarCliente() {
            clienteSeleccionadoVenta = null;
            document.getElementById('clienteSeleccionado').innerHTML = '';
            document.getElementById('buscadorCliente').value = '';
        }
        
        function agregarClienteRapido() {
            const nombre = prompt('üë§ NUEVO CLIENTE\n\nNombre completo:', '');
            if (!nombre) return;
            const telefono = prompt('Tel√©fono:', '');
            if (!telefono) return;
            const cuit = prompt('CUIT (opcional):', '');
            const direccion = prompt('Direcci√≥n (opcional):', '');
            clientes.push({id: clientes.length + 1, nombre: nombre, telefono: telefono, cuit: cuit || '', direccion: direccion || '', saldo: 0});
            alert(`‚úÖ CLIENTE CREADO\n\nNombre: ${nombre}\nTel√©fono: ${telefono}${cuit ? '\nCUIT: ' + cuit : ''}`);
            if (moduloActual === 'ventas') { seleccionarCliente(clientes.length); }
        }
        
        function buscarProducto(texto) {
            const resultadosDiv = document.getElementById('resultadosBusqueda');
            
            if (!texto || texto.length < 2) {
                resultadosDiv.innerHTML = '';
                return;
            }
            
            const textoBusqueda = texto.toLowerCase();
            const resultados = productos.filter(p => 
                p.codigo.toLowerCase().includes(textoBusqueda) ||
                p.nombre.toLowerCase().includes(textoBusqueda) ||
                p.marca.toLowerCase().includes(textoBusqueda)
            ).slice(0, 8);
            
            if (resultados.length === 0) {
                resultadosDiv.innerHTML = '<div style="padding: 10px; color: #6b7280; font-size: 13px;">No se encontraron productos</div>';
                return;
            }
            
            resultadosDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px;">
                    ${resultados.map(p => `
                        <div style="padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; cursor: pointer; background: white;"
                            onmouseover="this.style.borderColor='#3b82f6'; this.style.background='#f0f9ff'"
                            onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'"
                            onclick="agregarProductoVenta('${p.codigo}')">
                            <div style="font-weight: 700; font-size: 13px; margin-bottom: 3px;">${p.nombre}</div>
                            <div style="font-size: 11px; color: #6b7280; margin-bottom: 5px;">${p.marca} ‚Ä¢ ${p.codigo}</div>
                            <div style="font-weight: 800; font-size: 16px; color: #10b981;">$${p.precio.toLocaleString()}</div>
                            <div style="font-size: 11px; color: ${p.stock > 10 ? '#10b981' : '#ef4444'}; margin-top: 3px;">Stock: ${p.stock}</div>
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        function agregarProductoVenta(codigo) {
            const producto = productos.find(p => p.codigo === codigo);
            if (!producto) return;
            
            if (producto.stock <= 0) {
                alert('‚ö†Ô∏è SIN STOCK\n\nEste producto no tiene stock disponible');
                return;
            }
            
            // Buscar si ya est√° en el carrito
            const itemExistente = carritoVenta.find(i => i.codigo === codigo);
            
            if (itemExistente) {
                if (itemExistente.cantidad < producto.stock) {
                    itemExistente.cantidad++;
                } else {
                    alert('‚ö†Ô∏è Stock insuficiente');
                    return;
                }
            } else {
                carritoVenta.push({
                    codigo: producto.codigo,
                    nombre: producto.nombre,
                    marca: producto.marca,
                    precio: producto.precio,
                    cantidad: 1,
                    stockDisponible: producto.stock
                });
            }
            
            actualizarTablaVenta();
            document.getElementById('buscadorProducto').value = '';
            document.getElementById('resultadosBusqueda').innerHTML = '';
        }
        
        function actualizarTablaVenta() {
            const tabla = document.getElementById('tablaItems');
            
            if (carritoVenta.length === 0) {
                tabla.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                            No hay productos agregados
                        </td>
                    </tr>
                `;
                document.getElementById('total').textContent = '$0';
                return;
            }
            
            const total = carritoVenta.reduce((sum, item) => sum + (item.cantidad * item.precio), 0);
            
            tabla.innerHTML = carritoVenta.map((item, idx) => `
                <tr>
                    <td style="font-family: monospace; font-weight: 700;">${item.codigo}</td>
                    <td style="font-weight: 600;">${item.nombre}</td>
                    <td>${item.marca}</td>
                    <td>
                        <input type="number" min="1" max="${item.stockDisponible}" value="${item.cantidad}"
                            style="width: 70px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: center; font-weight: 700;"
                            onchange="cambiarCantidad(${idx}, this.value)">
                    </td>
                    <td style="font-weight: 700; font-size: 15px;">$${item.precio.toLocaleString()}</td>
                    <td style="font-weight: 800; font-size: 16px; color: #10b981;">$${(item.cantidad * item.precio).toLocaleString()}</td>
                    <td style="text-align: center;">
                        <button onclick="eliminarItemVenta(${idx})" 
                            style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: 700; font-size: 12px;">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            `).join('');
            
            document.getElementById('total').textContent = '$' + total.toLocaleString();
        }
        
        function cambiarCantidad(idx, cantidad) {
            const cant = parseInt(cantidad);
            if (cant > 0 && cant <= carritoVenta[idx].stockDisponible) {
                carritoVenta[idx].cantidad = cant;
                actualizarTablaVenta();
            }
        }
        
        function eliminarItemVenta(idx) {
            carritoVenta.splice(idx, 1);
            actualizarTablaVenta();
        }
        
        function finalizarVenta() {
            if (carritoVenta.length === 0) {
                alert('‚ö†Ô∏è El carrito est√° vac√≠o');
                return;
            }
            
            const total = carritoVenta.reduce((sum, item) => sum + (item.cantidad * item.precio), 0);
            const cliente = clienteSeleccionadoVenta ? clienteSeleccionadoVenta.nombre : 'Cliente Final';
            
            if (confirm(`üí∞ FINALIZAR VENTA\n\nCliente: ${cliente}\nProductos: ${carritoVenta.length}\nTotal: $${total.toLocaleString()}\n\n¬øConfirmar?`)) {
                alert(`‚úÖ VENTA REGISTRADA\n\nCliente: ${cliente}\nTotal: $${total.toLocaleString()}\n\n¬°Venta guardada correctamente!`);
                
                // Limpiar
                carritoVenta = [];
                clienteSeleccionadoVenta = null;
                cargarModulo('ventas');
            }
        }
        
        function limpiarVenta() {
            if (confirm('¬øLimpiar la venta actual?')) {
                carritoVenta = [];
                clienteSeleccionadoVenta = null;
                cargarModulo('ventas');
            }
        }
        
        function abrirModal() {
            abrirFormularioProducto();
        }


        function getInventarioHTML() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Gesti√≥n de Inventario</h3>
                        <button class="btn-primary" onclick="abrirFormularioProducto()">+ Nuevo Producto</button>
                    </div>
                    <div class="card-body">
                        <input type="text" class="input-field" placeholder="üîç Buscar producto..." style="margin-bottom: 20px;" onkeyup="buscarEnInventario(this.value)">
                        <table>
                            <thead>
                                <tr>
                                    <th>C√≥digo</th>
                                    <th>Nombre</th>
                                    <th>Marca</th>
                                    <th>Categor√≠a</th>
                                    <th>Stock</th>
                                    <th>Precio</th>
                                    <th style="text-align: center;">Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productos.map(p => `
                                    <tr>
                                        <td><code>${p.codigo}</code></td>
                                        <td><strong>${p.nombre}</strong></td>
                                        <td><span class="badge">${p.marca}</span></td>
                                        <td>Herramientas</td>
                                        <td>
                                            <span style="padding: 6px 12px; background: ${p.stock > 10 ? '#dcfce7' : p.stock > 0 ? '#fef3c7' : '#fee2e2'}; color: ${p.stock > 10 ? '#16a34a' : p.stock > 0 ? '#f59e0b' : '#dc2626'}; font-weight: 700; border-radius: 6px; font-size: 12px;">
                                                ${p.stock}
                                            </span>
                                        </td>
                                        <td><strong style="font-size: 15px;">$${p.precio.toLocaleString()}</strong></td>
                                        <td>
                                            <div style="display: flex; gap: 5px; justify-content: center;">
                                                <button class="btn-action btn-info" onclick="editarProductoInventario('${p.codigo}')" title="Editar">‚úèÔ∏è</button>
                                                <button class="btn-action" style="background: #f59e0b; color: white;" onclick="pedirProducto('${p.codigo}')" title="Pedir">üì¶ PEDIR</button>
                                                <button class="btn-action btn-danger" onclick="borrarProducto('${p.codigo}')" title="Borrar">üóëÔ∏è</button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function buscarEnInventario(texto) {
            // B√∫squeda en tiempo real en inventario
            console.log('Buscando:', texto);
        }
        
        function editarProductoInventario(codigo) {
            const producto = productos.find(p => p.codigo === codigo);
            if (!producto) return;
            
            const nuevoNombre = prompt('üìù EDITAR PRODUCTO\n\nNombre:', producto.nombre);
            if (!nuevoNombre) return;
            
            const nuevoPrecio = prompt('üí∞ Precio de venta:', producto.precio);
            if (!nuevoPrecio) return;
            
            const nuevoStock = prompt('üì¶ Stock:', producto.stock);
            if (!nuevoStock) return;
            
            // Actualizar (simulado)
            producto.nombre = nuevoNombre;
            producto.precio = parseFloat(nuevoPrecio);
            producto.stock = parseInt(nuevoStock);
            
            alert(`‚úÖ PRODUCTO ACTUALIZADO\n\nC√≥digo: ${codigo}\nNombre: ${nuevoNombre}\nPrecio: $${nuevoPrecio}\nStock: ${nuevoStock}`);
            
            cargarModulo('inventario');
        }
        
        function pedirProducto(codigo) {
            const producto = productos.find(p => p.codigo === codigo);
            if (!producto) return;
            
            const cantidad = prompt(`üì¶ PEDIR PRODUCTO\n\nProducto: ${producto.nombre}\nStock actual: ${producto.stock}\n\n¬øCu√°ntas unidades quer√©s pedir?`, '50');
            
            if (cantidad && !isNaN(cantidad)) {
                const proveedor = prompt('üè¢ ¬øA qu√© proveedor?', 'Distribuidora Walker');
                
                if (proveedor) {
                    alert(`‚úÖ PEDIDO GENERADO\n\nProducto: ${producto.nombre}\nCantidad: ${cantidad} unidades\nProveedor: ${proveedor}\n\nüìß Se envi√≥ el pedido por email`);
                }
            }
        }
        
        function borrarProducto(codigo) {
            const producto = productos.find(p => p.codigo === codigo);
            if (!producto) return;
            
            if (confirm(`‚ö†Ô∏è ¬øELIMINAR PRODUCTO?\n\n${producto.nombre}\nC√≥digo: ${codigo}\n\nEsta acci√≥n no se puede deshacer.`)) {
                alert('‚úÖ Producto eliminado correctamente');
                // Aqu√≠ ir√≠a la l√≥gica de eliminaci√≥n real
            }
        }
        
// ========== FORM


function abrirFormularioProducto() {
    const modal = document.createElement('div');
    modal.id = 'modalProducto';
    modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;';
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 12px; width: 100%; max-width: 900px; max-height: 90vh; overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.3); display: flex; flex-direction: column;">
            
            <!-- Header -->
            <div style="padding: 20px 25px; border-bottom: 2px solid #e5e7eb; background: #f9fafb;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 700; color: #1f2937;">üì¶ Nuevo Producto</h2>
            </div>
            
            <!-- Body: Sidebar + Content -->
            <div style="display: flex; flex: 1; overflow: hidden;">
                
                <!-- Sidebar -->
                <div style="width: 200px; background: #f9fafb; border-right: 2px solid #e5e7eb; padding: 20px 0; overflow-y: auto;">
                    <div onclick="cambiarPestanaProducto('general')" id="tab-general" 
                        style="padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 600; background: #ff6b35; color: white; border-left: 4px solid #ff6b35;">
                        <span>‚öôÔ∏è</span> GENERAL
                    </div>
                    <div onclick="cambiarPestanaProducto('costos')" id="tab-costos"
                        style="padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 600; color: #6b7280; border-left: 4px solid transparent;">
                        <span>üí≤</span> COSTOS Y PRECIOS
                    </div>
                    <div onclick="cambiarPestanaProducto('inventario')" id="tab-inventario"
                        style="padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 600; color: #6b7280; border-left: 4px solid transparent;">
                        <span>üì¶</span> INVENTARIO F√çSICO
                    </div>
                    <div onclick="cambiarPestanaProducto('fraccionada')" id="tab-fraccionada"
                        style="padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 600; color: #6b7280; border-left: 4px solid transparent;">
                        <span>üî¢</span> VENTA FRACCIONADA
                    </div>
                    <div onclick="cambiarPestanaProducto('ecommerce')" id="tab-ecommerce"
                        style="padding: 12px 20px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 14px; font-weight: 600; color: #6b7280; border-left: 4px solid transparent;">
                        <span>üåê</span> E-COMMERCE
                    </div>
                </div>
                
                <!-- Content -->
                <div style="flex: 1; overflow-y: auto; padding: 25px;">
                    <div id="contenidoPestanaProducto"></div>
                </div>
                
            </div>
            
            <!-- Footer -->
            <div style="padding: 20px 25px; border-top: 2px solid #e5e7eb; background: #f9fafb; display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="cerrarModalProducto()" 
                    style="padding: 12px 28px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 14px;">
                    CANCELAR
                </button>
                <button onclick="guardarProductoNuevo()" 
                    style="padding: 12px 32px; background: #ff6b35; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 14px; box-shadow: 0 4px 12px rgba(255, 107, 53, 0.3);">
                    üíæ GUARDAR
                </button>
            </div>
            
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Cargar primera pesta√±a
    cambiarPestanaProducto('general');
}

let pestanaProductoActiva = 'general';
let datosProductoTemp = {
    nombre: '', sku: '', unidadPrimaria: 'Unidad', unidadVenta: 'Unidad',
    categoria: '', marca: '', codigoProveedor: '', monedaVenta: 'ARS', monedaCompra: 'ARS',
    codigo1: '', codigo2: '', codigo3: '', codigo4: '',
    costoLista: 0, cantidadPorBulto: 1, costoSinIVA: 0, costoConIVA: 0,
    desc1: 0, desc2: 0, desc3: 0, desc4: 0, aplicarDescProveedor: false,
    gananciaMarkup: 60, iva: 21,
    stockActual: 0, minimoAlerta: 5, puntoPedido: 10, ubicacion: '',
    habilitarFraccionado: false, publicarOnline: false,
    proveedorPrincipal: ''
};

function cambiarPestanaProducto(pestana) {
    pestanaProductoActiva = pestana;
    
    // Actualizar sidebar
    ['general', 'costos', 'inventario', 'fraccionada', 'ecommerce'].forEach(p => {
        const tab = document.getElementById('tab-' + p);
        if (p === pestana) {
            tab.style.background = '#ff6b35';
            tab.style.color = 'white';
            tab.style.borderLeft = '4px solid #ff6b35';
        } else {
            tab.style.background = 'transparent';
            tab.style.color = '#6b7280';
            tab.style.borderLeft = '4px solid transparent';
        }
    });
    
    // Cargar contenido
    document.getElementById('contenidoPestanaProducto').innerHTML = getContenidoPestanaProducto();
}

function getContenidoPestanaProducto() {
    switch(pestanaProductoActiva) {
        case 'general': return getPestanaGeneral();
        case 'costos': return getPestanaCostos();
        case 'inventario': return getPestanaInventario();
        case 'fraccionada': return getPestanaFraccionada();
        case 'ecommerce': return getPestanaEcommerce();
    }
}

function getPestanaGeneral() {
    return `
        <div>
            <h3 style="color: #ff6b35; font-size: 16px; font-weight: 700; margin: 0 0 20px 0; display: flex; align-items: center; gap: 8px;">
                üìã DATOS GENERALES
            </h3>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Nombre del producto <span style="color: #ef4444;">*</span>
                    </label>
                    <input type="text" id="nombreProducto" value="${datosProductoTemp.nombre}"
                        placeholder="Ej: Martillo Stanley 20oz"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.nombre = this.value">
                </div>
                
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        SKU / C√≥digo interno <span style="color: #ef4444;">*</span>
                    </label>
                    <input type="text" id="skuProducto" value="${datosProductoTemp.sku}"
                        placeholder="Ej: MST-20Z"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.sku = this.value">
                </div>
            </div>
            
            <!-- C√ìDIGOS ADICIONALES -->
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                    C√≥digos Adicionales
                </label>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                    <input type="text" id="codigo1" value="${datosProductoTemp.codigo1 || ''}"
                        placeholder="C√≥digo 1"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.codigo1 = this.value">
                    <input type="text" id="codigo2" value="${datosProductoTemp.codigo2 || ''}"
                        placeholder="C√≥digo 2"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.codigo2 = this.value">
                    <input type="text" id="codigo3" value="${datosProductoTemp.codigo3 || ''}"
                        placeholder="C√≥digo 3"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.codigo3 = this.value">
                    <input type="text" id="codigo4" value="${datosProductoTemp.codigo4 || ''}"
                        placeholder="C√≥digo 4"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.codigo4 = this.value">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Unidad primaria (stock) <span style="color: #ef4444;">*</span>
                    </label>
                    <select id="unidadPrimaria" 
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.unidadPrimaria = this.value">
                        <option value="Unidad" ${datosProductoTemp.unidadPrimaria === 'Unidad' ? 'selected' : ''}>Unidad</option>
                        <option value="Caja">Caja</option>
                        <option value="Pack">Pack</option>
                        <option value="Metro">Metro</option>
                        <option value="Kilo">Kilo</option>
                        <option value="Litro">Litro</option>
                    </select>
                </div>
                
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Unidad de venta <span style="color: #ef4444;">*</span>
                    </label>
                    <select id="unidadVenta"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.unidadVenta = this.value">
                        <option value="Unidad" ${datosProductoTemp.unidadVenta === 'Unidad' ? 'selected' : ''}>Unidad</option>
                        <option value="Caja">Caja</option>
                        <option value="Pack">Pack</option>
                        <option value="Metro">Metro</option>
                        <option value="Kilo">Kilo</option>
                        <option value="Litro">Litro</option>
                    </select>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Categor√≠a / Rubro
                    </label>
                    <input type="text" id="categoria" value="${datosProductoTemp.categoria}"
                        placeholder="Ej: Herramientas Manuales"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.categoria = this.value">
                </div>
                
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Marca
                    </label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="marca" value="${datosProductoTemp.marca}"
                            placeholder="Ej: Stanley"
                            style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                            onchange="datosProductoTemp.marca = this.value">
                        <button onclick="agregarNuevaMarca()" 
                            style="padding: 10px 16px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; white-space: nowrap;">
                            + Nueva
                        </button>
                    </div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Proveedor Principal
                    </label>
                    <div style="display: flex; gap: 10px;">
                        <select id="proveedorPrincipal"
                            style="flex: 1; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                            onchange="datosProductoTemp.proveedorPrincipal = this.value">
                            <option value="">Ninguno</option>
                            <option value="1">Distribuidora Walker</option>
                            <option value="2">Ferreter√≠a Mayorista SA</option>
                            <option value="3">Importadora ABC</option>
                        </select>
                        <button onclick="agregarNuevoProveedor()" 
                            style="padding: 10px 16px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 700; cursor: pointer; white-space: nowrap;">
                            + Nuevo
                        </button>
                    </div>
                </div>
                
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        C√≥digo proveedor
                    </label>
                    <input type="text" id="codigoProveedor" value="${datosProductoTemp.codigoProveedor}"
                        placeholder="Ej: ST201-M"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.codigoProveedor = this.value">
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Moneda de compra
                    </label>
                    <select id="monedaCompra"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.monedaCompra = this.value">
                        <option value="ARS" selected>ARS - Pesos Argentinos</option>
                        <option value="USD">USD - D√≥lares</option>
                    </select>
                </div>
                
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                        Moneda de venta
                    </label>
                    <select id="monedaVenta"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.monedaVenta = this.value">
                        <option value="ARS" selected>ARS - Pesos Argentinos</option>
                        <option value="USD">USD - D√≥lares</option>
                    </select>
                </div>
            </div>
            
            <div>
                <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px; text-transform: uppercase;">
                    üñºÔ∏è Imagen del producto
                </label>
                <div style="padding: 40px; border: 2px dashed #d1d5db; border-radius: 8px; text-align: center; background: #f9fafb; color: #9ca3af; font-size: 13px;">
                    Click para subir imagen o arrastr√° aqu√≠
                </div>
            </div>
        </div>
    `;
}


function getPestanaCostos() {
    const costoLista = parseFloat(datosProductoTemp.costoLista) || 0;
    const cantidadBulto = parseFloat(datosProductoTemp.cantidadPorBulto) || 1;
    const costoUnitario = cantidadBulto > 0 ? costoLista / cantidadBulto : costoLista;
    
    const costoSinIVA = parseFloat(datosProductoTemp.costoSinIVA) || 0;
    const costoConIVA = parseFloat(datosProductoTemp.costoConIVA) || 0;
    const iva = parseFloat(datosProductoTemp.iva) || 21;
    const markup = parseFloat(datosProductoTemp.gananciaMarkup) || 60;
    
    let costoFinal = costoUnitario;
    ['desc1', 'desc2', 'desc3', 'desc4'].forEach(desc => {
        const descuento = parseFloat(datosProductoTemp[desc]) || 0;
        if (descuento > 0) {
            costoFinal = costoFinal * (1 - descuento / 100);
        }
    });
    
    const precioSinIVA = costoFinal > 0 ? costoFinal * (1 + markup / 100) : 0;
    const precioConIVA = precioSinIVA * (1 + iva / 100);
    
    return `
        <div>
            <h3 style="color: #ff6b35; font-size: 16px; font-weight: 700; margin: 0 0 20px 0;">üí≤ ESTRUCTURA DE COSTOS Y PRECIOS</h3>
            
            <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">
                            Costo de lista(s/IVA):
                        </label>
                        <input type="number" step="any" id="costoLista" value="${costoLista}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right;"
                            oninput="datosProductoTemp.costoLista = this.value; cambiarPestanaProducto('costos')">
                    </div>
                    <div></div>
                    <div></div>
                </div>
                
                <!-- CANTIDAD POR BULTO -->
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin-bottom: 15px; padding: 15px; background: #eff6ff; border-radius: 6px; border: 2px solid #3b82f6;">
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #1e40af; margin-bottom: 6px;">
                            üì¶ Cantidad por bulto:
                        </label>
                        <input type="number" min="1" id="cantidadBulto" value="${cantidadBulto}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #3b82f6; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 700;"
                            oninput="datosProductoTemp.cantidadPorBulto = this.value; cambiarPestanaProducto('costos')">
                        <div style="font-size: 10px; color: #1e40af; margin-top: 4px; text-align: center;">unidades</div>
                    </div>
                    
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #1e40af; margin-bottom: 6px;">
                            üí∞ Costo unitario:
                        </label>
                        <input type="number" step="any" value="${costoUnitario.toFixed(3)}" readonly
                            style="width: 100%; padding: 8px 10px; border: 2px solid #10b981; border-radius: 6px; font-size: 14px; text-align: right; background: #f0fdf4; font-weight: 700; color: #10b981;">
                        <div style="font-size: 10px; color: #10b981; margin-top: 4px; text-align: center;">= lista √∑ cantidad</div>
                    </div>
                    
                    <div style="display: flex; align-items: center; justify-content: center;">
                        <div style="padding: 10px; background: white; border-radius: 6px; text-align: center; border: 1px solid #dbeafe;">
                            <div style="font-size: 10px; color: #6b7280; margin-bottom: 4px; font-weight: 600;">EJEMPLO:</div>
                            <div style="font-size: 11px; color: #1e40af;">Caja $${costoLista.toFixed(2)}</div>
                            <div style="font-size: 11px; color: #6b7280;">√∑ ${cantidadBulto} unid.</div>
                            <div style="font-size: 11px; color: #10b981; font-weight: 700;">= $${costoUnitario.toFixed(2)}/u</div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">
                            Costo(s/IVA):
                        </label>
                        <input type="number" step="any" id="costoSinIVA" value="${costoSinIVA}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right;"
                            onchange="datosProductoTemp.costoSinIVA = this.value">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">USD</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">Valor</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">
                            Costo(c/IVA):
                        </label>
                        <input type="number" step="any" id="costoConIVA" value="${costoConIVA}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right;"
                            onchange="datosProductoTemp.costoConIVA = this.value">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">USD</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">Valor</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                </div>
            </div>
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 10px;">Descuentos del Proveedor</label>
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 10px;">
                    <div>
                        <label style="display: block; font-size: 11px; color: #6b7280; margin-bottom: 4px;">Desc. 1 (%)</label>
                        <input type="number" step="any" id="desc1" value="${datosProductoTemp.desc1 || 0}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right;"
                            oninput="datosProductoTemp.desc1 = this.value; cambiarPestanaProducto('costos')">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; color: #6b7280; margin-bottom: 4px;">Desc. 2 (%)</label>
                        <input type="number" step="any" id="desc2" value="${datosProductoTemp.desc2 || 0}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right;"
                            oninput="datosProductoTemp.desc2 = this.value; cambiarPestanaProducto('costos')">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; color: #6b7280; margin-bottom: 4px;">Desc. 3 (%)</label>
                        <input type="number" step="any" id="desc3" value="${datosProductoTemp.desc3 || 0}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right;"
                            oninput="datosProductoTemp.desc3 = this.value; cambiarPestanaProducto('costos')">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; color: #6b7280; margin-bottom: 4px;">Desc. 4 (%)</label>
                        <input type="number" step="any" id="desc4" value="${datosProductoTemp.desc4 || 0}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right;"
                            oninput="datosProductoTemp.desc4 = this.value; cambiarPestanaProducto('costos')">
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: #f0f9ff; border-radius: 6px;">
                    <input type="checkbox" id="aplicarDescProveedor" 
                        style="width: 18px; height: 18px;"
                        onchange="datosProductoTemp.aplicarDescProveedor = this.checked">
                    <label for="aplicarDescProveedor" style="font-size: 13px; font-weight: 600; color: #1e40af;">
                        Aplicar descuentos del proveedor
                    </label>
                </div>
            </div>
            
            <div style="background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <div style="text-align: center; font-weight: 700; font-size: 14px; color: #374151; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #e5e7eb;">
                    Lista Contado
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">
                            % Ganancia:
                        </label>
                        <input type="number" step="any" id="markup" value="${markup}"
                            style="width: 100%; padding: 8px 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right; font-weight: 700;"
                            oninput="datosProductoTemp.gananciaMarkup = this.value; cambiarPestanaProducto('costos')">
                    </div>
                    <div></div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">
                            Precio(S/IVA):
                        </label>
                        <input type="number" step="any" value="${precioSinIVA.toFixed(3)}" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: right; background: #f9fafb;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">ARS</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">Valor</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">
                            Precio(C/IVA):
                        </label>
                        <input type="number" step="any" value="${precioConIVA.toFixed(3)}" readonly
                            style="width: 100%; padding: 8px 10px; border: 2px solid #10b981; border-radius: 6px; font-size: 14px; text-align: right; background: #f0fdf4; font-weight: 700; color: #10b981;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">ARS</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                    <div>
                        <label style="display: block; font-size: 11px; font-weight: 600; color: #6b7280; margin-bottom: 6px;">Valor</label>
                        <input type="number" step="any" value="0.000" readonly
                            style="width: 100%; padding: 8px 10px; border: 1px solid #e5e7eb; border-radius: 6px; font-size: 13px; text-align: right; background: #f9fafb;">
                    </div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">IVA (%)</label>
                    <input type="number" step="any" id="iva" value="${iva}"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                        onchange="datosProductoTemp.iva = this.value; cambiarPestanaProducto('costos')">
                </div>
            </div>
        </div>
    `;
}

function getPestanaInventario() {
    return `
        <div>
            <h3 style="color: #ff6b35; font-size: 16px; font-weight: 700; margin: 0 0 20px 0;">üì¶ DETALLES DE INVENTARIO</h3>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">Stock actual</label>
                    <input type="number" min="0" id="stockActual" value="${datosProductoTemp.stockActual}"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 700;"
                        onchange="datosProductoTemp.stockActual = this.value">
                </div>
                
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">M√≠nimo de alerta</label>
                    <input type="number" min="0" id="minimoAlerta" value="${datosProductoTemp.minimoAlerta}"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #fef3c7; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 700; background: #fffbeb;"
                        onchange="datosProductoTemp.minimoAlerta = this.value">
                </div>
                
                <div>
                    <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">Punto de pedido</label>
                    <input type="number" min="0" id="puntoPedido" value="${datosProductoTemp.puntoPedido || 10}"
                        style="width: 100%; padding: 10px 12px; border: 2px solid #dbeafe; border-radius: 6px; font-size: 14px; text-align: center; font-weight: 700; background: #eff6ff;"
                        onchange="datosProductoTemp.puntoPedido = this.value">
                </div>
            </div>
            
            <div style="padding: 15px; background: #f0f9ff; border-left: 4px solid #3b82f6; border-radius: 6px; margin-bottom: 20px;">
                <div style="font-size: 13px; font-weight: 600; color: #1e40af; margin-bottom: 5px;">
                    üìå Punto de Pedido
                </div>
                <div style="font-size: 12px; color: #1e40af;">
                    Cuando el stock llegue a <strong>${datosProductoTemp.puntoPedido || 10}</strong> unidades, el sistema generar√° autom√°ticamente un pedido al proveedor.
                </div>
            </div>
            
            <div>
                <label style="display: block; font-size: 12px; font-weight: 600; color: #6b7280; margin-bottom: 8px;">Ubicaci√≥n</label>
                <input type="text" id="ubicacion" value="${datosProductoTemp.ubicacion}"
                    placeholder="Ej: A-05"
                    style="width: 100%; padding: 10px 12px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;"
                    onchange="datosProductoTemp.ubicacion = this.value">
            </div>
        </div>
    `;
}

function getPestanaFraccionada() {
    return `
        <div>
            <h3 style="color: #3b82f6; font-size: 16px; font-weight: 700; margin: 0 0 20px 0;">üî¢ VENTA FRACCIONADA</h3>
            
            <div style="display: flex; align-items: center; gap: 15px; padding: 20px; background: #f9fafb; border-radius: 8px;">
                <label class="toggle-switch">
                    <input type="checkbox" id="habilitarFraccionado" ${datosProductoTemp.habilitarFraccionado ? 'checked' : ''}
                        onchange="datosProductoTemp.habilitarFraccionado = this.checked">
                    <span class="toggle-slider"></span>
                </label>
                <div>
                    <div style="font-weight: 700; font-size: 15px; margin-bottom: 4px;">HABILITAR FRACCIONADO</div>
                    <div style="font-size: 13px; color: #6b7280;">Permite vender en una unidad distinta al stock.</div>
                </div>
            </div>
        </div>
    `;
}

function getPestanaEcommerce() {
    return `
        <div>
            <h3 style="color: #06b6d4; font-size: 16px; font-weight: 700; margin: 0 0 20px 0;">üåê E-COMMERCE</h3>
            
            <div style="display: flex; align-items: center; gap: 15px; padding: 20px; background: #f9fafb; border-radius: 8px;">
                <label class="toggle-switch">
                    <input type="checkbox" id="publicarOnline" ${datosProductoTemp.publicarOnline ? 'checked' : ''}
                        onchange="datosProductoTemp.publicarOnline = this.checked">
                    <span class="toggle-slider"></span>
                </label>
                <div>
                    <div style="font-weight: 700; font-size: 15px; margin-bottom: 4px;">PUBLICAR ONLINE</div>
                    <div style="font-size: 13px; color: #6b7280;">El producto ser√° visible en tu tienda online.</div>
                </div>
            </div>
        </div>
    `;
}

function agregarNuevaMarca() {
    const marca = prompt('‚ûï NUEVA MARCA\n\nIngres√° el nombre de la marca:', '');
    if (marca) {
        alert('‚úÖ MARCA AGREGADA\n\n' + marca + '\n\n(En producci√≥n se agregar√≠a a la base de datos)');
        document.getElementById('marca').value = marca;
        datosProductoTemp.marca = marca;
    }
}

function agregarNuevoProveedor() {
    const proveedor = prompt('‚ûï NUEVO PROVEEDOR\n\nIngres√° el nombre del proveedor:', '');
    if (proveedor) {
        alert('‚úÖ PROVEEDOR AGREGADO\n\n' + proveedor + '\n\n(En producci√≥n se agregar√≠a a la base de datos)');
    }
}

function guardarProductoNuevo() {
    // Validar campos obligatorios
    if (!datosProductoTemp.nombre || !datosProductoTemp.sku) {
        alert('‚ö†Ô∏è CAMPOS OBLIGATORIOS\\n\\nComplet√° al menos:\\n‚Ä¢ Nombre del producto\\n‚Ä¢ SKU / C√≥digo interno');
        return;
    }
    
    // Calcular precio final
    const costoBase = parseFloat(datosProductoTemp.costoBase) || 0;
    const markup = parseFloat(datosProductoTemp.gananciaMarkup) || 0;
    const precioFinal = costoBase > 0 ? costoBase * (1 + markup / 100) : 0;
    
    // Crear producto completo
    const nuevoProducto = {
        codigo: datosProductoTemp.sku,
        nombre: datosProductoTemp.nombre,
        marca: datosProductoTemp.marca || 'Sin marca',
        categoria: datosProductoTemp.categoria || 'General',
        unidadPrimaria: datosProductoTemp.unidadPrimaria,
        unidadVenta: datosProductoTemp.unidadVenta,
        codigoProveedor: datosProductoTemp.codigoProveedor,
        moneda: datosProductoTemp.monedaVenta,
        precioCosto: costoBase,
        iva: parseFloat(datosProductoTemp.iva),
        gananciaPorc: markup,
        precio: precioFinal,
        stock: parseInt(datosProductoTemp.stockActual) || 0,
        stockMinimo: parseInt(datosProductoTemp.minimoAlerta) || 5,
        ubicacion: datosProductoTemp.ubicacion,
        permiteFraccionado: datosProductoTemp.habilitarFraccionado,
        publicadoOnline: datosProductoTemp.publicarOnline
    };
    
    // Agregar a productos
    productos.push(nuevoProducto);
    
    // Confirmaci√≥n
    alert(`‚úÖ PRODUCTO CREADO

${nuevoProducto.nombre}
SKU: ${nuevoProducto.codigo}
Precio: $${precioFinal.toLocaleString()}
Stock: ${nuevoProducto.stock}

¬°Producto agregado al inventario!`);
    
    // Cerrar y recargar
    cerrarModalProducto();
    cargarModulo('inventario');
}








        function getRemitosHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üìã Gesti√≥n de Remitos</h2>
                    <p style="color: #6b7280;">Remitos pendientes, facturados, agrupaci√≥n por cliente y pre-facturas</p>
                </div>
                
                <!-- Pesta√±as -->
                <div style="display: flex; gap: 0; border-bottom: 3px solid #e5e7eb; margin-bottom: 30px;">
                    <div class="pestana-remitos ${pestanaRemitosActiva === 'pendientes' ? 'activa' : ''}" 
                        onclick="cambiarPestanaRemitos('pendientes')"
                        style="padding: 12px 24px; cursor: pointer; font-weight: 600; border-bottom: 3px solid ${pestanaRemitosActiva === 'pendientes' ? '#f59e0b' : 'transparent'}; color: ${pestanaRemitosActiva === 'pendientes' ? '#f59e0b' : '#6b7280'};">
                        üì¶ POR FACTURAR
                    </div>
                    <div class="pestana-remitos ${pestanaRemitosActiva === 'facturados' ? 'activa' : ''}" 
                        onclick="cambiarPestanaRemitos('facturados')"
                        style="padding: 12px 24px; cursor: pointer; font-weight: 600; border-bottom: 3px solid ${pestanaRemitosActiva === 'facturados' ? '#10b981' : 'transparent'}; color: ${pestanaRemitosActiva === 'facturados' ? '#10b981' : '#6b7280'};">
                        ‚úÖ FACTURADOS
                    </div>
                    <div class="pestana-remitos ${pestanaRemitosActiva === 'agrupar' ? 'activa' : ''}" 
                        onclick="cambiarPestanaRemitos('agrupar')"
                        style="padding: 12px 24px; cursor: pointer; font-weight: 600; border-bottom: 3px solid ${pestanaRemitosActiva === 'agrupar' ? '#3b82f6' : 'transparent'}; color: ${pestanaRemitosActiva === 'agrupar' ? '#3b82f6' : '#6b7280'};">
                        üîó AGRUPAR POR CLIENTE
                    </div>
                    <div class="pestana-remitos ${pestanaRemitosActiva === 'prefacturas' ? 'activa' : ''}" 
                        onclick="cambiarPestanaRemitos('prefacturas')"
                        style="padding: 12px 24px; cursor: pointer; font-weight: 600; border-bottom: 3px solid ${pestanaRemitosActiva === 'prefacturas' ? '#8b5cf6' : 'transparent'}; color: ${pestanaRemitosActiva === 'prefacturas' ? '#8b5cf6' : '#6b7280'};">
                        üìÑ PRE-FACTURAS
                    </div>
                </div>
                
                <!-- Contenido seg√∫n pesta√±a -->
                <div id="contenidoRemitos">
                    ${getContenidoPestanaRemitos()}
                </div>
            `;
        }
        
        function cambiarPestanaRemitos(pestana) {
            pestanaRemitosActiva = pestana;
            cargarModulo('remitos');
        }
        
        function getContenidoPestanaRemitos() {
            switch(pestanaRemitosActiva) {
                case 'pendientes':
                    return getPestanaRemitosPendientes();
                case 'facturados':
                    return getPestanaRemitosFacturados();
                case 'agrupar':
                    return getPestanaAgruparRemitos();
                case 'prefacturas':
                    return getPestanaPreFacturas();
                default:
                    return getPestanaRemitosPendientes();
            }
        }
        
        function getPestanaRemitosPendientes() {
            const pendientes = remitos.filter(r => !r.facturado);
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üì¶ Remitos por Facturar (${pendientes.length})</h3>
                    </div>
                    <div class="card-body">
                        ${pendientes.length === 0 ? `
                            <p style="text-align: center; color: #6b7280; padding: 40px;">
                                ‚úÖ No hay remitos pendientes de facturar
                            </p>
                        ` : `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Remito</th>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Items</th>
                                        <th>Total</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${pendientes.map(r => `
                                        <tr>
                                            <td style="font-family: monospace; font-weight: 700;">${r.id}</td>
                                            <td>${r.fecha}</td>
                                            <td style="font-weight: 600;">${r.cliente}</td>
                                            <td style="text-align: center;">${r.items.length}</td>
                                            <td style="font-weight: 700; font-size: 16px;">$${r.total.toLocaleString()}</td>
                                            <td>
                                                <button class="btn-primary" style="padding: 6px 12px; font-size: 12px;" 
                                                    onclick="verDetalleRemito('${r.id}')">
                                                    üëÅÔ∏è Ver
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `}
                    </div>
                </div>
            `;
        }
        
        function getPestanaRemitosFacturados() {
            const facturados = remitos.filter(r => r.facturado);
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚úÖ Remitos Facturados (${facturados.length})</h3>
                    </div>
                    <div class="card-body">
                        ${facturados.length === 0 ? `
                            <p style="text-align: center; color: #6b7280; padding: 40px;">
                                No hay remitos facturados
                            </p>
                        ` : `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Remito</th>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Total</th>
                                        <th>Factura</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${facturados.map(r => `
                                        <tr>
                                            <td style="font-family: monospace; font-weight: 700;">${r.id}</td>
                                            <td>${r.fecha}</td>
                                            <td style="font-weight: 600;">${r.cliente}</td>
                                            <td style="font-weight: 700; font-size: 16px;">$${r.total.toLocaleString()}</td>
                                            <td style="font-family: monospace; color: #3b82f6; font-weight: 700;">${r.nroFactura || '-'}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `}
                    </div>
                </div>
            `;
        }
        
        function getPestanaAgruparRemitos() {
            // Obtener clientes √∫nicos con remitos pendientes
            const pendientes = remitos.filter(r => !r.facturado);
            const clientesConRemitos = {};
            
            pendientes.forEach(r => {
                if (!clientesConRemitos[r.cliente]) {
                    clientesConRemitos[r.cliente] = {
                        cliente: r.cliente,
                        remitos: [],
                        totalRemitos: 0,
                        totalMonto: 0
                    };
                }
                clientesConRemitos[r.cliente].remitos.push(r);
                clientesConRemitos[r.cliente].totalRemitos++;
                clientesConRemitos[r.cliente].totalMonto += r.total;
            });
            
            const clientesArray = Object.values(clientesConRemitos);
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üîó Agrupar Remitos por Cliente</h3>
                        <p style="font-size: 13px; color: #6b7280; margin: 5px 0 0 0;">
                            Seleccion√° un cliente para agrupar sus remitos y generar una pre-factura
                        </p>
                    </div>
                    <div class="card-body">
                        ${clientesArray.length === 0 ? `
                            <p style="text-align: center; color: #6b7280; padding: 40px;">
                                ‚úÖ No hay clientes con remitos pendientes
                            </p>
                        ` : `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th style="text-align: center;">Remitos Pendientes</th>
                                        <th>Total a Facturar</th>
                                        <th>Acci√≥n</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${clientesArray.map(c => `
                                        <tr>
                                            <td style="font-weight: 700; font-size: 16px;">${c.cliente}</td>
                                            <td style="text-align: center;">
                                                <span style="padding: 6px 14px; background: #fef3c7; color: #f59e0b; font-weight: 800; border-radius: 8px; font-size: 18px;">
                                                    ${c.totalRemitos}
                                                </span>
                                            </td>
                                            <td style="font-weight: 800; font-size: 18px; color: #10b981;">$${c.totalMonto.toLocaleString()}</td>
                                            <td>
                                                <button class="btn-primary" onclick="abrirModalAgruparRemitos('${c.cliente}')">
                                                    üìã AGRUPAR REMITOS
                                                </button>
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `}
                    </div>
                </div>
            `;
        }
        
        function getPestanaPreFacturas() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìÑ Pre-Facturas Pendientes (${preFacturas.filter(pf => pf.estado === 'Pendiente').length})</h3>
                        <p style="font-size: 13px; color: #6b7280; margin: 5px 0 0 0;">
                            Pre-facturas generadas esperando revisi√≥n y aprobaci√≥n de administraci√≥n
                        </p>
                    </div>
                    <div class="card-body">
                        ${preFacturas.length === 0 ? `
                            <p style="text-align: center; color: #6b7280; padding: 40px;">
                                No hay pre-facturas generadas
                            </p>
                        ` : `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Pre-Factura</th>
                                        <th>Fecha</th>
                                        <th>Cliente</th>
                                        <th>Remitos</th>
                                        <th>Total</th>
                                        <th>Estado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${preFacturas.map(pf => `
                                        <tr>
                                            <td style="font-family: monospace; font-weight: 700;">${pf.id}</td>
                                            <td>${pf.fecha}</td>
                                            <td style="font-weight: 600;">${pf.cliente}</td>
                                            <td style="text-align: center;">
                                                <span style="padding: 4px 10px; background: #dbeafe; color: #3b82f6; font-weight: 700; border-radius: 6px;">
                                                    ${pf.remitos.length}
                                                </span>
                                            </td>
                                            <td style="font-weight: 700; font-size: 16px;">$${pf.total.toLocaleString()}</td>
                                            <td>
                                                <span style="padding: 6px 12px; background: ${pf.estado === 'Pendiente' ? '#fef3c7' : pf.estado === 'Aprobada' ? '#dcfce7' : '#dbeafe'}; color: ${pf.estado === 'Pendiente' ? '#f59e0b' : pf.estado === 'Aprobada' ? '#10b981' : '#3b82f6'}; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                    ${pf.estado === 'Pendiente' ? '‚è≥ PENDIENTE' : pf.estado === 'Aprobada' ? '‚úÖ APROBADA' : 'üìÑ FACTURADA'}
                                                </span>
                                            </td>
                                            <td>
                                                <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 5px;" 
                                                    onclick="verDetallePreFactura('${pf.id}')">
                                                    üëÅÔ∏è Ver
                                                </button>
                                                ${pf.estado === 'Pendiente' ? `
                                                    <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; background: #10b981;" 
                                                        onclick="aprobarPreFactura('${pf.id}')">
                                                        ‚úÖ Aprobar
                                                    </button>
                                                ` : ''}
                                            </td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `}
                    </div>
                </div>
            `;
        }
        
        function abrirModalAgruparRemitos(cliente) {
            const remitosCliente = remitos.filter(r => r.cliente === cliente && !r.facturado);
            
            if (remitosCliente.length === 0) {
                alert('‚ö†Ô∏è Este cliente no tiene remitos pendientes');
                return;
            }
            
            const totalInicial = remitosCliente.reduce((sum, r) => sum + r.total, 0);
            
            const modalHTML = `
                <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center;" id="modalAgruparRemitos">
                    <div style="background: white; padding: 30px; border-radius: 12px; max-width: 800px; width: 90%; max-height: 90vh; overflow-y: auto;">
                        <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 10px;">üìã Agrupar Remitos - ${cliente}</h2>
                        <p style="color: #6b7280; margin-bottom: 25px;">Seleccion√° los remitos que quer√©s incluir en la pre-factura</p>
                        
                        <table style="width: 100%; margin-bottom: 25px;">
                            <thead>
                                <tr>
                                    <th style="text-align: center; width: 60px;">
                                        <input type="checkbox" id="selectAllRemitos" onchange="toggleAllRemitos(this.checked)" checked>
                                    </th>
                                    <th>Remito</th>
                                    <th>Fecha</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${remitosCliente.map(r => `
                                    <tr>
                                        <td style="text-align: center;">
                                            <input type="checkbox" class="checkbox-remito" data-remito-id="${r.id}" data-total="${r.total}" checked onchange="actualizarTotalPreFactura()">
                                        </td>
                                        <td style="font-family: monospace; font-weight: 700;">${r.id}</td>
                                        <td>${r.fecha}</td>
                                        <td>${r.items.length}</td>
                                        <td style="font-weight: 700;">$${r.total.toLocaleString()}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                        
                        <div style="background: #f0f9ff; padding: 20px; border-radius: 8px; margin-bottom: 25px;">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div>
                                    <div style="font-size: 13px; color: #6b7280; margin-bottom: 5px;">REMITOS SELECCIONADOS</div>
                                    <div style="font-size: 24px; font-weight: 800; color: #3b82f6;" id="cantidadRemitosSeleccionados">${remitosCliente.length}</div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 13px; color: #6b7280; margin-bottom: 5px;">TOTAL PRE-FACTURA</div>
                                    <div style="font-size: 32px; font-weight: 800; color: #10b981;" id="totalPreFactura">$${totalInicial.toLocaleString()}</div>
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-bottom: 25px;">
                            <label style="font-size: 13px; color: #6b7280; font-weight: 600; display: block; margin-bottom: 8px;">OBSERVACIONES (Opcional)</label>
                            <textarea id="observacionesPreFactura" class="input-field" rows="3" placeholder="Agregar notas o aclaraciones para administraci√≥n..." style="width: 100%; margin: 0;"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 15px;">
                            <button class="btn-primary" style="flex: 1; background: #10b981;" onclick="confirmarGenerarPreFactura('${cliente}')">
                                ‚úÖ GENERAR PRE-FACTURA
                            </button>
                            <button class="btn-primary" style="flex: 1; background: #6b7280;" onclick="cerrarModalAgruparRemitos()">
                                ‚úó CANCELAR
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        function toggleAllRemitos(checked) {
            document.querySelectorAll('.checkbox-remito').forEach(cb => {
                cb.checked = checked;
            });
            actualizarTotalPreFactura();
        }
        
        function actualizarTotalPreFactura() {
            const checkboxes = document.querySelectorAll('.checkbox-remito:checked');
            let total = 0;
            
            checkboxes.forEach(cb => {
                total += parseFloat(cb.dataset.total);
            });
            
            document.getElementById('totalPreFactura').textContent = '$' + total.toLocaleString();
            document.getElementById('cantidadRemitosSeleccionados').textContent = checkboxes.length;
        }
        
        function confirmarGenerarPreFactura(cliente) {
            const checkboxes = document.querySelectorAll('.checkbox-remito:checked');
            
            if (checkboxes.length === 0) {
                alert('‚ö†Ô∏è Seleccion√° al menos un remito');
                return;
            }
            
            const remitosIds = Array.from(checkboxes).map(cb => cb.dataset.remitoId);
            const observaciones = document.getElementById('observacionesPreFactura').value;
            
            // Obtener items de todos los remitos seleccionados
            const remitosSeleccionados = remitos.filter(r => remitosIds.includes(r.id));
            const todosLosItems = [];
            let totalGeneral = 0;
            
            remitosSeleccionados.forEach(r => {
                r.items.forEach(item => {
                    todosLosItems.push(item);
                });
                totalGeneral += r.total;
            });
            
            // Crear pre-factura
            const nuevaPreFactura = {
                id: `PF-${String(siguienteIdPreFactura).padStart(3, '0')}`,
                fecha: new Date().toISOString().split('T')[0],
                cliente: cliente,
                remitos: remitosIds,
                items: todosLosItems,
                total: totalGeneral,
                estado: 'Pendiente',
                observaciones: observaciones,
                creadoPor: 'Mauricio'
            };
            
            preFacturas.push(nuevaPreFactura);
            siguienteIdPreFactura++;
            
            cerrarModalAgruparRemitos();
            
            alert(`‚úÖ Pre-Factura ${nuevaPreFactura.id} generada\n\nCliente: ${cliente}\nRemitos: ${remitosIds.length}\nTotal: $${totalGeneral.toLocaleString()}\n\nüìã La pre-factura est√° pendiente de revisi√≥n en la pesta√±a PRE-FACTURAS`);
            
            // Cambiar a pesta√±a de pre-facturas
            cambiarPestanaRemitos('prefacturas');
        }
        
        function cerrarModalAgruparRemitos() {
            const modal = document.getElementById('modalAgruparRemitos');
            if (modal) {
                modal.remove();
            }
        }
        
        function verDetalleRemito(remitoId) {
            const remito = remitos.find(r => r.id === remitoId);
            if (!remito) return;
            
            const detalleItems = remito.items.map(item => 
                `${item.cantidad}x ${item.nombre} - $${item.precio.toLocaleString()} = $${(item.cantidad * item.precio).toLocaleString()}`
            ).join('\n');
            
            alert(`üìã DETALLE REMITO ${remito.id}\n\nCliente: ${remito.cliente}\nFecha: ${remito.fecha}\n\nITEMS:\n${detalleItems}\n\nTOTAL: $${remito.total.toLocaleString()}\n\nEstado: ${remito.facturado ? '‚úÖ Facturado (' + remito.nroFactura + ')' : '‚è≥ Pendiente'}`);
        }
        
        function verDetallePreFactura(preFacturaId) {
            const pf = preFacturas.find(p => p.id === preFacturaId);
            if (!pf) return;
            
            const detalleItems = pf.items.map(item => 
                `${item.cantidad}x ${item.nombre} - $${item.precio.toLocaleString()}`
            ).join('\n');
            
            alert(`üìÑ PRE-FACTURA ${pf.id}\n\nCliente: ${pf.cliente}\nFecha: ${pf.fecha}\nCreado por: ${pf.creadoPor}\n\nREMITOS INCLUIDOS:\n${pf.remitos.join(', ')}\n\nITEMS:\n${detalleItems}\n\nTOTAL: $${pf.total.toLocaleString()}\n\nEstado: ${pf.estado}\n\n${pf.observaciones ? 'Observaciones:\n' + pf.observaciones : ''}`);
        }
        
        function aprobarPreFactura(preFacturaId) {
            const pf = preFacturas.find(p => p.id === preFacturaId);
            if (!pf) return;
            
            if (confirm(`‚úÖ APROBAR PRE-FACTURA ${pf.id}\n\nCliente: ${pf.cliente}\nTotal: $${pf.total.toLocaleString()}\nRemitos: ${pf.remitos.length}\n\n¬øAprobar esta pre-factura?\n\nLuego de aprobar quedar√° lista para facturar.`)) {
                pf.estado = 'Aprobada';
                alert(`‚úÖ Pre-Factura ${pf.id} APROBADA\n\nYa est√° lista para generar la factura final.`);
                cargarModulo('remitos');
            }
        }


        function getClientesHTML() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Gesti√≥n de Clientes</h3>
                        <button class="btn-primary" onclick="abrirFormularioCliente()">+ Nuevo Cliente</button>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <input type="text" id="buscarCliente" class="input-field" placeholder="üîç Buscar por nombre, CUIT o email..." 
                                style="margin: 0; flex: 1;" onkeyup="filtrarClientes()">
                            <select id="filtroTipoCliente" class="input-field" style="max-width: 250px; margin: 0;" onchange="filtrarClientes()">
                                <option value="">Todos los tipos</option>
                                <option value="Consumidor Final">Consumidor Final</option>
                                <option value="Monotributista">Monotributista</option>
                                <option value="Responsable Inscripto">Responsable Inscripto</option>
                            </select>
                            <select id="filtroCondicion" class="input-field" style="max-width: 200px; margin: 0;" onchange="filtrarClientes()">
                                <option value="">Todas las condiciones</option>
                                <option value="Contado">Contado</option>
                                <option value="Cuenta Corriente">Cuenta Corriente</option>
                            </select>
                        </div>
                        
                        <div class="table-container" style="border: 2px solid #f3f4f6; border-radius: 12px; overflow: hidden;">
                            <table>
                                <thead style="background: #f8f9fa;">
                                    <tr>
                                        <th>Cliente</th>
                                        <th>CUIT</th>
                                        <th>Tipo</th>
                                        <th>Condici√≥n</th>
                                        <th>Contacto</th>
                                        <th>Saldo</th>
                                        <th style="text-align: center; width: 200px;">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="tablaClientes">
                                    ${renderClientes()}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderClientes(filtros = {}) {
            let clientesFiltrados = clientes.filter(c => c.activo);
            
            // Aplicar filtros
            if (filtros.busqueda) {
                const busq = filtros.busqueda.toLowerCase();
                clientesFiltrados = clientesFiltrados.filter(c => 
                    c.nombre.toLowerCase().includes(busq) ||
                    c.cuit.includes(busq) ||
                    c.email.toLowerCase().includes(busq)
                );
            }
            
            if (filtros.tipo) {
                clientesFiltrados = clientesFiltrados.filter(c => c.tipo === filtros.tipo);
            }
            
            if (filtros.condicion) {
                clientesFiltrados = clientesFiltrados.filter(c => c.condicion === filtros.condicion);
            }
            
            if (clientesFiltrados.length === 0) {
                return `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #999;">
                            No se encontraron clientes
                        </td>
                    </tr>
                `;
            }
            
            return clientesFiltrados.map(c => `
                <tr>
                    <td>
                        <div>
                            <strong style="font-size: 15px;">${c.nombre}</strong>
                            <div style="font-size: 12px; color: #6b7280; margin-top: 2px;">${c.direccion}</div>
                        </div>
                    </td>
                    <td><code>${c.cuit}</code></td>
                    <td>
                        <span class="badge" style="${getTipoBadgeStyle(c.tipo)}">${c.tipo}</span>
                    </td>
                    <td>
                        <span class="badge" style="${getCondicionBadgeStyle(c.condicion)}">${c.condicion}</span>
                        ${c.descuentoEspecial > 0 ? `<div style="font-size: 11px; color: #ff6b35; margin-top: 3px; font-weight: 600;">-${c.descuentoEspecial}% desc.</div>` : ''}
                    </td>
                    <td>
                        <div style="font-size: 13px;">
                            <div>üìû ${c.telefono}</div>
                            <div style="color: #6b7280; margin-top: 2px;">‚úâÔ∏è ${c.email}</div>
                        </div>
                    </td>
                    <td>
                        <strong style="font-size: 15px; color: ${c.saldo < 0 ? '#dc2626' : c.saldo > 0 ? '#059669' : '#6b7280'};">
                            ${c.saldo < 0 ? '-' : ''}$${Math.abs(c.saldo).toLocaleString()}
                        </strong>
                        <div style="font-size: 11px; color: #6b7280; margin-top: 2px;">
                            ${c.saldo < 0 ? 'Debe' : c.saldo > 0 ? 'A favor' : 'Sin saldo'}
                        </div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; justify-content: center; flex-wrap: wrap;">
                            ${c.condicion === 'Cuenta Corriente' ? `
                                <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); padding: 8px 12px; font-size: 13px; white-space: nowrap;" 
                                    onclick="abrirCuentaCorriente(${c.id})" title="Cuenta corriente">
                                    üìä Cta.Cte
                                </button>
                            ` : ''}
                            <button class="btn-action btn-info" onclick="verDetalleCliente(${c.id})" title="Ver detalle">üëÅÔ∏è</button>
                            <button class="btn-action btn-warning" onclick="editarCliente(${c.id})" title="Editar">‚úèÔ∏è</button>
                            <button class="btn-action btn-danger" onclick="eliminarCliente(${c.id})" title="Eliminar">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function getTipoBadgeStyle(tipo) {
            const estilos = {
                'Consumidor Final': 'background: #dbeafe; color: #1e40af;',
                'Monotributista': 'background: #fef3c7; color: #92400e;',
                'Responsable Inscripto': 'background: #dcfce7; color: #166534;'
            };
            return estilos[tipo] || 'background: #f3f4f6; color: #6b7280;';
        }

        function getCondicionBadgeStyle(condicion) {
            return condicion === 'Cuenta Corriente' ? 
                'background: #fce7f3; color: #9f1239;' : 
                'background: #f3f4f6; color: #6b7280;';
        }

        function filtrarClientes() {
            const busqueda = document.getElementById('buscarCliente')?.value || '';
            const tipo = document.getElementById('filtroTipoCliente')?.value || '';
            const condicion = document.getElementById('filtroCondicion')?.value || '';
            
            const tbody = document.getElementById('tablaClientes');
            if (tbody) {
                tbody.innerHTML = renderClientes({ busqueda, tipo, condicion });
            }
        }


        // ==================== SALDOS Y DEUDAS ====================
        function getSaldosDeudasHTML() {
            // Calcular deudas de clientes
            const clientesConDeuda = clientes.filter(c => c.saldo > 0).sort((a, b) => b.saldo - a.saldo);
            const totalDeudas = clientesConDeuda.reduce((sum, c) => sum + c.saldo, 0);
            
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üí≥ Saldos y Deudas</h2>
                    <p style="color: #6b7280;">Control de cuentas corrientes y cobros pendientes</p>
                </div>
                
                <!-- Resumen superior -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
                    <div class="card" style="border-left: 4px solid #ef4444;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">TOTAL A COBRAR</div>
                        <div style="font-size: 36px; font-weight: 800; color: #ef4444;">$${totalDeudas.toLocaleString()}</div>
                        <div style="font-size: 11px; color: #6b7280;">en cuenta corriente</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #f59e0b;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">CLIENTES CON DEUDA</div>
                        <div style="font-size: 36px; font-weight: 800; color: #f59e0b;">${clientesConDeuda.length}</div>
                        <div style="font-size: 11px; color: #6b7280;">de ${clientes.length} totales</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">DEUDA PROMEDIO</div>
                        <div style="font-size: 36px; font-weight: 800; color: #3b82f6;">$${clientesConDeuda.length > 0 ? (totalDeudas / clientesConDeuda.length).toLocaleString('es-AR', {maximumFractionDigits: 0}) : 0}</div>
                        <div style="font-size: 11px; color: #6b7280;">por cliente</div>
                    </div>
                </div>
                
                <!-- Tabla de deudas -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Detalle de Cuentas Corrientes</h3>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn-primary" style="padding: 8px 16px; font-size: 13px; background: #10b981;" onclick="exportarSaldos()">
                                üì• EXPORTAR EXCEL
                            </button>
                            <button class="btn-primary" style="padding: 8px 16px; font-size: 13px; background: #3b82f6;" onclick="enviarRecordatorios()">
                                üìß ENVIAR RECORDATORIOS
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        ${clientesConDeuda.length === 0 ? `
                            <p style="text-align: center; color: #6b7280; padding: 40px;">
                                ‚úÖ No hay clientes con deuda pendiente
                            </p>
                        ` : `
                            <table>
                                <thead>
                                    <tr>
                                        <th>Cliente</th>
                                        <th>Tipo</th>
                                        <th>Condici√≥n</th>
                                        <th>Saldo Deudor</th>
                                        <th>D√≠as Atraso</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${clientesConDeuda.map(cliente => {
                                        const diasAtraso = Math.floor(Math.random() * 45); // Simular d√≠as de atraso
                                        const colorAtraso = diasAtraso > 30 ? '#ef4444' : diasAtraso > 15 ? '#f59e0b' : '#6b7280';
                                        
                                        return `
                                            <tr>
                                                <td style="font-weight: 700;">${cliente.nombre}</td>
                                                <td><span class="badge" style="background: ${cliente.tipo === 'Mayorista' ? '#dbeafe' : '#fef3c7'}; color: ${cliente.tipo === 'Mayorista' ? '#3b82f6' : '#f59e0b'};">${cliente.tipo}</span></td>
                                                <td><span class="badge">${cliente.condicion}</span></td>
                                                <td style="font-weight: 800; font-size: 18px; color: #ef4444;">$${cliente.saldo.toLocaleString()}</td>
                                                <td style="color: ${colorAtraso}; font-weight: 700;">${diasAtraso} d√≠as</td>
                                                <td>
                                                    <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 5px;" 
                                                        onclick="verMovimientosCliente('${cliente.cuit}')">
                                                        üëÅÔ∏è Ver
                                                    </button>
                                                    <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; background: #10b981;" 
                                                        onclick="registrarPago('${cliente.cuit}')">
                                                        üíµ Cobrar
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        `}
                    </div>
                </div>
                
                <!-- Gr√°fico de vencimientos (opcional) -->
                <div class="card" style="margin-top: 30px;">
                    <div class="card-header">
                        <h3 class="card-title">üìä An√°lisis de Vencimientos</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                            <div style="padding: 20px; background: #dcfce7; border-radius: 8px; text-align: center;">
                                <div style="font-size: 13px; color: #166534; font-weight: 600; margin-bottom: 5px;">AL D√çA (0-7 d√≠as)</div>
                                <div style="font-size: 28px; font-weight: 800; color: #16a34a;">${clientesConDeuda.filter(c => Math.random() > 0.7).length}</div>
                                <div style="font-size: 11px; color: #166534; margin-top: 3px;">clientes</div>
                            </div>
                            <div style="padding: 20px; background: #fef3c7; border-radius: 8px; text-align: center;">
                                <div style="font-size: 13px; color: #92400e; font-weight: 600; margin-bottom: 5px;">PR√ìXIMO (8-15 d√≠as)</div>
                                <div style="font-size: 28px; font-weight: 800; color: #f59e0b;">${clientesConDeuda.filter(c => Math.random() > 0.5).length}</div>
                                <div style="font-size: 11px; color: #92400e; margin-top: 3px;">clientes</div>
                            </div>
                            <div style="padding: 20px; background: #fed7aa; border-radius: 8px; text-align: center;">
                                <div style="font-size: 13px; color: #9a3412; font-weight: 600; margin-bottom: 5px;">VENCIDO (16-30 d√≠as)</div>
                                <div style="font-size: 28px; font-weight: 800; color: #ea580c;">${clientesConDeuda.filter(c => Math.random() > 0.6).length}</div>
                                <div style="font-size: 11px; color: #9a3412; margin-top: 3px;">clientes</div>
                            </div>
                            <div style="padding: 20px; background: #fecaca; border-radius: 8px; text-align: center;">
                                <div style="font-size: 13px; color: #991b1b; font-weight: 600; margin-bottom: 5px;">CR√çTICO (+30 d√≠as)</div>
                                <div style="font-size: 28px; font-weight: 800; color: #dc2626;">${clientesConDeuda.filter(c => Math.random() > 0.8).length}</div>
                                <div style="font-size: 11px; color: #991b1b; margin-top: 3px;">clientes</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function verMovimientosCliente(cuit) {
            const cliente = clientes.find(c => c.cuit === cuit);
            if (!cliente) return;
            
            alert(`üìã MOVIMIENTOS DE CUENTA CORRIENTE\n\nCliente: ${cliente.nombre}\nCUIT: ${cliente.cuit}\n\nSaldo actual: $${cliente.saldo.toLocaleString()}\n\n[Aqu√≠ ir√≠an los movimientos detallados]\n\nüí° Esta funcionalidad se puede expandir mostrando un modal con el historial completo.`);
        }
        
        function registrarPago(cuit) {
            const cliente = clientes.find(c => c.cuit === cuit);
            if (!cliente) return;
            
            const monto = prompt(`üíµ REGISTRAR PAGO\n\nCliente: ${cliente.nombre}\nDeuda actual: $${cliente.saldo.toLocaleString()}\n\n¬øCu√°nto pag√≥ el cliente?`, cliente.saldo);
            
            if (monto && !isNaN(monto)) {
                const montoNum = parseFloat(monto);
                
                if (montoNum > cliente.saldo) {
                    alert('‚ö†Ô∏è El monto ingresado es mayor a la deuda');
                    return;
                }
                
                cliente.saldo -= montoNum;
                
                alert(`‚úÖ PAGO REGISTRADO\n\nCliente: ${cliente.nombre}\nMonto: $${montoNum.toLocaleString()}\nNuevo saldo: $${cliente.saldo.toLocaleString()}`);
                
                cargarModulo('saldos-deudas');
            }
        }
        
        function exportarSaldos() {
            alert('üì• EXPORTAR SALDOS\n\nSe generar√° un archivo Excel con:\n\n‚Ä¢ Listado completo de clientes con deuda\n‚Ä¢ Saldos actualizados\n‚Ä¢ D√≠as de atraso\n‚Ä¢ Totales por categor√≠a\n\nüí° Funcionalidad en desarrollo');
        }
        
        function enviarRecordatorios() {
            const clientesConDeuda = clientes.filter(c => c.saldo > 0);
            
            if (confirm(`üìß ENVIAR RECORDATORIOS DE PAGO\n\n¬øEnviar email a ${clientesConDeuda.length} clientes con deuda?\n\nSe enviar√°:\n‚Ä¢ Recordatorio de saldo pendiente\n‚Ä¢ Detalle de facturas\n‚Ä¢ Formas de pago disponibles`)) {
                alert(`‚úÖ RECORDATORIOS ENVIADOS\n\n${clientesConDeuda.length} emails programados para env√≠o\n\nüí° Los clientes recibir√°n el recordatorio en las pr√≥ximas horas`);
            }
        }



        // ==================== CUOTAS INTERNAS ====================
        function getCuotasInternasHTML() {
            // Datos de ejemplo de ventas en cuotas
            const ventasEnCuotas = [
                { id: 'VC-001', fecha: '2026-01-15', cliente: 'Juan P√©rez', total: 50000, cuotas: 6, cuotaMensual: 8333, pagadas: 2, proxVencimiento: '2026-03-15' },
                { id: 'VC-002', fecha: '2026-01-20', cliente: 'Mar√≠a Garc√≠a', total: 120000, cuotas: 12, cuotaMensual: 10000, pagadas: 1, proxVencimiento: '2026-02-20' },
                { id: 'VC-003', fecha: '2025-12-10', cliente: 'Construcciones SA', total: 850000, cuotas: 18, cuotaMensual: 47222, pagadas: 3, proxVencimiento: '2026-03-10' },
                { id: 'VC-004', fecha: '2026-01-28', cliente: 'Pedro L√≥pez', total: 35000, cuotas: 3, cuotaMensual: 11667, pagadas: 0, proxVencimiento: '2026-02-28' }
            ];
            
            const totalFinanciado = ventasEnCuotas.reduce((sum, v) => sum + v.total, 0);
            const totalCobrado = ventasEnCuotas.reduce((sum, v) => sum + (v.cuotaMensual * v.pagadas), 0);
            const totalPendiente = totalFinanciado - totalCobrado;
            const cuotasVencenEsteMes = ventasEnCuotas.filter(v => {
                const venc = new Date(v.proxVencimiento);
                const hoy = new Date();
                return venc.getMonth() === hoy.getMonth();
            }).length;
            
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üí≥ Cuotas Internas</h2>
                    <p style="color: #6b7280;">Gesti√≥n de ventas financiadas y plan de pagos</p>
                </div>
                
                <!-- Resumen superior -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">TOTAL FINANCIADO</div>
                        <div style="font-size: 32px; font-weight: 800; color: #3b82f6;">$${totalFinanciado.toLocaleString()}</div>
                        <div style="font-size: 11px; color: #6b7280;">${ventasEnCuotas.length} planes activos</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #10b981;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">COBRADO</div>
                        <div style="font-size: 32px; font-weight: 800; color: #10b981;">$${totalCobrado.toLocaleString()}</div>
                        <div style="font-size: 11px; color: #6b7280;">${((totalCobrado/totalFinanciado)*100).toFixed(0)}% del total</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #f59e0b;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">PENDIENTE</div>
                        <div style="font-size: 32px; font-weight: 800; color: #f59e0b;">$${totalPendiente.toLocaleString()}</div>
                        <div style="font-size: 11px; color: #6b7280;">a cobrar</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #ef4444;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">VENCEN ESTE MES</div>
                        <div style="font-size: 32px; font-weight: 800; color: #ef4444;">${cuotasVencenEsteMes}</div>
                        <div style="font-size: 11px; color: #6b7280;">cuotas</div>
                    </div>
                </div>
                
                <!-- Botones de acci√≥n -->
                <div style="display: flex; gap: 10px; margin-bottom: 25px;">
                    <button class="btn-primary" onclick="nuevoPlanCuotas()">
                        ‚ûï NUEVA VENTA EN CUOTAS
                    </button>
                    <button class="btn-primary" style="background: #10b981;" onclick="registrarPagoCuota()">
                        üíµ REGISTRAR PAGO
                    </button>
                    <button class="btn-primary" style="background: #3b82f6;" onclick="exportarPlanCuotas()">
                        üì• EXPORTAR EXCEL
                    </button>
                </div>
                
                <!-- Tabla de planes de cuotas -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Planes de Pago Activos</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Plan</th>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Total</th>
                                    <th>Cuotas</th>
                                    <th>$ Cuota</th>
                                    <th>Pagadas</th>
                                    <th>Pr√≥x. Venc.</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${ventasEnCuotas.map(v => {
                                    const porcentajePagado = (v.pagadas / v.cuotas) * 100;
                                    const cuotasPendientes = v.cuotas - v.pagadas;
                                    
                                    return `
                                        <tr>
                                            <td style="font-family: monospace; font-weight: 700;">${v.id}</td>
                                            <td>${v.fecha}</td>
                                            <td style="font-weight: 600;">${v.cliente}</td>
                                            <td style="font-weight: 700; font-size: 16px;">$${v.total.toLocaleString()}</td>
                                            <td style="text-align: center;">${v.cuotas}</td>
                                            <td style="font-weight: 700;">$${v.cuotaMensual.toLocaleString()}</td>
                                            <td>
                                                <div style="display: flex; align-items: center; gap: 8px;">
                                                    <div style="flex: 1; background: #e5e7eb; border-radius: 10px; height: 8px; overflow: hidden;">
                                                        <div style="background: #10b981; height: 100%; width: ${porcentajePagado}%;"></div>
                                                    </div>
                                                    <span style="font-weight: 700; min-width: 50px;">${v.pagadas}/${v.cuotas}</span>
                                                </div>
                                            </td>
                                            <td style="font-size: 13px;">${v.proxVencimiento}</td>
                                            <td>
                                                <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; margin-right: 5px;" 
                                                    onclick="verDetallePlan('${v.id}')">
                                                    üëÅÔ∏è Ver
                                                </button>
                                                <button class="btn-primary" style="padding: 6px 12px; font-size: 12px; background: #10b981;" 
                                                    onclick="pagarCuota('${v.id}')">
                                                    üíµ Pagar
                                                </button>
                                            </td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Alertas de vencimientos pr√≥ximos -->
                <div class="card" style="margin-top: 30px; border-left: 4px solid #f59e0b;">
                    <div class="card-header">
                        <h3 class="card-title">‚ö†Ô∏è Vencimientos Pr√≥ximos (15 d√≠as)</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                            ${ventasEnCuotas.slice(0, 3).map(v => `
                                <div style="padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 3px solid #f59e0b;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span style="font-weight: 700; color: #92400e;">${v.cliente}</span>
                                        <span style="font-family: monospace; color: #6b7280;">${v.id}</span>
                                    </div>
                                    <div style="font-size: 24px; font-weight: 800; color: #f59e0b; margin-bottom: 5px;">
                                        $${v.cuotaMensual.toLocaleString()}
                                    </div>
                                    <div style="font-size: 12px; color: #92400e;">
                                        Vence: ${v.proxVencimiento}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function nuevoPlanCuotas() {
            alert('‚ûï NUEVA VENTA EN CUOTAS\n\n1. Seleccionar cliente\n2. Ingresar monto total\n3. Definir cantidad de cuotas\n4. Establecer d√≠a de vencimiento\n5. Generar plan de pagos\n\nüí° Funcionalidad en desarrollo');
        }
        
        function registrarPagoCuota() {
            alert('üíµ REGISTRAR PAGO DE CUOTA\n\n1. Buscar plan por ID o cliente\n2. Seleccionar cuota a pagar\n3. Ingresar monto\n4. Confirmar recibo\n\nüí° Funcionalidad en desarrollo');
        }
        
        function verDetallePlan(planId) {
            alert(`üëÅÔ∏è DETALLE DEL PLAN ${planId}\n\n‚Ä¢ Historial de pagos\n‚Ä¢ Cuotas pendientes\n‚Ä¢ Fechas de vencimiento\n‚Ä¢ Recibos generados\n‚Ä¢ Observaciones\n\nüí° Se puede implementar un modal con toda la informaci√≥n detallada`);
        }
        
        function pagarCuota(planId) {
            if (confirm(`üíµ REGISTRAR PAGO\n\nPlan: ${planId}\n\n¬øConfirmar pago de la pr√≥xima cuota?`)) {
                alert('‚úÖ PAGO REGISTRADO\n\nSe actualiz√≥ el plan de pagos\nSe gener√≥ el recibo autom√°ticamente');
            }
        }
        
        function exportarPlanCuotas() {
            alert('üì• EXPORTAR PLANES DE CUOTAS\n\nSe generar√° un Excel con:\n\n‚Ä¢ Todos los planes activos\n‚Ä¢ Detalle de cuotas pagadas/pendientes\n‚Ä¢ Vencimientos\n‚Ä¢ Totales por cliente\n\nüí° Funcionalidad en desarrollo');
        }



        // ==================== PERSONAL Y ACCESOS ====================
        const usuarios = [
            { id: 1, nombre: 'Mauricio Bruzzone', email: 'mauricio@bruzzone.com', rol: 'Administrador', activo: true, ultimoAcceso: '2026-02-01 09:30' },
            { id: 2, nombre: 'Ana Mart√≠nez', email: 'ana@bruzzone.com', rol: 'Vendedor', activo: true, ultimoAcceso: '2026-02-01 10:15' },
            { id: 3, nombre: 'Carlos G√≥mez', email: 'carlos@bruzzone.com', rol: 'Vendedor', activo: true, ultimoAcceso: '2026-01-31 18:45' },
            { id: 4, nombre: 'Laura Fern√°ndez', email: 'laura@bruzzone.com', rol: 'Contador', activo: true, ultimoAcceso: '2026-02-01 08:00' },
            { id: 5, nombre: 'Diego Silva', email: 'diego@bruzzone.com', rol: 'Dep√≥sito', activo: false, ultimoAcceso: '2026-01-15 17:20' }
        ];
        
        const roles = [
            { 
                nombre: 'Administrador', 
                permisos: ['Todos los m√≥dulos', 'Configuraci√≥n', 'Usuarios', 'Precios', 'Reportes'],
                color: '#ef4444'
            },
            { 
                nombre: 'Vendedor', 
                permisos: ['Ventas', 'Clientes', 'Remitos', 'Inventario (solo lectura)'],
                color: '#3b82f6'
            },
            { 
                nombre: 'Contador', 
                permisos: ['Finanzas', 'Contabilidad', 'Informes', 'Comprobantes'],
                color: '#10b981'
            },
            { 
                nombre: 'Dep√≥sito', 
                permisos: ['Inventario', 'Sucursales', 'Pedidos de Compra'],
                color: '#f59e0b'
            }
        ];
        
        
        

// ========== M√ìDULO DE PERSONAL Y ACCESOS COMPLETO ==========

function getPersonalAccesosHTML() {
    const usuariosActivos = usuarios.filter(u => u.activo).length;
    const ultimoAcceso = usuarios.length > 0 ? usuarios[0].ultimoAcceso : 'N/A';
    
    return `
        <div style="margin-bottom: 25px;">
            <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 5px;">üë• Personal y Accesos</h2>
            <p style="color: #6b7280;">Gesti√≥n de usuarios, roles y permisos del sistema</p>
        </div>
        
        <!-- M√©tricas -->
        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
            <div class="card" style="border-left: 4px solid #3b82f6;">
                <div style="font-size: 10px; color: #6b7280; font-weight: 600;">USUARIOS TOTALES</div>
                <div style="font-size: 32px; font-weight: 800; color: #3b82f6;">${usuarios.length}</div>
            </div>
            <div class="card" style="border-left: 4px solid #10b981;">
                <div style="font-size: 10px; color: #6b7280; font-weight: 600;">ACTIVOS</div>
                <div style="font-size: 32px; font-weight: 800; color: #10b981;">${usuariosActivos}</div>
            </div>
            <div class="card" style="border-left: 4px solid #f59e0b;">
                <div style="font-size: 10px; color: #6b7280; font-weight: 600;">ROLES</div>
                <div style="font-size: 32px; font-weight: 800; color: #f59e0b;">4</div>
            </div>
            <div class="card" style="border-left: 4px solid #8b5cf6;">
                <div style="font-size: 10px; color: #6b7280; font-weight: 600;">√öLTIMO ACCESO</div>
                <div style="font-size: 14px; font-weight: 700; color: #8b5cf6; margin-top: 10px;">${ultimoAcceso}</div>
            </div>
        </div>
        
        <!-- Pesta√±as -->
        <div style="display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 3px solid #e5e7eb;">
            <button class="btn-primary" style="background: ${pestanaPersonalActiva === 'usuarios' ? '#3b82f6' : '#6b7280'}; padding: 10px 20px;" 
                onclick="cambiarPestanaPersonal('usuarios')">üë§ Usuarios</button>
            <button class="btn-primary" style="background: ${pestanaPersonalActiva === 'roles' ? '#3b82f6' : '#6b7280'}; padding: 10px 20px;" 
                onclick="cambiarPestanaPersonal('roles')">üîê Roles y Permisos</button>
            <button class="btn-primary" style="background: ${pestanaPersonalActiva === 'auditoria' ? '#3b82f6' : '#6b7280'}; padding: 10px 20px;" 
                onclick="cambiarPestanaPersonal('auditoria')">üìä Auditor√≠a</button>
        </div>
        
        <div id="contenidoPersonal">${getContenidoPestanaPersonal()}</div>
    `;
}

let pestanaPersonalActiva = 'usuarios';

function cambiarPestanaPersonal(pestana) {
    pestanaPersonalActiva = pestana;
    cargarModulo('personal');
}

function getContenidoPestanaPersonal() {
    switch(pestanaPersonalActiva) {
        case 'roles': return getPestanaRoles();
        case 'auditoria': return getPestanaAuditoria();
        default: return getPestanaUsuarios();
    }
}

// ========== PESTA√ëA: USUARIOS ==========
function getPestanaUsuarios() {
    return `
        <div style="margin-bottom: 20px;">
            <button class="btn-primary" onclick="nuevoUsuario()">
                ‚ûï NUEVO USUARIO
            </button>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üë• Usuarios del Sistema</h3>
            </div>
            <div class="card-body">
                <table>
                    <thead>
                        <tr>
                            <th>Usuario</th>
                            <th>Email</th>
                            <th>Rol</th>
                            <th>√öltimo Acceso</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${usuarios.map(u => `
                            <tr>
                                <td>
                                    <div style="font-weight: 700; font-size: 14px;">${u.nombre}</div>
                                    <div style="font-size: 11px; color: #6b7280;">ID: ${u.id}</div>
                                </td>
                                <td style="font-family: monospace; font-size: 13px;">${u.email}</td>
                                <td>
                                    <span style="padding: 6px 12px; background: ${getRolColor(u.rol)}; color: white; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                        ${u.rol}
                                    </span>
                                </td>
                                <td style="font-size: 13px;">${u.ultimoAcceso}</td>
                                <td>
                                    <span style="padding: 6px 12px; background: ${u.activo ? '#dcfce7' : '#fee2e2'}; color: ${u.activo ? '#16a34a' : '#dc2626'}; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                        ${u.activo ? '‚úÖ ACTIVO' : 'üî¥ INACTIVO'}
                                    </span>
                                </td>
                                <td>
                                    <div style="display: flex; gap: 5px;">
                                        <button class="btn-primary" style="padding: 6px 12px; font-size: 11px;" 
                                            onclick="editarUsuario(${u.id})">
                                            ‚úèÔ∏è Editar
                                        </button>
                                        <button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: ${u.activo ? '#ef4444' : '#10b981'};" 
                                            onclick="toggleUsuario(${u.id})">
                                            ${u.activo ? 'üîí Desactivar' : '‚úÖ Activar'}
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

// ========== PESTA√ëA: ROLES Y PERMISOS ==========
function getPestanaRoles() {
    const roles = [
        { id: 1, nombre: 'Administrador', usuarios: usuarios.filter(u => u.rol === 'Administrador').length, permisos: 'Acceso total', color: '#ef4444' },
        { id: 2, nombre: 'Vendedor', usuarios: usuarios.filter(u => u.rol === 'Vendedor').length, permisos: 'Ventas, Clientes, Inventario', color: '#3b82f6' },
        { id: 3, nombre: 'Contador', usuarios: usuarios.filter(u => u.rol === 'Contador').length, permisos: 'Finanzas, Informes, Contabilidad', color: '#10b981' },
        { id: 4, nombre: 'Dep√≥sito', usuarios: usuarios.filter(u => u.rol === 'Dep√≥sito').length, permisos: 'Inventario, Compras, Remitos', color: '#f59e0b' }
    ];
    
    return `
        <div style="margin-bottom: 20px;">
            <button class="btn-primary" onclick="nuevoRol()">
                ‚ûï NUEVO ROL
            </button>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
            ${roles.map(r => `
                <div class="card" style="border-left: 4px solid ${r.color};">
                    <div class="card-header" style="background: ${r.color}10;">
                        <h3 style="font-weight: 800; color: ${r.color}; font-size: 18px;">${r.nombre}</h3>
                    </div>
                    <div class="card-body">
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">USUARIOS CON ESTE ROL</div>
                            <div style="font-size: 32px; font-weight: 800; color: ${r.color};">${r.usuarios}</div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 8px;">PERMISOS</div>
                            <div style="font-size: 13px; color: #374151; line-height: 1.6;">
                                ${r.permisos.split(', ').map(p => `<div>‚úÖ ${p}</div>`).join('')}
                            </div>
                        </div>
                        
                        <button class="btn-primary" style="width: 100%; padding: 10px; font-size: 13px;" 
                            onclick="editarPermisos(${r.id})">
                            ‚öôÔ∏è CONFIGURAR PERMISOS
                        </button>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

// ========== PESTA√ëA: AUDITOR√çA ==========
function getPestanaAuditoria() {
    const registros = [
        { id: 1, usuario: 'Mauricio Bruzzone', accion: 'Inici√≥ sesi√≥n', modulo: 'Sistema', fecha: '2026-02-01 09:15', ip: '192.168.1.45' },
        { id: 2, usuario: 'Mauricio Bruzzone', accion: 'Cre√≥ producto nuevo', modulo: 'Inventario', fecha: '2026-02-01 09:32', ip: '192.168.1.45' },
        { id: 3, usuario: 'Juan P√©rez', accion: 'Registr√≥ venta', modulo: 'Ventas', fecha: '2026-02-01 10:15', ip: '192.168.1.67' },
        { id: 4, usuario: 'Mauricio Bruzzone', accion: 'Actualiz√≥ precios', modulo: 'Compras', fecha: '2026-02-01 11:00', ip: '192.168.1.45' },
        { id: 5, usuario: 'Mar√≠a Garc√≠a', accion: 'Export√≥ informe', modulo: 'Finanzas', fecha: '2026-02-01 14:30', ip: '192.168.1.89' }
    ];
    
    return `
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">üìä Registro de Auditor√≠a</h3>
            </div>
            <div class="card-body">
                <!-- Filtros -->
                <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                    <select style="padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; flex: 1;">
                        <option>Todos los usuarios</option>
                        ${usuarios.map(u => `<option>${u.nombre}</option>`).join('')}
                    </select>
                    <select style="padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; flex: 1;">
                        <option>Todos los m√≥dulos</option>
                        <option>Sistema</option>
                        <option>Ventas</option>
                        <option>Inventario</option>
                        <option>Compras</option>
                        <option>Finanzas</option>
                    </select>
                    <input type="date" style="padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px;">
                    <button class="btn-primary" onclick="filtrarAuditoria()">üîç Filtrar</button>
                    <button class="btn-primary" style="background: #10b981;" onclick="exportarAuditoria()">üì• Exportar</button>
                </div>
                
                <!-- Registros -->
                <table>
                    <thead>
                        <tr>
                            <th>Fecha/Hora</th>
                            <th>Usuario</th>
                            <th>Acci√≥n</th>
                            <th>M√≥dulo</th>
                            <th>IP</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${registros.map(r => `
                            <tr>
                                <td style="font-family: monospace; font-size: 12px; font-weight: 600;">${r.fecha}</td>
                                <td style="font-weight: 600;">${r.usuario}</td>
                                <td>${r.accion}</td>
                                <td>
                                    <span style="padding: 4px 10px; background: #f3f4f6; color: #374151; font-weight: 600; border-radius: 6px; font-size: 11px;">
                                        ${r.modulo}
                                    </span>
                                </td>
                                <td style="font-family: monospace; font-size: 12px; color: #6b7280;">${r.ip}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
        </div>
    `;
}

// ========== FUNCIONES DE USUARIOS ==========

function nuevoUsuario() {
    const nombre = prompt('üë§ NUEVO USUARIO\n\nNombre completo:', '');
    if (!nombre) return;
    
    const email = prompt('Email de acceso:', '');
    if (!email) return;
    
    const roles = ['Administrador', 'Vendedor', 'Contador', 'Dep√≥sito'];
    let rolSeleccionado = '';
    
    for (let i = 0; i < roles.length; i++) {
        if (confirm(`¬øAsignar rol de ${roles[i]}?`)) {
            rolSeleccionado = roles[i];
            break;
        }
    }
    
    if (!rolSeleccionado) rolSeleccionado = 'Vendedor';
    
    usuarios.push({
        id: usuarios.length + 1,
        nombre: nombre,
        email: email,
        rol: rolSeleccionado,
        ultimoAcceso: 'Nunca',
        activo: true
    });
    
    alert(`‚úÖ USUARIO CREADO\n\nNombre: ${nombre}\nEmail: ${email}\nRol: ${rolSeleccionado}\n\nüìß Se envi√≥ email con contrase√±a temporal`);
    
    cargarModulo('personal');
}

function editarUsuario(id) {
    const usuario = usuarios.find(u => u.id === id);
    if (!usuario) return;
    
    const nuevoNombre = prompt('Nombre completo:', usuario.nombre);
    if (!nuevoNombre) return;
    
    const nuevoEmail = prompt('Email:', usuario.email);
    if (!nuevoEmail) return;
    
    usuario.nombre = nuevoNombre;
    usuario.email = nuevoEmail;
    
    alert(`‚úÖ USUARIO ACTUALIZADO\n\n${nuevoNombre}\n${nuevoEmail}`);
    
    cargarModulo('personal');
}

function toggleUsuario(id) {
    const usuario = usuarios.find(u => u.id === id);
    if (!usuario) return;
    
    usuario.activo = !usuario.activo;
    
    alert(`${usuario.activo ? '‚úÖ USUARIO ACTIVADO' : 'üîí USUARIO DESACTIVADO'}\n\n${usuario.nombre}\n${usuario.email}`);
    
    cargarModulo('personal');
}

function nuevoRol() {
    const nombre = prompt('üîê NUEVO ROL\n\nNombre del rol:', '');
    if (!nombre) return;
    
    alert(`‚úÖ ROL CREADO\n\n${nombre}\n\nAhora pod√©s configurar los permisos espec√≠ficos para este rol.`);
    
    cargarModulo('personal');
}

function editarPermisos(rolId) {
    const roles = ['Administrador', 'Vendedor', 'Contador', 'Dep√≥sito'];
    const rol = roles[rolId - 1];
    
    alert(`‚öôÔ∏è CONFIGURAR PERMISOS\n\nRol: ${rol}\n\nSeleccion√° los m√≥dulos a los que este rol tendr√° acceso:\n\n‚òëÔ∏è Dashboard\n‚òëÔ∏è Ventas\n‚òëÔ∏è Inventario\n‚òê Finanzas\n‚òê Contabilidad\n‚òëÔ∏è Clientes\n‚òê Compras\n\n[Guardar Cambios]`);
}

function filtrarAuditoria() {
    alert('üîç FILTROS APLICADOS\n\nRegistros actualizados seg√∫n criterios seleccionados');
}

function exportarAuditoria() {
    alert('üì• EXPORTAR AUDITOR√çA\n\nGenerando archivo Excel con:\n\n‚Ä¢ Todos los registros filtrados\n‚Ä¢ Fecha y hora\n‚Ä¢ Usuario y acci√≥n\n‚Ä¢ M√≥dulo e IP\n\n‚úÖ Descarga iniciada');
}

function getRolColor(rol) {
    const colores = {
        'Administrador': '#ef4444',
        'Vendedor': '#3b82f6',
        'Contador': '#10b981',
        'Dep√≥sito': '#f59e0b'
    };
    return colores[rol] || '#6b7280';
}

        function getProveedoresHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üöö Proveedores</h2>
                    <p style="color: #6b7280;">Gesti√≥n de proveedores y condiciones comerciales</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="nuevoProveedor()">
                        ‚ûï NUEVO PROVEEDOR
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Listado de Proveedores</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Proveedor</th>
                                    <th>CUIT</th>
                                    <th>Contacto</th>
                                    <th>Descuento</th>
                                    <th>Condici√≥n de Pago</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${proveedores.map(p => `
                                    <tr>
                                        <td style="font-weight: 700;">${p.nombre}</td>
                                        <td style="font-family: monospace;">${p.cuit}</td>
                                        <td>
                                            <div style="font-size: 13px;">${p.telefono}</div>
                                            <div style="font-size: 12px; color: #6b7280;">${p.email}</div>
                                        </td>
                                        <td style="font-weight: 700; color: #10b981;">${p.descuento}%</td>
                                        <td>${p.condicion}</td>
                                        <td>
                                            <button class="btn-primary" style="padding: 6px 12px; font-size: 12px;" onclick="editarProveedor(${p.id})">
                                                ‚úèÔ∏è Editar
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function nuevoProveedor() {
            const nombre = prompt('üöö NUEVO PROVEEDOR\n\nRaz√≥n Social:', '');
            if (!nombre) return;
            const cuit = prompt('CUIT:', '');
            if (!cuit) return;
            const telefono = prompt('Tel√©fono:', '');
            const email = prompt('Email:', '');
            const descuento = prompt('Descuento habitual (%):', '0');
            alert(`‚úÖ PROVEEDOR CREADO\n\nRaz√≥n Social: ${nombre}\nCUIT: ${cuit}\nTel√©fono: ${telefono}\nEmail: ${email}\nDescuento: ${descuento}%`);
            cargarModulo('proveedores');
        }
        
        function editarProveedor(id) {
            const prov = proveedores.find(p => p.id === id);
            if (prov) {
                const nuevoNombre = prompt('Raz√≥n Social:', prov.nombre);
                if (!nuevoNombre) return;
                const nuevoTelefono = prompt('Tel√©fono:', prov.telefono);
                const nuevoDescuento = prompt('Descuento (%):', prov.descuento);
                alert(`‚úÖ PROVEEDOR ACTUALIZADO\n\n${nuevoNombre}\nTel√©fono: ${nuevoTelefono}\nDescuento: ${nuevoDescuento}%`);
                cargarModulo('proveedores');
            }
        }

        // ==================== LISTAS DE PRECIO ====================
        const listasPrecio = [
            { id: 1, nombre: 'Lista Base', descripcion: 'Precio mayorista est√°ndar', activa: true },
            { id: 2, nombre: 'Lista Minorista', descripcion: 'Precio p√∫blico con margen', activa: true },
            { id: 3, nombre: 'Lista VIP', descripcion: 'Descuento para clientes especiales', activa: true }
        ];
        
        function getListaPreciosHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üí∞ Listas de Precio</h2>
                    <p style="color: #6b7280;">Gesti√≥n de m√∫ltiples listas y estrategias de precios</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="nuevaListaPrecio()">
                        ‚ûï NUEVA LISTA
                    </button>
                    <button class="btn-primary" style="background: #3b82f6; margin-left: 10px;" onclick="actualizarPrecios()">
                        üîÑ ACTUALIZAR PRECIOS
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Listas Configuradas</h3>
                    </div>
                    <div class="card-body">
                        ${listasPrecio.map(lista => `
                            <div style="padding: 20px; background: #f9fafb; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid ${lista.activa ? '#10b981' : '#6b7280'};">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <h4 style="font-size: 18px; font-weight: 700; margin-bottom: 5px;">${lista.nombre}</h4>
                                        <p style="color: #6b7280; margin-bottom: 10px;">${lista.descripcion}</p>
                                        <span style="padding: 4px 12px; background: ${lista.activa ? '#dcfce7' : '#e5e7eb'}; color: ${lista.activa ? '#16a34a' : '#6b7280'}; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                            ${lista.activa ? '‚úÖ ACTIVA' : '‚õî INACTIVA'}
                                        </span>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="editarLista(${lista.id})">
                                            ‚úèÔ∏è Editar
                                        </button>
                                        <button class="btn-primary" style="padding: 8px 16px; font-size: 13px; background: #3b82f6;" onclick="verProductosLista(${lista.id})">
                                            üëÅÔ∏è Ver Productos
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function nuevaListaPrecio() {
            alert('‚ûï NUEVA LISTA DE PRECIO\n\n‚Ä¢ Nombre de la lista\n‚Ä¢ Descripci√≥n\n‚Ä¢ Margen o descuento\n‚Ä¢ Productos incluidos\n\nüí° Funcionalidad en desarrollo');
        }
        
        function editarLista(id) {
            alert('‚úèÔ∏è EDITAR LISTA\n\nüí° Funcionalidad en desarrollo');
        }
        
        function verProductosLista(id) {
            alert('üëÅÔ∏è VER PRODUCTOS\n\nListado de productos con precios de esta lista\n\nüí° Funcionalidad en desarrollo');
        }
        
        function actualizarPrecios() {
            alert('üîÑ ACTUALIZAR PRECIOS\n\nOpciones:\n‚Ä¢ Ajuste por porcentaje\n‚Ä¢ Ajuste por monto fijo\n‚Ä¢ Aplicar a categor√≠as\n‚Ä¢ Redondeo\n\nüí° Funcionalidad en desarrollo');
        }

        // ==================== PEDIDOS DE COMPRA ====================
        const pedidosCompra = [
            { id: 1, fecha: '2026-02-01', proveedor: 'Distribuidora Walker', items: 15, total: 450000, estado: 'Pendiente' },
            { id: 2, fecha: '2026-01-28', proveedor: 'Ferreter√≠a Mayorista SA', items: 8, total: 125000, estado: 'Recibido' }
        ];
        
        function getPedidosCompraHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üì¶ Pedidos de Compra</h2>
                    <p style="color: #6b7280;">Gesti√≥n de pedidos a proveedores</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="nuevoPedidoCompra()">
                        ‚ûï NUEVO PEDIDO
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Pedidos Realizados</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Pedido</th>
                                    <th>Fecha</th>
                                    <th>Proveedor</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${pedidosCompra.map(p => `
                                    <tr>
                                        <td style="font-family: monospace; font-weight: 700;">PC-${String(p.id).padStart(3, '0')}</td>
                                        <td>${p.fecha}</td>
                                        <td style="font-weight: 600;">${p.proveedor}</td>
                                        <td style="text-align: center;">${p.items}</td>
                                        <td style="font-weight: 700; font-size: 16px;">$${p.total.toLocaleString()}</td>
                                        <td>
                                            <span style="padding: 6px 12px; background: ${p.estado === 'Pendiente' ? '#fef3c7' : '#dcfce7'}; color: ${p.estado === 'Pendiente' ? '#f59e0b' : '#10b981'}; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${p.estado === 'Pendiente' ? '‚è≥ PENDIENTE' : '‚úÖ RECIBIDO'}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn-primary" style="padding: 6px 12px; font-size: 12px;" onclick="verPedido(${p.id})">
                                                üëÅÔ∏è Ver
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function nuevoPedidoCompra() {
            const proveedor = prompt('üìù NUEVO PEDIDO DE COMPRA\n\nSeleccionar proveedor:', 'Distribuidora Walker');
            if (!proveedor) return;
            const items = prompt('Cantidad de items:', '5');
            const total = prompt('Total estimado:', '50000');
            alert(`‚úÖ PEDIDO CREADO\n\nProveedor: ${proveedor}\nItems: ${items}\nTotal estimado: $${parseFloat(total).toLocaleString()}\nEstado: ‚è≥ PENDIENTE`);
            cargarModulo('pedidos-compra');
        }
        
        function verPedido(id) {
            alert(`üëÅÔ∏è VER PEDIDO PC-${String(id).padStart(3, '0')}\n\nDetalle del pedido\n\nüí° Funcionalidad en desarrollo`);
        }



        // ==================== INFORMES E IVA ====================
        let pestanaInformesActiva = 'ventas';
        
        function getInformesHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üìä Informes e IVA</h2>
                    <p style="color: #6b7280;">Reportes de ventas, compras y c√°lculo de IVA</p>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 3px solid #e5e7eb;">
                    <button class="btn-primary" style="background: ${pestanaInformesActiva === 'ventas' ? '#3b82f6' : '#6b7280'}; border-radius: 8px 8px 0 0;" 
                        onclick="cambiarPestanaInformes('ventas')">
                        üí∞ Ventas
                    </button>
                    <button class="btn-primary" style="background: ${pestanaInformesActiva === 'iva' ? '#3b82f6' : '#6b7280'}; border-radius: 8px 8px 0 0;" 
                        onclick="cambiarPestanaInformes('iva')">
                        üìã IVA
                    </button>
                </div>
                
                <div id="contenidoInformes">
                    ${getContenidoPestanaInformes()}
                </div>
            `;
        }
        
        function cambiarPestanaInformes(pestana) {
            pestanaInformesActiva = pestana;
            cargarModulo('informes-iva');
        }
        
        function getContenidoPestanaInformes() {
            if (pestanaInformesActiva === 'iva') {
                return getPestanaInformesIVA();
            }
            return getPestanaInformesVentas();
        }
        
        function getPestanaInformesVentas() {
            const totalVentas = remitos.length * 150000;
            const totalIVA = totalVentas * 0.21;
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üí∞ Informe de Ventas del Mes</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                            <div style="text-align: center; padding: 20px; background: #f0f9ff; border-radius: 12px;">
                                <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 10px;">VENTAS TOTALES</div>
                                <div style="font-size: 36px; font-weight: 800; color: #3b82f6;">$${totalVentas.toLocaleString()}</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: #f0fdf4; border-radius: 12px;">
                                <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 10px;">IVA GENERADO</div>
                                <div style="font-size: 36px; font-weight: 800; color: #10b981;">$${totalIVA.toLocaleString()}</div>
                            </div>
                            <div style="text-align: center; padding: 20px; background: #fef3c7; border-radius: 12px;">
                                <div style="font-size: 12px; color: #6b7280; font-weight: 600; margin-bottom: 10px;">OPERACIONES</div>
                                <div style="font-size: 36px; font-weight: 800; color: #f59e0b;">${remitos.length}</div>
                            </div>
                        </div>
                        
                        <button class="btn-primary" onclick="exportarInforme()">
                            üì• EXPORTAR A EXCEL
                        </button>
                    </div>
                </div>
            `;
        }
        
        function getPestanaInformesIVA() {
            const ivaVentas = remitos.length * 150000 * 0.21;
            const ivaCompras = 85000;
            const ivaAPagar = ivaVentas - ivaCompras;
            
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã C√°lculo de IVA - Febrero 2026</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                            <div style="padding: 25px; background: #dcfce7; border-radius: 12px; border-left: 4px solid #10b981;">
                                <div style="font-size: 12px; color: #166534; font-weight: 600; margin-bottom: 10px;">IVA VENTAS (D√©bito Fiscal)</div>
                                <div style="font-size: 42px; font-weight: 800; color: #10b981; margin-bottom: 5px;">$${ivaVentas.toLocaleString()}</div>
                                <div style="font-size: 13px; color: #166534;">A favor del fisco</div>
                            </div>
                            
                            <div style="padding: 25px; background: #fef3c7; border-radius: 12px; border-left: 4px solid #f59e0b;">
                                <div style="font-size: 12px; color: #92400e; font-weight: 600; margin-bottom: 10px;">IVA COMPRAS (Cr√©dito Fiscal)</div>
                                <div style="font-size: 42px; font-weight: 800; color: #f59e0b; margin-bottom: 5px;">$${ivaCompras.toLocaleString()}</div>
                                <div style="font-size: 13px; color: #92400e;">A favor de la empresa</div>
                            </div>
                            
                            <div style="padding: 25px; background: ${ivaAPagar > 0 ? '#fee2e2' : '#dcfce7'}; border-radius: 12px; border-left: 4px solid ${ivaAPagar > 0 ? '#ef4444' : '#10b981'};">
                                <div style="font-size: 12px; color: ${ivaAPagar > 0 ? '#991b1b' : '#166534'}; font-weight: 600; margin-bottom: 10px;">SALDO A ${ivaAPagar > 0 ? 'PAGAR' : 'FAVOR'}</div>
                                <div style="font-size: 42px; font-weight: 800; color: ${ivaAPagar > 0 ? '#ef4444' : '#10b981'}; margin-bottom: 5px;">$${Math.abs(ivaAPagar).toLocaleString()}</div>
                                <div style="font-size: 13px; color: ${ivaAPagar > 0 ? '#991b1b' : '#166534'};">${ivaAPagar > 0 ? 'Pagar en AFIP' : 'Cr√©dito para pr√≥ximo per√≠odo'}</div>
                            </div>
                        </div>
                        
                        <div style="display: flex; gap: 10px;">
                            <button class="btn-primary" onclick="generarDJIVA()">
                                üìÑ GENERAR DDJJ
                            </button>
                            <button class="btn-primary" style="background: #3b82f6;" onclick="exportarLibroIVA()">
                                üì• LIBRO IVA VENTAS
                            </button>
                            <button class="btn-primary" style="background: #10b981;" onclick="exportarLibroIVA()">
                                üì• LIBRO IVA COMPRAS
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function exportarInforme() {
            alert('üì• EXPORTAR INFORME\n\nSe generar√° un archivo Excel con:\n‚Ä¢ Detalle de ventas\n‚Ä¢ Totales por per√≠odo\n‚Ä¢ IVA generado\n\nüí° Funcionalidad en desarrollo');
        }
        
        function generarDJIVA() {
            alert('üìÑ GENERAR DDJJ IVA\n\nSe generar√°:\n‚Ä¢ Declaraci√≥n jurada\n‚Ä¢ Formato AFIP\n‚Ä¢ Detalle de comprobantes\n\nüí° Funcionalidad en desarrollo');
        }
        
        function exportarLibroIVA() {
            alert('üì• EXPORTAR LIBRO IVA\n\nSe generar√°:\n‚Ä¢ Libro digital\n‚Ä¢ Formato AFIP\n‚Ä¢ Validaciones incluidas\n\nüí° Funcionalidad en desarrollo');
        }

        // ==================== FINANZAS ====================
        function getFinanzasHTML() {
            const totalCajas = cajas.reduce((sum, c) => sum + c.saldo, 0);
            const cuentasPorCobrar = clientes.filter(c => c.saldo > 0).reduce((sum, c) => sum + c.saldo, 0);
            const valorInventario = productos.reduce((sum, p) => sum + (p.stock * p.precio), 0);
            const activoTotal = totalCajas + cuentasPorCobrar + valorInventario;
            
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üí∞ Finanzas</h2>
                    <p style="color: #6b7280;">Dashboard financiero y an√°lisis patrimonial</p>
                </div>
                
                <!-- Indicadores Principales -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                    <div class="card" style="border-left: 4px solid #10b981;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">EFECTIVO EN CAJAS</div>
                        <div style="font-size: 36px; font-weight: 800; color: #10b981;">$${(totalCajas/1000).toFixed(0)}K</div>
                        <div style="font-size: 11px; color: #6b7280;">Liquidez inmediata</div>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #f59e0b;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">CUENTAS POR COBRAR</div>
                        <div style="font-size: 36px; font-weight: 800; color: #f59e0b;">$${(cuentasPorCobrar/1000).toFixed(0)}K</div>
                        <div style="font-size: 11px; color: #6b7280;">A recuperar</div>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">VALOR INVENTARIO</div>
                        <div style="font-size: 36px; font-weight: 800; color: #3b82f6;">$${(valorInventario/1000000).toFixed(1)}M</div>
                        <div style="font-size: 11px; color: #6b7280;">Stock valorizado</div>
                    </div>
                    
                    <div class="card" style="border-left: 4px solid #8b5cf6;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 5px;">ACTIVO TOTAL</div>
                        <div style="font-size: 36px; font-weight: 800; color: #8b5cf6;">$${(activoTotal/1000000).toFixed(1)}M</div>
                        <div style="font-size: 11px; color: #6b7280;">Patrimonio</div>
                    </div>
                </div>
                
                <!-- Gr√°fico de Composici√≥n -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìä Composici√≥n del Activo</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: flex; gap: 30px; align-items: center;">
                            <div style="flex: 1;">
                                <div style="margin-bottom: 20px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span style="font-weight: 600;">üí∞ Efectivo</span>
                                        <span style="font-weight: 700; color: #10b981;">${((totalCajas/activoTotal)*100).toFixed(1)}%</span>
                                    </div>
                                    <div style="background: #e5e7eb; height: 12px; border-radius: 10px; overflow: hidden;">
                                        <div style="background: #10b981; height: 100%; width: ${((totalCajas/activoTotal)*100).toFixed(1)}%;"></div>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom: 20px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span style="font-weight: 600;">üí≥ Cuentas por Cobrar</span>
                                        <span style="font-weight: 700; color: #f59e0b;">${((cuentasPorCobrar/activoTotal)*100).toFixed(1)}%</span>
                                    </div>
                                    <div style="background: #e5e7eb; height: 12px; border-radius: 10px; overflow: hidden;">
                                        <div style="background: #f59e0b; height: 100%; width: ${((cuentasPorCobrar/activoTotal)*100).toFixed(1)}%;"></div>
                                    </div>
                                </div>
                                
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                        <span style="font-weight: 600;">üì¶ Inventario</span>
                                        <span style="font-weight: 700; color: #3b82f6;">${((valorInventario/activoTotal)*100).toFixed(1)}%</span>
                                    </div>
                                    <div style="background: #e5e7eb; height: 12px; border-radius: 10px; overflow: hidden;">
                                        <div style="background: #3b82f6; height: 100%; width: ${((valorInventario/activoTotal)*100).toFixed(1)}%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }



        


        


        



        // ==================== SUCURSALES ====================
        const sucursales = [
            { id: 1, nombre: 'Casa Central', direccion: 'Dr. Carlos Rocha 128, Alejandro Roca', activa: true, stock: {} },
            { id: 2, nombre: 'Sucursal Norte', direccion: 'Av. Libertad 450', activa: true, stock: {} }
        ];
        
        function getSucursalesHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üè¢ Sucursales</h2>
                    <p style="color: #6b7280;">Gesti√≥n de sucursales y stock por ubicaci√≥n</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" onclick="nuevaSucursal()">
                        ‚ûï NUEVA SUCURSAL
                    </button>
                    <button class="btn-primary" style="background: #3b82f6; margin-left: 10px;" onclick="transferirStock()">
                        üîÑ TRANSFERIR STOCK
                    </button>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Sucursales Configuradas</h3>
                    </div>
                    <div class="card-body">
                        ${sucursales.map(s => `
                            <div style="padding: 20px; background: #f9fafb; border-radius: 12px; margin-bottom: 15px; border-left: 4px solid ${s.activa ? '#10b981' : '#6b7280'};">
                                <div style="display: flex; justify-content: space-between; align-items: start;">
                                    <div style="flex: 1;">
                                        <h4 style="font-size: 18px; font-weight: 700; margin-bottom: 5px;">${s.nombre}</h4>
                                        <p style="color: #6b7280; margin-bottom: 10px;">${s.direccion}</p>
                                        <span style="padding: 4px 12px; background: ${s.activa ? '#dcfce7' : '#e5e7eb'}; color: ${s.activa ? '#16a34a' : '#6b7280'}; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                            ${s.activa ? '‚úÖ ACTIVA' : '‚õî INACTIVA'}
                                        </span>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn-primary" style="padding: 8px 16px; font-size: 13px;" onclick="editarSucursal(${s.id})">
                                            ‚úèÔ∏è Editar
                                        </button>
                                        <button class="btn-primary" style="padding: 8px 16px; font-size: 13px; background: #3b82f6;" onclick="verStockSucursal(${s.id})">
                                            üì¶ Ver Stock
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }
        
        function nuevaSucursal() {
            alert('‚ûï NUEVA SUCURSAL\n\n‚Ä¢ Nombre\n‚Ä¢ Direcci√≥n\n‚Ä¢ Configuraci√≥n inicial\n\nüí° Funcionalidad en desarrollo');
        }
        
        function editarSucursal(id) {
            alert(`‚úèÔ∏è EDITAR SUCURSAL\n\nüí° Funcionalidad en desarrollo`);
        }
        
        function verStockSucursal(id) {
            alert(`üì¶ STOCK DE SUCURSAL\n\nStock disponible por producto\n\nüí° Funcionalidad en desarrollo`);
        }
        
        function transferirStock() {
            alert('üîÑ TRANSFERIR STOCK\n\n1. Sucursal origen\n2. Sucursal destino\n3. Productos y cantidades\n4. Generar remito interno\n\nüí° Funcionalidad en desarrollo');
        }

        // ==================== CONTABILIDAD ====================
        let pestanaContabilidadActiva = 'impuestos';
        
        function getContabilidadHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üìä Contabilidad</h2>
                    <p style="color: #6b7280;">Gesti√≥n fiscal y an√°lisis financiero completo</p>
                </div>
                
                <div style="display: flex; gap: 10px; margin-bottom: 30px; border-bottom: 3px solid #e5e7eb; flex-wrap: wrap;">
                    <button class="btn-primary" style="background: ${pestanaContabilidadActiva === 'impuestos' ? '#3b82f6' : '#6b7280'}; border-radius: 8px 8px 0 0;" 
                        onclick="cambiarPestanaContabilidad('impuestos')">
                        üèõÔ∏è Impuestos
                    </button>
                    <button class="btn-primary" style="background: ${pestanaContabilidadActiva === 'asientos' ? '#3b82f6' : '#6b7280'}; border-radius: 8px 8px 0 0;" 
                        onclick="cambiarPestanaContabilidad('asientos')">
                        üìù Asientos
                    </button>
                    <button class="btn-primary" style="background: ${pestanaContabilidadActiva === 'resultados' ? '#3b82f6' : '#6b7280'}; border-radius: 8px 8px 0 0;" 
                        onclick="cambiarPestanaContabilidad('resultados')">
                        üí∞ Resultados
                    </button>
                </div>
                
                <div id="contenidoContabilidad">
                    ${getContenidoPestanaContabilidad()}
                </div>
            `;
        }
        
        function cambiarPestanaContabilidad(pestana) {
            pestanaContabilidadActiva = pestana;
            cargarModulo('contabilidad');
        }
        
        function getContenidoPestanaContabilidad() {
            if (pestanaContabilidadActiva === 'asientos') {
                return getPestanaAsientos();
            } else if (pestanaContabilidadActiva === 'resultados') {
                return getPestanaResultados();
            }
            return getPestanaImpuestos();
        }
        
        function getPestanaImpuestos() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üèõÔ∏è Impuestos y Tasas Municipales</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px;">
                            <div style="padding: 20px; background: #dbeafe; border-radius: 12px; text-align: center;">
                                <div style="font-size: 13px; color: #1e40af; font-weight: 600; margin-bottom: 10px;">IVA</div>
                                <div style="font-size: 36px; font-weight: 800; color: #3b82f6; margin-bottom: 5px;">$125K</div>
                                <div style="font-size: 12px; color: #1e40af;">Este mes</div>
                            </div>
                            <div style="padding: 20px; background: #fef3c7; border-radius: 12px; text-align: center;">
                                <div style="font-size: 13px; color: #92400e; font-weight: 600; margin-bottom: 10px;">INGRESOS BRUTOS</div>
                                <div style="font-size: 36px; font-weight: 800; color: #f59e0b; margin-bottom: 5px;">$45K</div>
                                <div style="font-size: 12px; color: #92400e;">Este mes</div>
                            </div>
                            <div style="padding: 20px; background: #dcfce7; border-radius: 12px; text-align: center;">
                                <div style="font-size: 13px; color: #166534; font-weight: 600; margin-bottom: 10px;">TASAS MUNICIPALES</div>
                                <div style="font-size: 36px; font-weight: 800; color: #10b981; margin-bottom: 5px;">$18K</div>
                                <div style="font-size: 12px; color: #166534;">Este mes</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getPestanaAsientos() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìù Asientos Contables</h3>
                    </div>
                    <div class="card-body">
                        <button class="btn-primary" onclick="nuevoAsiento()">
                            ‚ûï NUEVO ASIENTO
                        </button>
                        <p style="margin-top: 20px; color: #6b7280;">Sistema de registraci√≥n contable por partida doble</p>
                    </div>
                </div>
            `;
        }
        
        function getPestanaResultados() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üí∞ Estado de Resultados</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 15px; color: #10b981;">INGRESOS</h4>
                                <div style="font-size: 32px; font-weight: 800; color: #10b981;">$1,250,000</div>
                            </div>
                            <div>
                                <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 15px; color: #ef4444;">EGRESOS</h4>
                                <div style="font-size: 32px; font-weight: 800; color: #ef4444;">$850,000</div>
                            </div>
                        </div>
                        <div style="margin-top: 30px; padding: 20px; background: #dbeafe; border-radius: 12px;">
                            <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 10px; color: #1e40af;">RESULTADO NETO</h4>
                            <div style="font-size: 48px; font-weight: 800; color: #3b82f6;">$400,000</div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function nuevoAsiento() {
            alert('‚ûï NUEVO ASIENTO CONTABLE\n\n‚Ä¢ Fecha\n‚Ä¢ Debe y Haber\n‚Ä¢ Cuentas contables\n‚Ä¢ Detalle\n\nüí° Funcionalidad en desarrollo');
        }

        // ==================== COMPROBANTES ====================
        function getComprobantesHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 5px;">üìÑ Comprobantes</h2>
                    <p style="color: #6b7280;">Consulta, visualizaci√≥n y descarga de comprobantes</p>
                </div>
                
                <!-- M√©tricas -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">FACTURAS</div>
                        <div style="font-size: 32px; font-weight: 800; color: #3b82f6;">${remitos.filter(r => r.facturado).length}</div>
                        <div style="font-size: 10px; color: #6b7280;">emitidas</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #f59e0b;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">REMITOS</div>
                        <div style="font-size: 32px; font-weight: 800; color: #f59e0b;">${remitos.length}</div>
                        <div style="font-size: 10px; color: #6b7280;">generados</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #10b981;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">RECIBOS</div>
                        <div style="font-size: 32px; font-weight: 800; color: #10b981;">24</div>
                        <div style="font-size: 10px; color: #6b7280;">de pago</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #8b5cf6;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">TOTAL EMITIDO</div>
                        <div style="font-size: 32px; font-weight: 800; color: #8b5cf6;">$${(remitos.reduce((sum, r) => sum + r.total, 0)/1000).toFixed(0)}K</div>
                    </div>
                </div>
                
                <!-- B√∫squeda y filtros -->
                <div class="card" style="margin-bottom: 20px;">
                    <div class="card-body">
                        <div style="display: flex; gap: 10px; align-items: end;">
                            <div style="flex: 1;">
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 12px;">üîç Buscar Comprobante</label>
                                <input type="text" id="buscarComprobante" placeholder="Buscar por n√∫mero, cliente, fecha..." 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 12px;">Tipo</label>
                                <select id="filtroTipo" style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px;">
                                    <option value="todos">Todos</option>
                                    <option value="facturas">Facturas</option>
                                    <option value="remitos">Remitos</option>
                                    <option value="recibos">Recibos</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 12px;">Desde</label>
                                <input type="date" id="fechaDesde" style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 12px;">Hasta</label>
                                <input type="date" id="fechaHasta" value="${new Date().toISOString().split('T')[0]}" 
                                    style="padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px;">
                            </div>
                            <button class="btn-primary" onclick="buscarComprobantes()">
                                üîç Buscar
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de comprobantes -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Comprobantes Emitidos</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Tipo</th>
                                    <th>N√∫mero</th>
                                    <th>Fecha</th>
                                    <th>Cliente</th>
                                    <th>Total</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${remitos.slice(0, 15).map(r => `
                                    <tr>
                                        <td>
                                            <span style="padding: 6px 12px; background: ${r.facturado ? '#dbeafe' : '#fef3c7'}; color: ${r.facturado ? '#1e40af' : '#92400e'}; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${r.facturado ? 'üìÑ FACTURA' : 'üìã REMITO'}
                                            </span>
                                        </td>
                                        <td style="font-family: monospace; font-weight: 700; font-size: 14px;">
                                            ${r.facturado ? r.nroFactura : 'R-' + String(r.id).padStart(4, '0')}
                                        </td>
                                        <td style="font-weight: 600;">${r.fecha}</td>
                                        <td>
                                            <div style="font-weight: 700;">${r.cliente}</div>
                                            <div style="font-size: 11px; color: #6b7280;">CUIT: ${r.cuit || 'N/A'}</div>
                                        </td>
                                        <td style="font-weight: 800; font-size: 16px; color: #10b981;">$${r.total.toLocaleString()}</td>
                                        <td>
                                            <span style="padding: 6px 12px; background: #dcfce7; color: #16a34a; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ‚úÖ EMITIDO
                                            </span>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 5px;">
                                                <button class="btn-primary" style="padding: 6px 12px; font-size: 11px;" 
                                                    onclick="verDetalleComprobante('${r.id}')">
                                                    üëÅÔ∏è Ver
                                                </button>
                                                <button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: #10b981;" 
                                                    onclick="descargarComprobante('${r.id}')">
                                                    üì• PDF
                                                </button>
                                                <button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: #3b82f6;" 
                                                    onclick="enviarComprobante('${r.id}')">
                                                    üìß
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        function buscarComprobantes() {
            alert('üîç BUSCAR COMPROBANTES\n\nFiltros aplicados correctamente\n\nüí° Resultados actualizados');
        }
        
        function verDetalleComprobante(id) {
            const comprobante = remitos.find(r => r.id == id);
            if (!comprobante) return;
            
            const tipo = comprobante.facturado ? 'FACTURA' : 'REMITO';
            const numero = comprobante.facturado ? comprobante.nroFactura : 'R-' + String(comprobante.id).padStart(4, '0');
            
            const detalle = `
üìÑ ${tipo} ${numero}

Cliente: ${comprobante.cliente}
CUIT: ${comprobante.cuit || 'N/A'}
Fecha: ${comprobante.fecha}

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
PRODUCTOS:
${comprobante.productos ? comprobante.productos.map((p, idx) => `
${idx + 1}. ${p.nombre}
   Cantidad: ${p.cantidad}
   Precio: $${p.precio.toLocaleString()}
   Subtotal: $${(p.cantidad * p.precio).toLocaleString()}
`).join('') : 'Ver detalle completo...'}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

TOTAL: $${comprobante.total.toLocaleString()}

Estado: ‚úÖ EMITIDO
            `.trim();
            
            alert(detalle);
        }
        
        function descargarComprobante(id) {
            const comprobante = remitos.find(r => r.id == id);
            if (!comprobante) return;
            
            const tipo = comprobante.facturado ? 'FACTURA' : 'REMITO';
            const numero = comprobante.facturado ? comprobante.nroFactura : 'R-' + String(comprobante.id).padStart(4, '0');
            
            alert(`üì• DESCARGAR PDF\n\n${tipo} ${numero}\n\nGenerando PDF...\n\n‚úÖ Descarga iniciada`);
        }
        
        function enviarComprobante(id) {
            const comprobante = remitos.find(r => r.id == id);
            if (!comprobante) return;
            
            const email = prompt(`üìß ENVIAR POR EMAIL\n\nCliente: ${comprobante.cliente}\n\nIngres√° el email:`, '');
            
            if (email) {
                alert(`‚úÖ EMAIL ENVIADO\n\nDestinatario: ${email}\n\nEl comprobante fue enviado correctamente`);
            }
        }

        



        // ==================== E-COMMERCE / TIENDA ONLINE ====================
        let pestanaEcommerceActiva = 'productos';
        
        // Productos online con propiedades extendidas
        const productosOnline = productos.map(p => ({
            ...p,
            publicado: false,
            imagenUrl: '',
            descripcionWeb: '',
            destacado: false,
            enOferta: false,
            precioOferta: 0,
            porcentajeDescuento: 0,
            categoria: 'General',
            orden: 0
        }));
        
        // Configuraci√≥n de la tienda
        let configTienda = {
            nombre: 'Bruzzone Distribuidora',
            logo: '',
            colorPrimario: '#3b82f6',
            whatsapp: '3584254818',
            email: 'bruzzoneferreteria@gmail.com',
            direccion: 'Dr. Carlos Rocha 128, Alejandro Roca, C√≥rdoba',
            horarios: 'Lun a Vie: 8:00 - 12:00 y 16:00 - 20:00',
            urlTienda: 'tienda-bruzzone',
            mostrarBanner: true,
            textoBanner: 'üî• ¬°OFERTAS ESPECIALES! Hasta 30% OFF en productos seleccionados',
            colorBanner: '#ef4444'
        };
        
        function getEcommerceHTML() {
            const publicados = productosOnline.filter(p => p.publicado).length;
            const enOferta = productosOnline.filter(p => p.enOferta).length;
            const destacados = productosOnline.filter(p => p.destacado).length;
            
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 5px;">üõí Tienda Online</h2>
                    <p style="color: #6b7280;">Configur√° tu cat√°logo con ofertas, destacados y categor√≠as</p>
                </div>
                
                <!-- M√©tricas Superiores -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div class="card" style="border-left: 4px solid #10b981;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">PUBLICADOS</div>
                        <div style="font-size: 28px; font-weight: 800; color: #10b981;">${publicados}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #ef4444;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">EN OFERTA</div>
                        <div style="font-size: 28px; font-weight: 800; color: #ef4444;">${enOferta}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #f59e0b;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">DESTACADOS</div>
                        <div style="font-size: 28px; font-weight: 800; color: #f59e0b;">${destacados}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">LINK TIENDA</div>
                        <button class="btn-primary" style="padding: 8px 12px; font-size: 11px; margin-top: 5px; background: #10b981;" 
                            onclick="copiarLinkTienda()">üìã COPIAR</button>
                    </div>
                </div>
                
                <!-- Pesta√±as -->
                <div style="display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 3px solid #e5e7eb; overflow-x: auto; padding-bottom: 5px;">
                    <button class="btn-primary" style="background: ${pestanaEcommerceActiva === 'productos' ? '#3b82f6' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaEcommerce('productos')">üì¶ Productos</button>
                    <button class="btn-primary" style="background: ${pestanaEcommerceActiva === 'ofertas' ? '#ef4444' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaEcommerce('ofertas')">üî• Ofertas</button>
                    <button class="btn-primary" style="background: ${pestanaEcommerceActiva === 'destacados' ? '#f59e0b' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaEcommerce('destacados')">‚≠ê Destacados</button>
                    <button class="btn-primary" style="background: ${pestanaEcommerceActiva === 'config' ? '#10b981' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaEcommerce('config')">‚öôÔ∏è Configuraci√≥n</button>
                    <button class="btn-primary" style="background: ${pestanaEcommerceActiva === 'preview' ? '#8b5cf6' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaEcommerce('preview')">üëÅÔ∏è Vista Previa</button>
                </div>
                
                <div id="contenidoEcommerce">${getContenidoPestanaEcommerce()}</div>
            `;
        }
        
        function cambiarPestanaEcommerce(pestana) {
            pestanaEcommerceActiva = pestana;
            cargarModulo('ecommerce');
        }
        
        function getContenidoPestanaEcommerce() {
            switch(pestanaEcommerceActiva) {
                case 'ofertas': return getPestanaOfertas();
                case 'destacados': return getPestanaDestacados();
                case 'config': return getPestanaConfigTienda();
                case 'preview': return getPestanaPreviewTienda();
                default: return getPestanaProductos();
            }
        }
        
        // ========== PESTA√ëA: PRODUCTOS ==========
        function getPestanaProductos() {
            return `
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn-primary" onclick="publicarTodos()">‚úÖ Publicar Todos</button>
                    <button class="btn-primary" style="background: #6b7280;" onclick="despublicarTodos()">‚õî Despublicar Todos</button>
                </div>
                
                <div class="card">
                    <div class="card-header"><h3 class="card-title">üì¶ Gesti√≥n de Productos</h3></div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>Imagen</th>
                                    <th>Publicado</th>
                                    <th>Etiquetas</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productosOnline.slice(0, 15).map((p, idx) => `
                                    <tr style="background: ${p.publicado ? '#f0fdf4' : '#fff'};">
                                        <td>
                                            <div style="font-weight: 700;">${p.nombre}</div>
                                            <div style="font-size: 11px; color: #6b7280;">${p.marca}</div>
                                        </td>
                                        <td>
                                            ${p.enOferta ? `
                                                <div style="font-size: 12px; text-decoration: line-through; color: #6b7280;">$${p.precio.toLocaleString()}</div>
                                                <div style="font-weight: 800; font-size: 16px; color: #ef4444;">$${p.precioOferta.toLocaleString()}</div>
                                            ` : `<div style="font-weight: 700; font-size: 16px;">$${p.precio.toLocaleString()}</div>`}
                                        </td>
                                        <td style="text-align: center;"><span style="padding: 4px 10px; background: ${p.stock > 10 ? '#dcfce7' : '#fee2e2'}; color: ${p.stock > 10 ? '#16a34a' : '#dc2626'}; font-weight: 700; border-radius: 6px; font-size: 11px;">${p.stock}</span></td>
                                        <td>${p.imagenUrl ? '‚úÖ' : `<button class="btn-primary" style="padding: 6px 10px; font-size: 11px;" onclick="agregarImagen(${idx})">‚ûï</button>`}</td>
                                        <td><label style="display: flex; align-items: center; gap: 5px; cursor: pointer;"><input type="checkbox" ${p.publicado ? 'checked' : ''} onchange="togglePublicar(${idx})" style="width: 18px; height: 18px;"><span style="font-size: 11px; font-weight: 700; color: ${p.publicado ? '#10b981' : '#6b7280'};">${p.publicado ? 'SI' : 'NO'}</span></label></td>
                                        <td><div style="display: flex; gap: 5px;">${p.enOferta ? '<span style="padding: 3px 8px; background: #fee2e2; color: #dc2626; border-radius: 4px; font-size: 10px; font-weight: 700;">üî•</span>' : ''}${p.destacado ? '<span style="padding: 3px 8px; background: #fef3c7; color: #f59e0b; border-radius: 4px; font-size: 10px; font-weight: 700;">‚≠ê</span>' : ''}</div></td>
                                        <td><button class="btn-primary" style="padding: 6px 12px; font-size: 11px;" onclick="editarProducto(${idx})">‚úèÔ∏è</button></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: OFERTAS ==========
        function getPestanaOfertas() {
            return `
                <div style="padding: 20px; background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 12px; color: white; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">üî• Gesti√≥n de Ofertas</h3>
                    <p style="opacity: 0.9;">Aplic√° descuentos especiales a tus productos</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" style="background: #ef4444;" onclick="ofertaRapida()">‚ö° OFERTA R√ÅPIDA A TODOS</button>
                </div>
                
                <div class="card">
                    <div class="card-header"><h3 class="card-title">üè∑Ô∏è Aplicar Descuentos</h3></div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Precio Normal</th>
                                    <th>% Desc.</th>
                                    <th>Precio Oferta</th>
                                    <th>En Oferta</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productosOnline.slice(0, 15).map((p, idx) => `
                                    <tr style="background: ${p.enOferta ? '#fef3c7' : '#fff'};">
                                        <td><div style="font-weight: 700;">${p.nombre}</div></td>
                                        <td style="font-weight: 700;">$${p.precio.toLocaleString()}</td>
                                        <td><input type="number" min="0" max="90" value="${p.porcentajeDescuento}" style="width: 70px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: center; font-weight: 700;" onchange="actualizarDesc(${idx}, this.value)"></td>
                                        <td style="font-weight: 800; font-size: 16px; color: #ef4444;">$${p.precioOferta > 0 ? p.precioOferta.toLocaleString() : p.precio.toLocaleString()}</td>
                                        <td><label style="cursor: pointer;"><input type="checkbox" ${p.enOferta ? 'checked' : ''} onchange="toggleOferta(${idx})" style="width: 20px; height: 20px;"></label></td>
                                        <td><button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: #ef4444;" onclick="aplicarOferta(${idx})">üî• Aplicar</button></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: DESTACADOS ==========
        function getPestanaDestacados() {
            return `
                <div style="padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; color: white; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">‚≠ê Productos Destacados</h3>
                    <p style="opacity: 0.9;">Estos productos aparecen primero en tu tienda</p>
                </div>
                
                <div class="card">
                    <div class="card-header"><h3 class="card-title">‚≠ê Marcar como Destacados</h3></div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Producto</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>Destacado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${productosOnline.slice(0, 20).map((p, idx) => `
                                    <tr style="background: ${p.destacado ? '#fef3c7' : '#fff'};">
                                        <td><div style="font-weight: 700;">${p.nombre}</div><div style="font-size: 11px; color: #6b7280;">${p.marca}</div></td>
                                        <td style="font-weight: 700;">$${p.precio.toLocaleString()}</td>
                                        <td style="text-align: center;"><span style="padding: 4px 10px; background: ${p.stock > 10 ? '#dcfce7' : '#fee2e2'}; color: ${p.stock > 10 ? '#16a34a' : '#dc2626'}; font-weight: 700; border-radius: 6px; font-size: 11px;">${p.stock}</span></td>
                                        <td><label style="cursor: pointer;"><input type="checkbox" ${p.destacado ? 'checked' : ''} onchange="toggleDestacado(${idx})" style="width: 20px; height: 20px;"></label></td>
                                        <td><button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: #f59e0b;" onclick="toggleDestacado(${idx})">${p.destacado ? '‚ùå Quitar' : '‚≠ê Destacar'}</button></td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: CONFIGURACI√ìN ==========
        function getPestanaConfigTienda() {
            return `
                <div class="card">
                    <div class="card-header"><h3 class="card-title">‚öôÔ∏è Configuraci√≥n de la Tienda</h3></div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                            <div>
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üìã Informaci√≥n</h4>
                                <div style="margin-bottom: 12px;"><label style="font-weight: 600; font-size: 12px;">Nombre</label><input type="text" value="${configTienda.nombre}" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; margin-top: 5px;"></div>
                                <div style="margin-bottom: 12px;"><label style="font-weight: 600; font-size: 12px;">WhatsApp</label><input type="text" value="${configTienda.whatsapp}" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; margin-top: 5px;"></div>
                                <div style="margin-bottom: 12px;"><label style="font-weight: 600; font-size: 12px;">Email</label><input type="email" value="${configTienda.email}" style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; margin-top: 5px;"></div>
                            </div>
                            <div>
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üé® Banner</h4>
                                <div style="margin-bottom: 12px;"><label style="display: flex; align-items: center; gap: 8px; cursor: pointer;"><input type="checkbox" ${configTienda.mostrarBanner ? 'checked' : ''} style="width: 18px; height: 18px;"><span style="font-weight: 600;">Mostrar Banner</span></label></div>
                                <textarea style="width: 100%; padding: 8px; border: 2px solid #e5e7eb; border-radius: 6px; min-height: 70px; font-size: 12px;">${configTienda.textoBanner}</textarea>
                            </div>
                        </div>
                        <div style="margin-top: 25px; padding: 20px; background: #dbeafe; border-radius: 10px;">
                            <h4 style="font-weight: 700; margin-bottom: 10px; color: #1e40af;">üîó Link de tu Tienda</h4>
                            <div style="font-size: 16px; font-weight: 700; color: #3b82f6; margin-bottom: 12px;">https://tienda.ferrecloud.com/${configTienda.urlTienda}</div>
                            <button class="btn-primary" onclick="copiarLinkTienda()">üìã COPIAR</button>
                            <button class="btn-primary" style="background: #10b981; margin-left: 10px;" onclick="compartirWhatsApp()">üí¨ COMPARTIR</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: VISTA PREVIA ==========
        function getPestanaPreviewTienda() {
            const publicados = productosOnline.filter(p => p.publicado);
            const destacados = publicados.filter(p => p.destacado);
            const ofertas = publicados.filter(p => p.enOferta);
            const normales = publicados.filter(p => !p.destacado && !p.enOferta);
            
            return `
                <div style="background: #f3f4f6; border-radius: 12px; padding: 20px;">
                    ${configTienda.mostrarBanner ? `<div style="background: ${configTienda.colorBanner}; color: white; padding: 12px 20px; border-radius: 8px; text-align: center; margin-bottom: 20px; font-weight: 700; font-size: 13px;">${configTienda.textoBanner}</div>` : ''}
                    <div style="text-align: center; margin-bottom: 25px; background: white; padding: 25px; border-radius: 10px;">
                        <h1 style="font-size: 28px; font-weight: 800; margin-bottom: 8px;">${configTienda.nombre}</h1>
                        <p style="color: #6b7280; font-size: 13px;">${configTienda.direccion}</p>
                    </div>
                    ${publicados.length === 0 ? '<div style="padding: 50px; text-align: center; background: white; border-radius: 10px;"><div style="font-size: 48px; margin-bottom: 10px;">üõí</div><div style="font-size: 16px; font-weight: 700; color: #6b7280;">No hay productos publicados</div></div>' : `
                        ${destacados.length > 0 ? `<div style="margin-bottom: 25px;"><h2 style="font-size: 18px; font-weight: 800; margin-bottom: 12px; background: white; padding: 12px 15px; border-radius: 8px;">‚≠ê Destacados</h2><div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">${destacados.slice(0, 8).map(p => cardProducto(p)).join('')}</div></div>` : ''}
                        ${ofertas.length > 0 ? `<div style="margin-bottom: 25px;"><h2 style="font-size: 18px; font-weight: 800; margin-bottom: 12px; background: white; padding: 12px 15px; border-radius: 8px;">üî• Ofertas</h2><div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">${ofertas.slice(0, 8).map(p => cardProducto(p)).join('')}</div></div>` : ''}
                        ${normales.length > 0 ? `<div><h2 style="font-size: 18px; font-weight: 800; margin-bottom: 12px; background: white; padding: 12px 15px; border-radius: 8px;">üì¶ Productos</h2><div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 12px;">${normales.slice(0, 20).map(p => cardProducto(p)).join('')}</div></div>` : ''}
                    `}
                    <div style="margin-top: 30px; padding: 25px; background: white; border-radius: 10px; text-align: center;">
                        <h3 style="font-weight: 700; margin-bottom: 15px;">üìû Contacto</h3>
                        <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                            <div style="padding: 12px 25px; background: #dcfce7; border-radius: 8px;"><div style="font-size: 10px; color: #166534; margin-bottom: 3px;">WhatsApp</div><div style="font-size: 14px; font-weight: 700; color: #16a34a;">${configTienda.whatsapp}</div></div>
                            <div style="padding: 12px 25px; background: #dbeafe; border-radius: 8px;"><div style="font-size: 10px; color: #1e40af; margin-bottom: 3px;">Email</div><div style="font-size: 14px; font-weight: 700; color: #3b82f6;">${configTienda.email}</div></div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function cardProducto(p) {
            return `<div style="background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.1); position: relative;">${p.enOferta ? `<div style="position: absolute; top: 8px; right: 8px; background: #ef4444; color: white; padding: 4px 8px; border-radius: 6px; font-size: 10px; font-weight: 800; z-index: 10;">-${p.porcentajeDescuento}%</div>` : ''}${p.destacado ? '<div style="position: absolute; top: 8px; left: 8px; font-size: 20px; z-index: 10;">‚≠ê</div>' : ''}<div style="height: 140px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); display: flex; align-items: center; justify-content: center; font-size: 40px;">üì¶</div><div style="padding: 10px;"><h3 style="font-size: 12px; font-weight: 700; margin-bottom: 3px;">${p.nombre}</h3><p style="font-size: 10px; color: #6b7280; margin-bottom: 6px;">${p.marca}</p>${p.enOferta ? `<div style="font-size: 10px; color: #6b7280; text-decoration: line-through;">$${p.precio.toLocaleString()}</div><div style="font-size: 16px; font-weight: 800; color: #ef4444; margin-bottom: 6px;">$${p.precioOferta.toLocaleString()}</div>` : `<div style="font-size: 16px; font-weight: 800; color: #10b981; margin-bottom: 6px;">$${p.precio.toLocaleString()}</div>`}<button style="width: 100%; padding: 8px; background: #10b981; color: white; border: none; border-radius: 6px; font-weight: 700; font-size: 11px;">üí¨ CONSULTAR</button></div></div>`;
        }
        
        // ========== FUNCIONES ==========
        function togglePublicar(idx) { productosOnline[idx].publicado = !productosOnline[idx].publicado; cargarModulo('ecommerce'); }
        function publicarTodos() { if(confirm('¬øPublicar TODOS?')) { productosOnline.forEach(p => p.publicado = true); alert('‚úÖ Todos publicados'); cargarModulo('ecommerce'); }}
        function despublicarTodos() { if(confirm('¬øDespublicar TODOS?')) { productosOnline.forEach(p => p.publicado = false); alert('‚úÖ Todos despublicados'); cargarModulo('ecommerce'); }}
        function toggleOferta(idx) { productosOnline[idx].enOferta = !productosOnline[idx].enOferta; if(productosOnline[idx].enOferta && productosOnline[idx].porcentajeDescuento === 0) { productosOnline[idx].porcentajeDescuento = 20; productosOnline[idx].precioOferta = Math.round(productosOnline[idx].precio * 0.8); } cargarModulo('ecommerce'); }
        function actualizarDesc(idx, porc) { const p = parseInt(porc) || 0; productosOnline[idx].porcentajeDescuento = p; productosOnline[idx].precioOferta = Math.round(productosOnline[idx].precio * (1 - p/100)); cargarModulo('ecommerce'); }
        function aplicarOferta(idx) { const desc = prompt('% de descuento?', '20'); if(desc) { actualizarDesc(idx, desc); productosOnline[idx].enOferta = true; alert(`‚úÖ Oferta del ${desc}% aplicada`); cargarModulo('ecommerce'); }}
        function ofertaRapida() { const desc = prompt('üî• ¬øQu√© % a todos?', '15'); if(desc && !isNaN(desc)) { const p = parseInt(desc); productosOnline.forEach(x => { x.enOferta = true; x.porcentajeDescuento = p; x.precioOferta = Math.round(x.precio * (1 - p/100)); }); alert(`‚úÖ Oferta del ${p}% a todos`); cargarModulo('ecommerce'); }}
        function toggleDestacado(idx) { productosOnline[idx].destacado = !productosOnline[idx].destacado; cargarModulo('ecommerce'); }
        function agregarImagen(idx) { const url = prompt(`üì∑ URL de imagen para ${productosOnline[idx].nombre}:`, ''); if(url) { productosOnline[idx].imagenUrl = url; alert('‚úÖ Imagen agregada'); cargarModulo('ecommerce'); }}
        function editarProducto(idx) { alert(`‚úèÔ∏è EDITAR\n\n${productosOnline[idx].nombre}\n\nüí° Funcionalidad en desarrollo`); }
        function copiarLinkTienda() { const link = `https://tienda.ferrecloud.com/${configTienda.urlTienda}`; if(navigator.clipboard) { navigator.clipboard.writeText(link).then(() => alert(`‚úÖ LINK COPIADO\n\n${link}`)).catch(() => alert(`üìã TU LINK:\n\n${link}`)); } else { alert(`üìã TU LINK:\n\n${link}`); }}
        function compartirWhatsApp() { const link = `https://tienda.ferrecloud.com/${configTienda.urlTienda}`; const msg = `¬°Mir√° nuestro cat√°logo! üõí\n\n${configTienda.nombre}\n\n${link}`; window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank'); }




        




        




        
        
        
        
        function cambiarPestanaCompras(pestana) {
            pestanaComprasActivaNew = pestana;
            cargarModulo('compras');
        }
        
        function getContenidoPestanaCompras() {
            switch(pestanaComprasActivaNew) {
                case 'ia': return getPestanaImportarIA();
                case 'historial': return getPestanaHistorial();
                case 'actualizar': return getPestanaActualizarCostos();
                default: return getPestanaNuevaCompra();
            }
        }
        
        // ========== PESTA√ëA: NUEVA COMPRA (MANUAL) ==========
        function getPestanaNuevaCompra() {
    return `
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">‚ûï Ingreso Manual de Compra</h3>
            </div>
            <div class="card-body">
                <!-- Datos de la compra -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; padding: 20px; background: #f9fafb; border-radius: 10px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Proveedor</label>
                        <select id="proveedorCompra" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                            <option value="">Seleccionar...</option>
                            <option value="Walker">Distribuidora Walker</option>
                            <option value="Ferreter√≠a Mayorista SA">Ferreter√≠a Mayorista SA</option>
                            <option value="Importadora ABC">Importadora ABC</option>
                        </select>
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Nro. Remito</label>
                        <input type="text" id="nroRemitoCompra" placeholder="REM-12345" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Fecha</label>
                        <input type="date" id="fechaCompra" value="${new Date().toISOString().split('T')[0]}" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>
                
                <!-- Actualizar costos -->
                <div style="margin-bottom: 25px; padding: 15px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="actualizarCostosCheck" checked 
                            style="width: 20px; height: 20px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 700; font-size: 14px; color: #92400e;">¬øActualizar costos de productos?</div>
                            <div style="font-size: 12px; color: #92400e;">Si activ√°s esto, los precios de compra de los productos se actualizar√°n</div>
                        </div>
                    </label>
                </div>
                
                <!-- B√öSQUEDA DIRECTA -->
                <div style="margin-bottom: 25px; padding: 20px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 10px;">
                    <label style="display: block; font-weight: 700; margin-bottom: 10px; font-size: 14px; color: white;">
                        üîç Buscar y Agregar Producto
                    </label>
                    <input type="text" id="busquedaDirectaCompra" 
                        placeholder="C√≥digo, SKU, c√≥digo proveedor, nombre del producto..."
                        style="width: 100%; padding: 14px; border: 3px solid white; border-radius: 8px; font-size: 16px; font-weight: 600;"
                        oninput="buscarProductoDirectoCompra(this.value)"
                        autocomplete="off">
                    <div style="font-size: 11px; color: white; margin-top: 8px; opacity: 0.9;">
                        üí° Busca por: C√≥digo interno, C√≥digo proveedor, C√≥digos 1-2-3-4, Nombre
                    </div>
                    
                    <!-- Resultados de b√∫squeda -->
                    <div id="resultadosBusquedaCompra" style="margin-top: 15px;"></div>
                </div>
                
                <!-- Lista de productos agregados -->
                <div id="listaItemsCompra">
                    <div style="padding: 40px; text-align: center; background: #f9fafb; border-radius: 10px; border: 2px dashed #e5e7eb;">
                        <div style="font-size: 48px; margin-bottom: 10px;">üì¶</div>
                        <div style="font-size: 14px; color: #6b7280; font-weight: 600;">No hay productos agregados</div>
                        <div style="font-size: 12px; color: #9ca3af; margin-top: 5px;">Us√° el buscador de arriba para agregar productos</div>
                    </div>
                </div>
                
                <!-- Bot√≥n guardar -->
                <div style="margin-top: 25px; display: flex; gap: 10px;">
                    <button class="btn-primary" style="background: #10b981; font-size: 16px; padding: 12px 30px;" 
                        onclick="guardarCompraManual()">
                        ‚úÖ GUARDAR COMPRA
                    </button>
                    <button class="btn-primary" style="background: #6b7280; font-size: 16px; padding: 12px 30px;" 
                        onclick="cancelarCompra()">
                        ‚ùå CANCELAR
                    </button>
                </div>
            </div>
        </div>
    `;
}
        
        // ========== PESTA√ëA: IMPORTAR CON IA ==========
        function getPestanaImportarIA() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 12px; color: white;">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">ü§ñ Importar con Inteligencia Artificial</h3>
                        <p style="opacity: 0.9;">Sub√≠ un PDF o imagen del remito y la IA lo procesar√° autom√°ticamente</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üì§ Subir Archivo</h3>
                    </div>
                    <div class="card-body">
                        <!-- Zona de carga -->
                        <div style="margin-bottom: 30px; padding: 40px; background: #f9fafb; border: 3px dashed #8b5cf6; border-radius: 12px; text-align: center;">
                            <div style="font-size: 64px; margin-bottom: 15px;">üìÑ</div>
                            <div style="font-size: 16px; font-weight: 700; color: #1a1f2e; margin-bottom: 10px;">
                                Arrastr√° tu archivo aqu√≠ o hac√© click para seleccionar
                            </div>
                            <div style="font-size: 13px; color: #6b7280; margin-bottom: 20px;">
                                Formatos aceptados: PDF, JPG, PNG | Tama√±o m√°ximo: 10MB
                            </div>
                            <input type="file" id="archivoCompraIA" accept=".pdf,.jpg,.jpeg,.png" 
                                onchange="procesarArchivoIA(this.files[0])"
                                style="display: none;">
                            <button class="btn-primary" style="background: #8b5cf6; font-size: 16px; padding: 12px 30px;" 
                                onclick="document.getElementById('archivoCompraIA').click()">
                                üìÅ SELECCIONAR ARCHIVO
                            </button>
                        </div>
                        
                        <!-- Instrucciones -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div style="padding: 20px; background: #f0fdf4; border-radius: 10px; border-left: 4px solid #10b981;">
                                <div style="font-size: 32px; margin-bottom: 10px;">1Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Sub√≠ el archivo</div>
                                <div style="font-size: 12px; color: #6b7280;">PDF o foto del remito del proveedor</div>
                            </div>
                            <div style="padding: 20px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <div style="font-size: 32px; margin-bottom: 10px;">2Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">IA procesa</div>
                                <div style="font-size: 12px; color: #6b7280;">Extrae productos, cantidades y precios</div>
                            </div>
                            <div style="padding: 20px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <div style="font-size: 32px; margin-bottom: 10px;">3Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Revis√°s y confirm√°s</div>
                                <div style="font-size: 12px; color: #6b7280;">Ajust√°s si hace falta y guard√°s</div>
                            </div>
                        </div>
                        
                        <!-- Resultado del procesamiento IA -->
                        <div id="resultadoIA" style="margin-top: 30px;">
                            ${itemsIA.length > 0 ? getResultadoIA() : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getResultadoIA() {
            const total = itemsIA.reduce((sum, item) => sum + (item.cantidad * item.precioUnitario), 0);
            
            return `
                <div style="padding: 20px; background: #dcfce7; border-radius: 12px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div style="font-size: 32px;">‚úÖ</div>
                        <div>
                            <div style="font-weight: 700; font-size: 16px; color: #166534;">¬°Archivo procesado correctamente!</div>
                            <div style="font-size: 13px; color: #166534;">La IA detect√≥ ${itemsIA.length} productos</div>
                        </div>
                    </div>
                </div>
                
                <!-- Datos detectados -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Proveedor detectado</label>
                        <input type="text" id="proveedorIA" value="Distribuidora Walker" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Nro. Remito</label>
                        <input type="text" id="remitoIA" value="REM-${Math.floor(Math.random() * 10000)}" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Fecha</label>
                        <input type="date" id="fechaIA" value="${new Date().toISOString().split('T')[0]}" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>
                
                <!-- Actualizar costos -->
                <div style="margin-bottom: 20px; padding: 15px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="actualizarCostosIA" checked 
                            style="width: 20px; height: 20px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 700; font-size: 14px; color: #92400e;">¬øActualizar costos de productos?</div>
                            <div style="font-size: 12px; color: #92400e;">Los precios de compra se actualizar√°n autom√°ticamente</div>
                        </div>
                    </label>
                </div>
                
                <!-- Productos detectados -->
                <div style="margin-bottom: 20px;">
                    <h4 style="font-weight: 700; margin-bottom: 15px;">üì¶ Productos Detectados</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>C√≥digo</th>
                                <th>Cantidad</th>
                                <th>Precio Unit.</th>
                                <th>Subtotal</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsIA.map((item, idx) => `
                                <tr>
                                    <td>
                                        <input type="text" value="${item.nombre}" 
                                            style="width: 100%; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 13px;"
                                            onchange="itemsIA[${idx}].nombre = this.value">
                                    </td>
                                    <td style="font-family: monospace; font-weight: 700;">${item.codigo}</td>
                                    <td>
                                        <input type="number" value="${item.cantidad}" min="1"
                                            style="width: 80px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: center; font-weight: 700;"
                                            onchange="itemsIA[${idx}].cantidad = parseInt(this.value); cargarModulo('compras')">
                                    </td>
                                    <td>
                                        <input type="number" value="${item.precioUnitario}" min="0"
                                            style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: right; font-weight: 700;"
                                            onchange="itemsIA[${idx}].precioUnitario = parseFloat(this.value); cargarModulo('compras')">
                                    </td>
                                    <td style="font-weight: 800; font-size: 15px;">$${(item.cantidad * item.precioUnitario).toLocaleString()}</td>
                                    <td>
                                        <button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: #ef4444;" 
                                            onclick="eliminarItemIA(${idx})">
                                            üóëÔ∏è
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot>
                            <tr style="background: #f9fafb; font-weight: 800;">
                                <td colspan="4" style="text-align: right; padding: 15px;">TOTAL:</td>
                                <td style="font-size: 20px; color: #10b981;">$${total.toLocaleString()}</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <!-- Botones -->
                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" style="background: #10b981; font-size: 16px; padding: 12px 30px;" 
                        onclick="confirmarCompraIA()">
                        ‚úÖ CONFIRMAR Y GUARDAR
                    </button>
                    <button class="btn-primary" style="background: #6b7280; font-size: 16px; padding: 12px 30px;" 
                        onclick="cancelarCompraIA()">
                        ‚ùå CANCELAR
                    </button>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: HISTORIAL ==========
        function getPestanaHistorial() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Historial de Compras</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Proveedor</th>
                                    <th>Nro. Remito</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Actualiz√≥ Costos</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${compras.map(c => `
                                    <tr>
                                        <td style="font-weight: 600;">${c.fecha}</td>
                                        <td style="font-weight: 700;">${c.proveedor}</td>
                                        <td style="font-family: monospace; font-weight: 600;">${c.nroRemito}</td>
                                        <td style="text-align: center;">
                                            <span style="padding: 4px 12px; background: #dbeafe; color: #1e40af; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${c.items} items
                                            </span>
                                        </td>
                                        <td style="font-weight: 800; font-size: 16px; color: #10b981;">$${c.total.toLocaleString()}</td>
                                        <td style="text-align: center;">
                                            ${c.actualizoCostos ? 
                                                '<span style="font-size: 20px;">‚úÖ</span>' : 
                                                '<span style="font-size: 20px;">‚ùå</span>'
                                            }
                                        </td>
                                        <td>
                                            <span style="padding: 6px 12px; background: #dcfce7; color: #16a34a; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${c.estado}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn-primary" style="padding: 6px 12px; font-size: 12px;" 
                                                onclick="verDetalleCompra(${c.id})">
                                                üëÅÔ∏è Ver
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: ACTUALIZAR COSTOS ==========
        function getPestanaActualizarCostos() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; color: white;">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">üí∞ Actualizaci√≥n Masiva de Costos</h3>
                        <p style="opacity: 0.9;">Actualiz√° los precios de compra de m√∫ltiples productos a la vez</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üí∞ Actualizar Precios de Compra</h3>
                    </div>
                    <div class="card-body">
                        <!-- Opciones de actualizaci√≥n -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                            <div style="padding: 20px; background: #f9fafb; border-radius: 10px; border: 2px solid #e5e7eb;">
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üìà Ajuste por Porcentaje</h4>
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <div style="flex: 1;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Porcentaje</label>
                                        <input type="number" id="porcentajeAjuste" value="10" 
                                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px; font-weight: 700;">
                                    </div>
                                    <button class="btn-primary" style="background: #10b981;" onclick="aplicarAjustePorcentaje()">
                                        ‚úÖ APLICAR
                                    </button>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 10px;">
                                    Ejemplo: 10% aumenta todos los costos un 10%
                                </div>
                            </div>
                            
                            <div style="padding: 20px; background: #f9fafb; border-radius: 10px; border: 2px solid #e5e7eb;">
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üíµ Ajuste por Monto Fijo</h4>
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <div style="flex: 1;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Monto $</label>
                                        <input type="number" id="montoAjuste" value="50" 
                                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px; font-weight: 700;">
                                    </div>
                                    <button class="btn-primary" style="background: #3b82f6;" onclick="aplicarAjusteMonto()">
                                        ‚úÖ APLICAR
                                    </button>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 10px;">
                                    Ejemplo: $50 suma $50 a cada costo
                                </div>
                            </div>
                        </div>
                        
                        <!-- Vista previa de productos -->
                        <div>
                            <h4 style="font-weight: 700; margin-bottom: 15px;">üì¶ Vista Previa de Costos</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Costo Actual</th>
                                        <th>Precio Venta</th>
                                        <th>Margen Actual</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productos.slice(0, 10).map((p, idx) => {
                                        const costo = Math.round(p.precio * 0.6);
                                        const margen = Math.round(((p.precio - costo) / costo) * 100);
                                        return `
                                            <tr>
                                                <td>
                                                    <div style="font-weight: 700;">${p.nombre}</div>
                                                    <div style="font-size: 11px; color: #6b7280;">${p.marca}</div>
                                                </td>
                                                <td style="font-weight: 700; font-size: 15px;">$${costo.toLocaleString()}</td>
                                                <td style="font-weight: 700; font-size: 15px; color: #10b981;">$${p.precio.toLocaleString()}</td>
                                                <td>
                                                    <span style="padding: 6px 12px; background: ${margen > 40 ? '#dcfce7' : '#fef3c7'}; color: ${margen > 40 ? '#16a34a' : '#f59e0b'}; font-weight: 700; border-radius: 6px; font-size: 12px;">
                                                        ${margen}%
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn-primary" style="padding: 6px 12px; font-size: 11px;" 
                                                        onclick="editarCosto(${idx})">
                                                        ‚úèÔ∏è Editar
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ========== FUNCIONES ==========
        
        
        let itemsCompraActual = [];

function agregarItemCompra() {
    // Crear modal selector de productos
    const modal = document.createElement('div');
    modal.id = 'modalSeleccionarProducto';
    modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;';
    
    modal.innerHTML = `
        <div style="background: white; border-radius: 12px; width: 100%; max-width: 900px; max-height: 90vh; overflow: hidden; box-shadow: 0 25px 50px rgba(0,0,0,0.3); display: flex; flex-direction: column;">
            <div style="padding: 20px 25px; border-bottom: 2px solid #e5e7eb; background: #3b82f6; color: white;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 700;">‚ûï Agregar Producto a la Compra</h2>
            </div>
            
            <div style="padding: 25px; overflow-y: auto; flex: 1;">
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">üîç Buscar producto:</label>
                    <input type="text" id="buscarProductoCompra" 
                        placeholder="Nombre, c√≥digo o c√≥digo de barras..."
                        style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;"
                        oninput="filtrarProductosCompra(this.value)">
                </div>
                
                <div id="listaProductosCompra" style="max-height: 400px; overflow-y: auto;">
                    ${productos.slice(0, 10).map(p => `
                        <div onclick="seleccionarProductoCompra('${p.codigo}')" 
                            style="padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer; transition: all 0.2s;"
                            onmouseover="this.style.borderColor='#3b82f6'; this.style.background='#eff6ff'"
                            onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="flex: 1;">
                                    <div style="font-weight: 700; font-size: 14px; margin-bottom: 4px;">${p.nombre}</div>
                                    <div style="font-size: 12px; color: #6b7280;">
                                        <span style="font-family: monospace; background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">${p.codigo}</span>
                                        <span style="margin-left: 10px;">${p.marca}</span>
                                        <span style="margin-left: 10px; color: ${p.stock < p.stockMinimo ? '#ef4444' : '#10b981'};">
                                            Stock: ${p.stock}
                                        </span>
                                    </div>
                                </div>
                                <div style="text-align: right;">
                                    <div style="font-size: 18px; font-weight: 800; color: #3b82f6;">$${p.precio.toLocaleString()}</div>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            
            <div style="padding: 20px 25px; border-top: 2px solid #e5e7eb; background: #f9fafb;">
                <button onclick="cerrarModalSeleccionarProducto()" 
                    style="padding: 12px 28px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; width: 100%;">
                    ‚ùå CANCELAR
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
}

function filtrarProductosCompra(texto) {
    const lista = document.getElementById('listaProductosCompra');
    if (!texto) {
        lista.innerHTML = productos.slice(0, 10).map(p => `
            <div onclick="seleccionarProductoCompra('${p.codigo}')" 
                style="padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer;"
                onmouseover="this.style.borderColor='#3b82f6'; this.style.background='#eff6ff'"
                onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="flex: 1;">
                        <div style="font-weight: 700; font-size: 14px; margin-bottom: 4px;">${p.nombre}</div>
                        <div style="font-size: 12px; color: #6b7280;">
                            <span style="font-family: monospace; background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">${p.codigo}</span>
                            <span style="margin-left: 10px;">${p.marca}</span>
                            <span style="margin-left: 10px; color: ${p.stock < p.stockMinimo ? '#ef4444' : '#10b981'};">Stock: ${p.stock}</span>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-size: 18px; font-weight: 800; color: #3b82f6;">$${p.precio.toLocaleString()}</div>
                    </div>
                </div>
            </div>
        `).join('');
        return;
    }
    
    const filtrados = productos.filter(p => 
        p.nombre.toLowerCase().includes(texto.toLowerCase()) ||
        p.codigo.toLowerCase().includes(texto.toLowerCase()) ||
        (p.marca && p.marca.toLowerCase().includes(texto.toLowerCase()))
    ).slice(0, 20);
    
    if (filtrados.length === 0) {
        lista.innerHTML = '<div style="padding: 40px; text-align: center; color: #6b7280;">‚ùå No se encontraron productos</div>';
        return;
    }
    
    lista.innerHTML = filtrados.map(p => `
        <div onclick="seleccionarProductoCompra('${p.codigo}')" 
            style="padding: 15px; border: 2px solid #e5e7eb; border-radius: 8px; margin-bottom: 10px; cursor: pointer;"
            onmouseover="this.style.borderColor='#3b82f6'; this.style.background='#eff6ff'"
            onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div style="flex: 1;">
                    <div style="font-weight: 700; font-size: 14px; margin-bottom: 4px;">${p.nombre}</div>
                    <div style="font-size: 12px; color: #6b7280;">
                        <span style="font-family: monospace; background: #f3f4f6; padding: 2px 6px; border-radius: 4px;">${p.codigo}</span>
                        <span style="margin-left: 10px;">${p.marca}</span>
                        <span style="margin-left: 10px; color: ${p.stock < p.stockMinimo ? '#ef4444' : '#10b981'};">Stock: ${p.stock}</span>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 18px; font-weight: 800; color: #3b82f6;">$${p.precio.toLocaleString()}</div>
                </div>
            </div>
        </div>
    `).join('');
}

function seleccionarProductoCompra(codigo) {
    const producto = productos.find(p => p.codigo === codigo);
    if (!producto) return;
    
    // Cerrar modal de selecci√≥n
    cerrarModalSeleccionarProducto();
    
    // Abrir modal de cantidad y precio
    const modalCantidad = document.createElement('div');
    modalCantidad.id = 'modalCantidadCompra';
    modalCantidad.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;';
    
    modalCantidad.innerHTML = `
        <div style="background: white; border-radius: 12px; width: 100%; max-width: 600px; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
            <div style="padding: 20px 25px; border-bottom: 2px solid #e5e7eb; background: #10b981; color: white;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 700;">‚úÖ ${producto.nombre}</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">Ingres√° cantidad y precio de compra</p>
            </div>
            
            <div style="padding: 25px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px;">üì¶ Cantidad:</label>
                        <input type="number" id="cantidadCompra" min="1" value="1"
                            style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; text-align: center; font-weight: 700;">
                    </div>
                    
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px;">üí∞ Precio Unitario:</label>
                        <input type="number" id="precioUnitarioCompra" step="any" min="0" value="${producto.precioCosto || producto.precio}"
                            style="width: 100%; padding: 12px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 16px; text-align: right; font-weight: 700;">
                    </div>
                </div>
                
                <div style="padding: 15px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                    <div style="font-size: 12px; color: #166534; font-weight: 600;">STOCK ACTUAL</div>
                    <div style="font-size: 24px; font-weight: 800; color: #10b981;">${producto.stock} unidades</div>
                </div>
                
                <div style="display: flex; gap: 10px;">
                    <button onclick="cerrarModalCantidadCompra()" 
                        style="flex: 1; padding: 12px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">
                        ‚ùå CANCELAR
                    </button>
                    <button onclick="confirmarAgregarProductoCompra('${codigo}')" 
                        style="flex: 1; padding: 12px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer;">
                        ‚úÖ AGREGAR
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modalCantidad);
    setTimeout(() => document.getElementById('cantidadCompra').focus(), 100);
}

function buscarProductoDirectoCompra(texto) {
    const resultadosDiv = document.getElementById('resultadosBusquedaCompra');
    
    if (!texto || texto.length < 2) {
        resultadosDiv.innerHTML = '';
        return;
    }
    
    const textoLower = texto.toLowerCase();
    
    // Buscar en TODOS los campos
    const resultados = productos.filter(p => 
        (p.codigo && p.codigo.toLowerCase().includes(textoLower)) ||
        (p.nombre && p.nombre.toLowerCase().includes(textoLower)) ||
        (p.codigoProveedor && p.codigoProveedor.toLowerCase().includes(textoLower)) ||
        (p.codigo1 && p.codigo1.toLowerCase().includes(textoLower)) ||
        (p.codigo2 && p.codigo2.toLowerCase().includes(textoLower)) ||
        (p.codigo3 && p.codigo3.toLowerCase().includes(textoLower)) ||
        (p.codigo4 && p.codigo4.toLowerCase().includes(textoLower)) ||
        (p.marca && p.marca.toLowerCase().includes(textoLower))
    ).slice(0, 5);
    
    if (resultados.length === 0) {
        resultadosDiv.innerHTML = `
            <div style="padding: 20px; background: white; border-radius: 8px; text-align: center; color: #6b7280;">
                ‚ùå No se encontraron productos con "${texto}"
            </div>
        `;
        return;
    }
    
    resultadosDiv.innerHTML = `
        <div style="background: white; border-radius: 8px; padding: 10px; max-height: 400px; overflow-y: auto; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
            ${resultados.map(p => `
                <div onclick="seleccionarProductoCompraDirect('${p.codigo}')" 
                    style="padding: 12px; border: 2px solid #e5e7eb; border-radius: 6px; margin-bottom: 8px; cursor: pointer; transition: all 0.2s;"
                    onmouseover="this.style.borderColor='#10b981'; this.style.background='#f0fdf4'"
                    onmouseout="this.style.borderColor='#e5e7eb'; this.style.background='white'">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="flex: 1;">
                            <div style="font-weight: 700; font-size: 15px; margin-bottom: 4px; color: #1f2937;">${p.nombre}</div>
                            <div style="font-size: 11px; color: #6b7280; display: flex; gap: 8px; flex-wrap: wrap;">
                                <span style="background: #3b82f6; color: white; padding: 2px 6px; border-radius: 3px; font-weight: 600;">SKU: ${p.codigo}</span>
                                ${p.codigoProveedor ? `<span style="background: #8b5cf6; color: white; padding: 2px 6px; border-radius: 3px; font-weight: 600;">Prov: ${p.codigoProveedor}</span>` : ''}
                                ${p.codigo1 ? `<span style="background: #f59e0b; color: white; padding: 2px 6px; border-radius: 3px; font-weight: 600;">C1: ${p.codigo1}</span>` : ''}
                                <span style="color: ${p.stock < p.stockMinimo ? '#ef4444' : '#10b981'}; font-weight: 700;">Stock: ${p.stock}</span>
                            </div>
                        </div>
                        <div style="text-align: right; margin-left: 15px;">
                            <div style="font-size: 12px; color: #6b7280;">Costo actual</div>
                            <div style="font-size: 18px; font-weight: 800; color: #10b981;">$${(p.precioCosto || p.precio).toLocaleString()}</div>
                        </div>
                    </div>
                </div>
            `).join('')}
        </div>
    `;
}

function seleccionarProductoCompraDirect(codigo) {
    const producto = productos.find(p => p.codigo === codigo);
    if (!producto) return;
    
    // Limpiar b√∫squeda
    document.getElementById('busquedaDirectaCompra').value = '';
    document.getElementById('resultadosBusquedaCompra').innerHTML = '';
    
    // Abrir modal de cantidad y precio
    const modalCantidad = document.createElement('div');
    modalCantidad.id = 'modalCantidadCompra';
    modalCantidad.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 9999; display: flex; align-items: center; justify-content: center; padding: 20px;';
    
    modalCantidad.innerHTML = `
        <div style="background: white; border-radius: 12px; width: 100%; max-width: 600px; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
            <div style="padding: 20px 25px; border-bottom: 2px solid #e5e7eb; background: #10b981; color: white;">
                <h2 style="margin: 0; font-size: 20px; font-weight: 700;">‚úÖ ${producto.nombre}</h2>
                <p style="margin: 5px 0 0 0; opacity: 0.9; font-size: 14px;">Ingres√° cantidad y precio de compra</p>
            </div>
            
            <div style="padding: 25px;">
                <!-- Info del producto -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; padding: 15px; background: #f9fafb; border-radius: 8px;">
                    <div>
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">SKU / C√ìDIGO INTERNO</div>
                        <div style="font-weight: 700; font-size: 14px; font-family: monospace; color: #3b82f6;">${producto.codigo}</div>
                    </div>
                    <div>
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">STOCK ACTUAL</div>
                        <div style="font-weight: 800; font-size: 18px; color: ${producto.stock < producto.stockMinimo ? '#ef4444' : '#10b981'};">${producto.stock}</div>
                    </div>
                    ${producto.codigoProveedor ? `
                        <div>
                            <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">C√ìDIGO PROVEEDOR</div>
                            <div style="font-weight: 700; font-size: 14px; font-family: monospace; color: #8b5cf6;">${producto.codigoProveedor}</div>
                        </div>
                    ` : ''}
                    <div>
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 4px;">COSTO ACTUAL</div>
                        <div style="font-weight: 800; font-size: 16px; color: #10b981;">$${(producto.precioCosto || producto.precio).toLocaleString()}</div>
                    </div>
                </div>
                
                <!-- Inputs -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 13px;">üì¶ Cantidad a comprar:</label>
                        <input type="number" id="cantidadCompra" min="1" value="1"
                            style="width: 100%; padding: 14px; border: 2px solid #3b82f6; border-radius: 8px; font-size: 18px; text-align: center; font-weight: 700;"
                            onkeypress="if(event.key==='Enter') document.getElementById('precioUnitarioCompra').focus()">
                    </div>
                    
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 8px; font-size: 13px;">üí∞ Precio Unitario:</label>
                        <input type="number" id="precioUnitarioCompra" step="any" min="0" value="${producto.precioCosto || producto.precio}"
                            style="width: 100%; padding: 14px; border: 2px solid #10b981; border-radius: 8px; font-size: 18px; text-align: right; font-weight: 700;"
                            onkeypress="if(event.key==='Enter') confirmarAgregarProductoCompra('${codigo}')">
                    </div>
                </div>
                
                <!-- Total -->
                <div style="padding: 15px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                    <div style="font-size: 12px; color: #166534; font-weight: 600; margin-bottom: 5px;">SUBTOTAL</div>
                    <div style="font-size: 28px; font-weight: 800; color: #10b981;" id="subtotalPreview">$0</div>
                </div>
                
                <!-- Botones -->
                <div style="display: flex; gap: 10px;">
                    <button onclick="cerrarModalCantidadCompra()" 
                        style="flex: 1; padding: 14px; background: #6b7280; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 15px;">
                        ‚ùå CANCELAR
                    </button>
                    <button onclick="confirmarAgregarProductoCompra('${codigo}')" 
                        style="flex: 1; padding: 14px; background: #10b981; color: white; border: none; border-radius: 8px; font-weight: 700; cursor: pointer; font-size: 15px;">
                        ‚úÖ AGREGAR
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modalCantidad);
    
    // Focus autom√°tico y calcular subtotal en tiempo real
    setTimeout(() => {
        const cantidadInput = document.getElementById('cantidadCompra');
        const precioInput = document.getElementById('precioUnitarioCompra');
        const subtotalDiv = document.getElementById('subtotalPreview');
        
        const actualizarSubtotal = () => {
            const cant = parseFloat(cantidadInput.value) || 0;
            const precio = parseFloat(precioInput.value) || 0;
            subtotalDiv.textContent = '$' + (cant * precio).toLocaleString();
        };
        
        cantidadInput.addEventListener('input', actualizarSubtotal);
        precioInput.addEventListener('input', actualizarSubtotal);
        
        actualizarSubtotal();
        cantidadInput.focus();
        cantidadInput.select();
    }, 100);
}

function confirmarAgregarProductoCompra(codigo) {
    const producto = productos.find(p => p.codigo === codigo);
    const cantidad = parseInt(document.getElementById('cantidadCompra').value) || 1;
    const precioUnitario = parseFloat(document.getElementById('precioUnitarioCompra').value) || 0;
    
    if (cantidad <= 0 || precioUnitario <= 0) {
        alert('‚ö†Ô∏è Ingres√° cantidad y precio v√°lidos');
        return;
    }
    
    // Agregar a items
    itemsCompraActual.push({
        codigo: producto.codigo,
        nombre: producto.nombre,
        marca: producto.marca,
        cantidad: cantidad,
        precioUnitario: precioUnitario,
        subtotal: cantidad * precioUnitario
    });
    
    cerrarModalCantidadCompra();
    actualizarListaItemsCompra();
}

function actualizarListaItemsCompra() {
    const lista = document.getElementById('listaItemsCompra');
    if (!lista) return;
    
    if (itemsCompraActual.length === 0) {
        lista.innerHTML = `
            <div style="padding: 40px; text-align: center; background: #f9fafb; border-radius: 10px; border: 2px dashed #e5e7eb;">
                <div style="font-size: 48px; margin-bottom: 10px;">üì¶</div>
                <div style="font-size: 14px; color: #6b7280; font-weight: 600;">No hay productos agregados</div>
                <div style="font-size: 12px; color: #9ca3af; margin-top: 5px;">Hac√© click en "AGREGAR PRODUCTO" para empezar</div>
            </div>
        `;
        return;
    }
    
    const total = itemsCompraActual.reduce((sum, item) => sum + item.subtotal, 0);
    
    lista.innerHTML = `
        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: #f9fafb; border-bottom: 2px solid #e5e7eb;">
                        <th style="padding: 12px; text-align: left; font-size: 12px; font-weight: 700; color: #6b7280;">C√ìDIGO</th>
                        <th style="padding: 12px; text-align: left; font-size: 12px; font-weight: 700; color: #6b7280;">PRODUCTO</th>
                        <th style="padding: 12px; text-align: center; font-size: 12px; font-weight: 700; color: #6b7280;">CANTIDAD</th>
                        <th style="padding: 12px; text-align: right; font-size: 12px; font-weight: 700; color: #6b7280;">P. UNITARIO</th>
                        <th style="padding: 12px; text-align: right; font-size: 12px; font-weight: 700; color: #6b7280;">SUBTOTAL</th>
                        <th style="padding: 12px; text-align: center; font-size: 12px; font-weight: 700; color: #6b7280;">ACCIONES</th>
                    </tr>
                </thead>
                <tbody>
                    ${itemsCompraActual.map((item, index) => `
                        <tr style="border-bottom: 1px solid #e5e7eb;">
                            <td style="padding: 12px; font-family: monospace; font-size: 13px;">${item.codigo}</td>
                            <td style="padding: 12px;">
                                <div style="font-weight: 600; font-size: 14px;">${item.nombre}</div>
                                <div style="font-size: 12px; color: #6b7280;">${item.marca}</div>
                            </td>
                            <td style="padding: 12px; text-align: center; font-weight: 700; font-size: 16px;">${item.cantidad}</td>
                            <td style="padding: 12px; text-align: right; font-weight: 700; font-size: 14px;">$${item.precioUnitario.toLocaleString()}</td>
                            <td style="padding: 12px; text-align: right; font-weight: 800; font-size: 16px; color: #10b981;">$${item.subtotal.toLocaleString()}</td>
                            <td style="padding: 12px; text-align: center;">
                                <button onclick="eliminarItemCompra(${index})" 
                                    style="padding: 6px 12px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; font-weight: 700;">
                                    üóëÔ∏è
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
                <tfoot>
                    <tr style="background: #f9fafb; border-top: 3px solid #e5e7eb;">
                        <td colspan="4" style="padding: 15px; text-align: right; font-weight: 800; font-size: 16px;">TOTAL:</td>
                        <td style="padding: 15px; text-align: right; font-weight: 800; font-size: 20px; color: #10b981;">$${total.toLocaleString()}</td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    `;
}

function eliminarItemCompra(index) {
    if (confirm('¬øEliminar este producto de la compra?')) {
        itemsCompraActual.splice(index, 1);
        actualizarListaItemsCompra();
    }
}

function cerrarModalSeleccionarProducto() {
    const modal = document.getElementById('modalSeleccionarProducto');
    if (modal) modal.remove();
}

function cerrarModalCantidadCompra() {
    const modal = document.getElementById('modalCantidadCompra');
    if (modal) modal.remove();
}

        function guardarCompraManual() {
            const proveedor = document.getElementById('proveedorCompra')?.value;
            const nroRemito = document.getElementById('nroRemitoCompra')?.value;
            const actualizarCostos = document.getElementById('actualizarCostosCheck')?.checked;
            
            if (!proveedor) {
                alert('‚ö†Ô∏è Seleccion√° un proveedor');
                return;
            }
            
            if (itemsCompraActual.length === 0) {
                alert('‚ö†Ô∏è Agreg√° al menos un producto');
                return;
            }
            
            // Actualizar stock y costos si est√° marcado
            if (actualizarCostos) {
                itemsCompraActual.forEach(item => {
                    const producto = productos.find(p => p.codigo === item.codigo);
                    if (producto) {
                        producto.stock += item.cantidad;
                        producto.precioCosto = item.precioUnitario;
                    }
                });
            } else {
                // Solo actualizar stock
                itemsCompraActual.forEach(item => {
                    const producto = productos.find(p => p.codigo === item.codigo);
                    if (producto) {
                        producto.stock += item.cantidad;
                    }
                });
            }
            
            const total = itemsCompraActual.reduce((sum, item) => sum + item.subtotal, 0);
            
            alert(`‚úÖ COMPRA GUARDADA

Proveedor: ${proveedor}
Remito: ${nroRemito || 'Sin remito'}
Productos: ${itemsCompraActual.length}
Total: $${total.toLocaleString()}

${actualizarCostos ? 'üí∞ Costos actualizados' : 'üì¶ Solo stock actualizado'}`);
            
            // Limpiar items
            itemsCompraActual = [];
            
            // Ir al historial
            cambiarPestanaCompras('historial');
        }
            
        
        function cancelarCompra() {
            if (confirm('¬øCancelar la compra?')) {
                cambiarPestanaCompras('historial');
            }
        }
        
        function procesarArchivoIA(archivo) {
            if (!archivo) return;
            
            // Simular procesamiento IA
            alert(`ü§ñ PROCESANDO CON IA...\n\nArchivo: ${archivo.name}\nTama√±o: ${(archivo.size/1024).toFixed(1)} KB\n\n‚è≥ La IA est√° analizando el documento...`);
            
            // Simular items detectados
            setTimeout(() => {
                itemsIA = [
                    { codigo: 'T-001', nombre: 'Tornillo 1/4" x 2"', cantidad: 100, precioUnitario: 25 },
                    { codigo: 'T-002', nombre: 'Tornillo 3/8" x 3"', cantidad: 50, precioUnitario: 45 },
                    { codigo: 'C-001', nombre: 'Clavo 2 1/2"', cantidad: 200, precioUnitario: 15 },
                    { codigo: 'P-001', nombre: 'Pintura Latex Blanca 20L', cantidad: 10, precioUnitario: 3500 },
                    { codigo: 'A-001', nombre: 'Alambre Galvanizado #12', cantidad: 25, precioUnitario: 180 }
                ];
                
                cargarModulo('compras');
                alert('‚úÖ ¬°PROCESAMIENTO COMPLETO!\n\nLa IA detect√≥ 5 productos.\nRevis√° los datos y confirm√°.');
            }, 1500);
        }
        
        function eliminarItemIA(idx) {
            if (confirm('¬øEliminar este producto?')) {
                itemsIA.splice(idx, 1);
                cargarModulo('compras');
            }
        }
        
        function confirmarCompraIA() {
            const actualizar = document.getElementById('actualizarCostosIA')?.checked;
            const total = itemsIA.reduce((sum, item) => sum + (item.cantidad * item.precioUnitario), 0);
            
            if (confirm(`¬øConfirmar compra?\n\nProductos: ${itemsIA.length}\nTotal: $${total.toLocaleString()}\nActualizar costos: ${actualizar ? 'SI' : 'NO'}`)) {
                // Guardar compra
                compras.unshift({
                    id: compras.length + 1,
                    fecha: new Date().toISOString().split('T')[0],
                    proveedor: document.getElementById('proveedorIA')?.value || 'Proveedor',
                    nroRemito: document.getElementById('remitoIA')?.value || 'REM-0000',
                    items: itemsIA.length,
                    total: total,
                    actualizoCostos: actualizar,
                    estado: 'Ingresada'
                });
                
                itemsIA = [];
                alert('‚úÖ ¬°COMPRA GUARDADA!\n\nLa mercader√≠a fue ingresada correctamente');
                cambiarPestanaCompras('historial');
            }
        }
        
        function cancelarCompraIA() {
            if (confirm('¬øCancelar? Se perder√°n los datos procesados.')) {
                itemsIA = [];
                cargarModulo('compras');
            }
        }
        
        function verDetalleCompra(id) {
            const compra = compras.find(c => c.id === id);
            if (compra) {
                alert(`üìã DETALLE DE COMPRA\n\nProveedor: ${compra.proveedor}\nRemito: ${compra.nroRemito}\nFecha: ${compra.fecha}\nItems: ${compra.items}\nTotal: $${compra.total.toLocaleString()}\n\nüí° Funcionalidad completa en desarrollo`);
            }
        }
        
        function aplicarAjustePorcentaje() {
            const porc = document.getElementById('porcentajeAjuste')?.value;
            if (confirm(`¬øAplicar ${porc}% de ajuste a TODOS los costos?`)) {
                alert(`‚úÖ AJUSTE APLICADO\n\nTodos los costos fueron incrementados un ${porc}%`);
            }
        }
        
        function aplicarAjusteMonto() {
            const monto = document.getElementById('montoAjuste')?.value;
            if (confirm(`¬øSumar $${monto} a TODOS los costos?`)) {
                alert(`‚úÖ AJUSTE APLICADO\n\nSe sum√≥ $${monto} a todos los costos`);
            }
        }
        
        function editarCosto(idx) {
            alert(`‚úèÔ∏è EDITAR COSTO\n\nProducto: ${productos[idx].nombre}\n\nüí° Funcionalidad en desarrollo`);
        }



        
        
        
        
        function cambiarPestanaCompras(pestana) {
            pestanaComprasActivaNew = pestana;
            cargarModulo('compras');
        }
        
        function getContenidoPestanaCompras() {
            switch(pestanaComprasActivaNew) {
                case 'ia': return getPestanaImportarIA();
                case 'historial': return getPestanaHistorial();
                case 'actualizar': return getPestanaActualizarCostos();
                default: return getPestanaNuevaCompra();
            }
        }
        
        // ========== PESTA√ëA: NUEVA COMPRA (MANUAL) ==========
        function getPestanaNuevaCompra() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚ûï Ingreso Manual de Compra</h3>
                    </div>
                    <div class="card-body">
                        <!-- Datos de la compra -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; padding: 20px; background: #f9fafb; border-radius: 10px;">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Proveedor</label>
                                <select id="proveedorCompra" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                                    <option value="">Seleccionar...</option>
                                    <option value="Walker">Distribuidora Walker</option>
                                    <option value="Ferreter√≠a Mayorista SA">Ferreter√≠a Mayorista SA</option>
                                    <option value="Importadora ABC">Importadora ABC</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Nro. Remito</label>
                                <input type="text" id="nroRemitoCompra" placeholder="REM-12345" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Fecha</label>
                                <input type="date" id="fechaCompra" value="${new Date().toISOString().split('T')[0]}" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                            </div>
                        </div>
                        
                        <!-- Actualizar costos -->
                        <div style="margin-bottom: 25px; padding: 15px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="actualizarCostosCheck" checked 
                                    style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 700; font-size: 14px; color: #92400e;">¬øActualizar costos de productos?</div>
                                    <div style="font-size: 12px; color: #92400e;">Si activ√°s esto, los precios de compra de los productos se actualizar√°n</div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- Agregar productos -->
                        <div style="margin-bottom: 20px;">
                            <button class="btn-primary" onclick="agregarItemCompra()">
                                ‚ûï AGREGAR PRODUCTO
                            </button>
                        </div>
                        
                        <!-- Lista de productos -->
                        <div id="listaItemsCompra">
                            <div style="padding: 40px; text-align: center; background: #f9fafb; border-radius: 10px; border: 2px dashed #e5e7eb;">
                                <div style="font-size: 48px; margin-bottom: 10px;">üì¶</div>
                                <div style="font-size: 14px; color: #6b7280; font-weight: 600;">No hay productos agregados</div>
                                <div style="font-size: 12px; color: #9ca3af; margin-top: 5px;">Hac√© click en "AGREGAR PRODUCTO" para empezar</div>
                            </div>
                        </div>
                        
                        <!-- Bot√≥n guardar -->
                        <div style="margin-top: 25px; display: flex; gap: 10px;">
                            <button class="btn-primary" style="background: #10b981; font-size: 16px; padding: 12px 30px;" 
                                onclick="guardarCompraManual()">
                                ‚úÖ GUARDAR COMPRA
                            </button>
                            <button class="btn-primary" style="background: #6b7280; font-size: 16px; padding: 12px 30px;" 
                                onclick="cancelarCompra()">
                                ‚ùå CANCELAR
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: IMPORTAR CON IA ==========
        function getPestanaImportarIA() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 12px; color: white;">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">ü§ñ Importar con Inteligencia Artificial</h3>
                        <p style="opacity: 0.9;">Sub√≠ un PDF o imagen del remito y la IA lo procesar√° autom√°ticamente</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üì§ Subir Archivo</h3>
                    </div>
                    <div class="card-body">
                        <!-- Zona de carga -->
                        <div style="margin-bottom: 30px; padding: 40px; background: #f9fafb; border: 3px dashed #8b5cf6; border-radius: 12px; text-align: center;">
                            <div style="font-size: 64px; margin-bottom: 15px;">üìÑ</div>
                            <div style="font-size: 16px; font-weight: 700; color: #1a1f2e; margin-bottom: 10px;">
                                Arrastr√° tu archivo aqu√≠ o hac√© click para seleccionar
                            </div>
                            <div style="font-size: 13px; color: #6b7280; margin-bottom: 20px;">
                                Formatos aceptados: PDF, JPG, PNG | Tama√±o m√°ximo: 10MB
                            </div>
                            <input type="file" id="archivoCompraIA" accept=".pdf,.jpg,.jpeg,.png" 
                                onchange="procesarArchivoIA(this.files[0])"
                                style="display: none;">
                            <button class="btn-primary" style="background: #8b5cf6; font-size: 16px; padding: 12px 30px;" 
                                onclick="document.getElementById('archivoCompraIA').click()">
                                üìÅ SELECCIONAR ARCHIVO
                            </button>
                        </div>
                        
                        <!-- Instrucciones -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div style="padding: 20px; background: #f0fdf4; border-radius: 10px; border-left: 4px solid #10b981;">
                                <div style="font-size: 32px; margin-bottom: 10px;">1Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Sub√≠ el archivo</div>
                                <div style="font-size: 12px; color: #6b7280;">PDF o foto del remito del proveedor</div>
                            </div>
                            <div style="padding: 20px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <div style="font-size: 32px; margin-bottom: 10px;">2Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">IA procesa</div>
                                <div style="font-size: 12px; color: #6b7280;">Extrae productos, cantidades y precios</div>
                            </div>
                            <div style="padding: 20px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <div style="font-size: 32px; margin-bottom: 10px;">3Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Revis√°s y confirm√°s</div>
                                <div style="font-size: 12px; color: #6b7280;">Ajust√°s si hace falta y guard√°s</div>
                            </div>
                        </div>
                        
                        <!-- Resultado del procesamiento IA -->
                        <div id="resultadoIA" style="margin-top: 30px;">
                            ${itemsIA.length > 0 ? getResultadoIA() : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getResultadoIA() {
            const total = itemsIA.reduce((sum, item) => sum + (item.cantidad * item.precioUnitario), 0);
            
            return `
                <div style="padding: 20px; background: #dcfce7; border-radius: 12px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div style="font-size: 32px;">‚úÖ</div>
                        <div>
                            <div style="font-weight: 700; font-size: 16px; color: #166534;">¬°Archivo procesado correctamente!</div>
                            <div style="font-size: 13px; color: #166534;">La IA detect√≥ ${itemsIA.length} productos</div>
                        </div>
                    </div>
                </div>
                
                <!-- Datos detectados -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Proveedor detectado</label>
                        <input type="text" id="proveedorIA" value="Distribuidora Walker" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Nro. Remito</label>
                        <input type="text" id="remitoIA" value="REM-${Math.floor(Math.random() * 10000)}" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Fecha</label>
                        <input type="date" id="fechaIA" value="${new Date().toISOString().split('T')[0]}" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>
                
                <!-- Actualizar costos -->
                <div style="margin-bottom: 20px; padding: 15px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="actualizarCostosIA" checked 
                            style="width: 20px; height: 20px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 700; font-size: 14px; color: #92400e;">¬øActualizar costos de productos?</div>
                            <div style="font-size: 12px; color: #92400e;">Los precios de compra se actualizar√°n autom√°ticamente</div>
                        </div>
                    </label>
                </div>
                
                <!-- Productos detectados -->
                <div style="margin-bottom: 20px;">
                    <h4 style="font-weight: 700; margin-bottom: 15px;">üì¶ Productos Detectados</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>C√≥digo</th>
                                <th>Cantidad</th>
                                <th>Precio Unit.</th>
                                <th>Subtotal</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsIA.map((item, idx) => `
                                <tr>
                                    <td>
                                        <input type="text" value="${item.nombre}" 
                                            style="width: 100%; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 13px;"
                                            onchange="itemsIA[${idx}].nombre = this.value">
                                    </td>
                                    <td style="font-family: monospace; font-weight: 700;">${item.codigo}</td>
                                    <td>
                                        <input type="number" value="${item.cantidad}" min="1"
                                            style="width: 80px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: center; font-weight: 700;"
                                            onchange="itemsIA[${idx}].cantidad = parseInt(this.value); cargarModulo('compras')">
                                    </td>
                                    <td>
                                        <input type="number" value="${item.precioUnitario}" min="0"
                                            style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: right; font-weight: 700;"
                                            onchange="itemsIA[${idx}].precioUnitario = parseFloat(this.value); cargarModulo('compras')">
                                    </td>
                                    <td style="font-weight: 800; font-size: 15px;">$${(item.cantidad * item.precioUnitario).toLocaleString()}</td>
                                    <td>
                                        <button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: #ef4444;" 
                                            onclick="eliminarItemIA(${idx})">
                                            üóëÔ∏è
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot>
                            <tr style="background: #f9fafb; font-weight: 800;">
                                <td colspan="4" style="text-align: right; padding: 15px;">TOTAL:</td>
                                <td style="font-size: 20px; color: #10b981;">$${total.toLocaleString()}</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <!-- Botones -->
                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" style="background: #10b981; font-size: 16px; padding: 12px 30px;" 
                        onclick="confirmarCompraIA()">
                        ‚úÖ CONFIRMAR Y GUARDAR
                    </button>
                    <button class="btn-primary" style="background: #6b7280; font-size: 16px; padding: 12px 30px;" 
                        onclick="cancelarCompraIA()">
                        ‚ùå CANCELAR
                    </button>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: HISTORIAL ==========
        function getPestanaHistorial() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Historial de Compras</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Proveedor</th>
                                    <th>Nro. Remito</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Actualiz√≥ Costos</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${comprasProveedoresProveedores.map(c => `
                                    <tr>
                                        <td style="font-weight: 600;">${c.fecha}</td>
                                        <td style="font-weight: 700;">${c.proveedor}</td>
                                        <td style="font-family: monospace; font-weight: 600;">${c.nroRemito}</td>
                                        <td style="text-align: center;">
                                            <span style="padding: 4px 12px; background: #dbeafe; color: #1e40af; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${c.items} items
                                            </span>
                                        </td>
                                        <td style="font-weight: 800; font-size: 16px; color: #10b981;">$${c.total.toLocaleString()}</td>
                                        <td style="text-align: center;">
                                            ${c.actualizoCostos ? 
                                                '<span style="font-size: 20px;">‚úÖ</span>' : 
                                                '<span style="font-size: 20px;">‚ùå</span>'
                                            }
                                        </td>
                                        <td>
                                            <span style="padding: 6px 12px; background: #dcfce7; color: #16a34a; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${c.estado}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn-primary" style="padding: 6px 12px; font-size: 12px;" 
                                                onclick="verDetalleCompra(${c.id})">
                                                üëÅÔ∏è Ver
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: ACTUALIZAR COSTOS ==========
        function getPestanaActualizarCostos() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; color: white;">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">üí∞ Actualizaci√≥n Masiva de Costos</h3>
                        <p style="opacity: 0.9;">Actualiz√° los precios de compra de m√∫ltiples productos a la vez</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üí∞ Actualizar Precios de Compra</h3>
                    </div>
                    <div class="card-body">
                        <!-- Opciones de actualizaci√≥n -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                            <div style="padding: 20px; background: #f9fafb; border-radius: 10px; border: 2px solid #e5e7eb;">
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üìà Ajuste por Porcentaje</h4>
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <div style="flex: 1;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Porcentaje</label>
                                        <input type="number" id="porcentajeAjuste" value="10" 
                                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px; font-weight: 700;">
                                    </div>
                                    <button class="btn-primary" style="background: #10b981;" onclick="aplicarAjustePorcentaje()">
                                        ‚úÖ APLICAR
                                    </button>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 10px;">
                                    Ejemplo: 10% aumenta todos los costos un 10%
                                </div>
                            </div>
                            
                            <div style="padding: 20px; background: #f9fafb; border-radius: 10px; border: 2px solid #e5e7eb;">
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üíµ Ajuste por Monto Fijo</h4>
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <div style="flex: 1;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Monto $</label>
                                        <input type="number" id="montoAjuste" value="50" 
                                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px; font-weight: 700;">
                                    </div>
                                    <button class="btn-primary" style="background: #3b82f6;" onclick="aplicarAjusteMonto()">
                                        ‚úÖ APLICAR
                                    </button>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 10px;">
                                    Ejemplo: $50 suma $50 a cada costo
                                </div>
                            </div>
                        </div>
                        
                        <!-- Vista previa de productos -->
                        <div>
                            <h4 style="font-weight: 700; margin-bottom: 15px;">üì¶ Vista Previa de Costos</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Costo Actual</th>
                                        <th>Precio Venta</th>
                                        <th>Margen Actual</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productos.slice(0, 10).map((p, idx) => {
                                        const costo = Math.round(p.precio * 0.6);
                                        const margen = Math.round(((p.precio - costo) / costo) * 100);
                                        return `
                                            <tr>
                                                <td>
                                                    <div style="font-weight: 700;">${p.nombre}</div>
                                                    <div style="font-size: 11px; color: #6b7280;">${p.marca}</div>
                                                </td>
                                                <td style="font-weight: 700; font-size: 15px;">$${costo.toLocaleString()}</td>
                                                <td style="font-weight: 700; font-size: 15px; color: #10b981;">$${p.precio.toLocaleString()}</td>
                                                <td>
                                                    <span style="padding: 6px 12px; background: ${margen > 40 ? '#dcfce7' : '#fef3c7'}; color: ${margen > 40 ? '#16a34a' : '#f59e0b'}; font-weight: 700; border-radius: 6px; font-size: 12px;">
                                                        ${margen}%
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn-primary" style="padding: 6px 12px; font-size: 11px;" 
                                                        onclick="editarCosto(${idx})">
                                                        ‚úèÔ∏è Editar
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ========== FUNCIONES ==========
        
        
        function guardarCompraManual() {
            const proveedor = document.getElementById('proveedorCompra')?.value;
            const nroRemito = document.getElementById('nroRemitoCompra')?.value;
            const actualizarCostos = document.getElementById('actualizarCostosCheck')?.checked;
            
            if (!proveedor) {
                alert('‚ö†Ô∏è Seleccion√° un proveedor');
                return;
            }
            
            if (itemsCompraActual.length === 0) {
                alert('‚ö†Ô∏è Agreg√° al menos un producto');
                return;
            }
            
            // Actualizar stock y costos si est√° marcado
            if (actualizarCostos) {
                itemsCompraActual.forEach(item => {
                    const producto = productos.find(p => p.codigo === item.codigo);
                    if (producto) {
                        producto.stock += item.cantidad;
                        producto.precioCosto = item.precioUnitario;
                    }
                });
            } else {
                // Solo actualizar stock
                itemsCompraActual.forEach(item => {
                    const producto = productos.find(p => p.codigo === item.codigo);
                    if (producto) {
                        producto.stock += item.cantidad;
                    }
                });
            }
            
            const total = itemsCompraActual.reduce((sum, item) => sum + item.subtotal, 0);
            
            alert(`‚úÖ COMPRA GUARDADA

Proveedor: ${proveedor}
Remito: ${nroRemito || 'Sin remito'}
Productos: ${itemsCompraActual.length}
Total: $${total.toLocaleString()}

${actualizarCostos ? 'üí∞ Costos actualizados' : 'üì¶ Solo stock actualizado'}`);
            
            // Limpiar items
            itemsCompraActual = [];
            
            // Ir al historial
            cambiarPestanaCompras('historial');
        }
            
        
        function cancelarCompra() {
            if (confirm('¬øCancelar la compra?')) {
                cambiarPestanaCompras('historial');
            }
        }
        
        function procesarArchivoIA(archivo) {
            if (!archivo) return;
            
            // Simular procesamiento IA
            alert(`ü§ñ PROCESANDO CON IA...\n\nArchivo: ${archivo.name}\nTama√±o: ${(archivo.size/1024).toFixed(1)} KB\n\n‚è≥ La IA est√° analizando el documento...`);
            
            // Simular items detectados
            setTimeout(() => {
                itemsIA = [
                    { codigo: 'T-001', nombre: 'Tornillo 1/4" x 2"', cantidad: 100, precioUnitario: 25 },
                    { codigo: 'T-002', nombre: 'Tornillo 3/8" x 3"', cantidad: 50, precioUnitario: 45 },
                    { codigo: 'C-001', nombre: 'Clavo 2 1/2"', cantidad: 200, precioUnitario: 15 },
                    { codigo: 'P-001', nombre: 'Pintura Latex Blanca 20L', cantidad: 10, precioUnitario: 3500 },
                    { codigo: 'A-001', nombre: 'Alambre Galvanizado #12', cantidad: 25, precioUnitario: 180 }
                ];
                
                cargarModulo('compras');
                alert('‚úÖ ¬°PROCESAMIENTO COMPLETO!\n\nLa IA detect√≥ 5 productos.\nRevis√° los datos y confirm√°.');
            }, 1500);
        }
        
        function eliminarItemIA(idx) {
            if (confirm('¬øEliminar este producto?')) {
                itemsIA.splice(idx, 1);
                cargarModulo('compras');
            }
        }
        
        function confirmarCompraIA() {
            const actualizar = document.getElementById('actualizarCostosIA')?.checked;
            const total = itemsIA.reduce((sum, item) => sum + (item.cantidad * item.precioUnitario), 0);
            
            if (confirm(`¬øConfirmar compra?\n\nProductos: ${itemsIA.length}\nTotal: $${total.toLocaleString()}\nActualizar costos: ${actualizar ? 'SI' : 'NO'}`)) {
                // Guardar compra
                comprasProveedores.unshift({
                    id: comprasProveedores.length + 1,
                    fecha: new Date().toISOString().split('T')[0],
                    proveedor: document.getElementById('proveedorIA')?.value || 'Proveedor',
                    nroRemito: document.getElementById('remitoIA')?.value || 'REM-0000',
                    items: itemsIA.length,
                    total: total,
                    actualizoCostos: actualizar,
                    estado: 'Ingresada'
                });
                
                itemsIA = [];
                alert('‚úÖ ¬°COMPRA GUARDADA!\n\nLa mercader√≠a fue ingresada correctamente');
                cambiarPestanaCompras('historial');
            }
        }
        
        function cancelarCompraIA() {
            if (confirm('¬øCancelar? Se perder√°n los datos procesados.')) {
                itemsIA = [];
                cargarModulo('compras');
            }
        }
        
        function verDetalleCompra(id) {
            const compra = comprasProveedores.find(c => c.id === id);
            if (compra) {
                alert(`üìã DETALLE DE COMPRA\n\nProveedor: ${compra.proveedor}\nRemito: ${compra.nroRemito}\nFecha: ${compra.fecha}\nItems: ${compra.items}\nTotal: $${compra.total.toLocaleString()}\n\nüí° Funcionalidad completa en desarrollo`);
            }
        }
        
        function aplicarAjustePorcentaje() {
            const porc = document.getElementById('porcentajeAjuste')?.value;
            if (confirm(`¬øAplicar ${porc}% de ajuste a TODOS los costos?`)) {
                alert(`‚úÖ AJUSTE APLICADO\n\nTodos los costos fueron incrementados un ${porc}%`);
            }
        }
        
        function aplicarAjusteMonto() {
            const monto = document.getElementById('montoAjuste')?.value;
            if (confirm(`¬øSumar $${monto} a TODOS los costos?`)) {
                alert(`‚úÖ AJUSTE APLICADO\n\nSe sum√≥ $${monto} a todos los costos`);
            }
        }
        
        function editarCosto(idx) {
            alert(`‚úèÔ∏è EDITAR COSTO\n\nProducto: ${productos[idx].nombre}\n\nüí° Funcionalidad en desarrollo`);
        }




        // ==================== COMPRAS ====================
        let pestanaComprasActivaNew = 'nueva';
        
        // Historial de compras
        const comprasProveedores = [
            { 
                id: 1, 
                fecha: '2026-01-28', 
                proveedor: 'Distribuidora Walker', 
                nroRemito: 'REM-00125', 
                items: 8, 
                total: 125000, 
                actualizoCostos: true,
                estado: 'Ingresada'
            },
            { 
                id: 2, 
                fecha: '2026-01-25', 
                proveedor: 'Ferreter√≠a Mayorista SA', 
                nroRemito: 'R-4521', 
                items: 12, 
                total: 89500, 
                actualizoCostos: false,
                estado: 'Ingresada'
            }
        ];
        
        // Compra temporal para procesar
        let compraTemp = {
            proveedor: '',
            nroRemito: '',
            fecha: new Date().toISOString().split('T')[0],
            items: [],
            actualizarCostos: true
        };
        
        // Items procesados por IA
        let itemsIA = [];
        
        function getComprasHTML() {
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 24px; font-weight: 800; margin-bottom: 5px;">üì¶ Compras e Ingreso de Mercader√≠a</h2>
                    <p style="color: #6b7280;">Ingreso manual o autom√°tico con IA procesando PDF/im√°genes</p>
                </div>
                
                <!-- M√©tricas superiores -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 25px;">
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">COMPRAS ESTE MES</div>
                        <div style="font-size: 28px; font-weight: 800; color: #3b82f6;">${comprasProveedores.length}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #10b981;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">TOTAL INVERTIDO</div>
                        <div style="font-size: 28px; font-weight: 800; color: #10b981;">$${(comprasProveedores.reduce((sum, c) => sum + c.total, 0)/1000).toFixed(0)}K</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #f59e0b;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">ITEMS INGRESADOS</div>
                        <div style="font-size: 28px; font-weight: 800; color: #f59e0b;">${comprasProveedores.reduce((sum, c) => sum + c.items, 0)}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #8b5cf6;">
                        <div style="font-size: 10px; color: #6b7280; font-weight: 600;">PROVEEDORES ACTIVOS</div>
                        <div style="font-size: 28px; font-weight: 800; color: #8b5cf6;">3</div>
                    </div>
                </div>
                
                <!-- Pesta√±as -->
                <div style="display: flex; gap: 10px; margin-bottom: 25px; border-bottom: 3px solid #e5e7eb; overflow-x: auto; padding-bottom: 5px;">
                    <button class="btn-primary" style="background: ${pestanaComprasActivaNew === 'nueva' ? '#3b82f6' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaCompras('nueva')">‚ûï Nueva Compra</button>
                    <button class="btn-primary" style="background: ${pestanaComprasActivaNew === 'ia' ? '#8b5cf6' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaCompras('ia')">ü§ñ Importar con IA</button>
                    <button class="btn-primary" style="background: ${pestanaComprasActivaNew === 'historial' ? '#10b981' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaCompras('historial')">üìã Historial</button>
                    <button class="btn-primary" style="background: ${pestanaComprasActivaNew === 'actualizar' ? '#f59e0b' : '#6b7280'}; padding: 10px 20px; white-space: nowrap;" 
                        onclick="cambiarPestanaCompras('actualizar')">üí∞ Actualizar Costos</button>
                </div>
                
                <div id="contenidoCompras">${getContenidoPestanaCompras()}</div>
            `;
        }
        
        function cambiarPestanaCompras(pestana) {
            pestanaComprasActivaNew = pestana;
            cargarModulo('compras');
        }
        
        function getContenidoPestanaCompras() {
            switch(pestanaComprasActivaNew) {
                case 'ia': return getPestanaImportarIA();
                case 'historial': return getPestanaHistorial();
                case 'actualizar': return getPestanaActualizarCostos();
                default: return getPestanaNuevaCompra();
            }
        }
        
        // ========== PESTA√ëA: NUEVA COMPRA (MANUAL) ==========
        function getPestanaNuevaCompra() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">‚ûï Ingreso Manual de Compra</h3>
                    </div>
                    <div class="card-body">
                        <!-- Datos de la compra -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 25px; padding: 20px; background: #f9fafb; border-radius: 10px;">
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Proveedor</label>
                                <select id="proveedorCompra" style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                                    <option value="">Seleccionar...</option>
                                    <option value="Walker">Distribuidora Walker</option>
                                    <option value="Ferreter√≠a Mayorista SA">Ferreter√≠a Mayorista SA</option>
                                    <option value="Importadora ABC">Importadora ABC</option>
                                </select>
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Nro. Remito</label>
                                <input type="text" id="nroRemitoCompra" placeholder="REM-12345" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                            </div>
                            <div>
                                <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Fecha</label>
                                <input type="date" id="fechaCompra" value="${new Date().toISOString().split('T')[0]}" 
                                    style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                            </div>
                        </div>
                        
                        <!-- Actualizar costos -->
                        <div style="margin-bottom: 25px; padding: 15px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="actualizarCostosCheck" checked 
                                    style="width: 20px; height: 20px; cursor: pointer;">
                                <div>
                                    <div style="font-weight: 700; font-size: 14px; color: #92400e;">¬øActualizar costos de productos?</div>
                                    <div style="font-size: 12px; color: #92400e;">Si activ√°s esto, los precios de compra de los productos se actualizar√°n</div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- Agregar productos -->
                        <div style="margin-bottom: 20px;">
                            <button class="btn-primary" onclick="agregarItemCompra()">
                                ‚ûï AGREGAR PRODUCTO
                            </button>
                        </div>
                        
                        <!-- Lista de productos -->
                        <div id="listaItemsCompra">
                            <div style="padding: 40px; text-align: center; background: #f9fafb; border-radius: 10px; border: 2px dashed #e5e7eb;">
                                <div style="font-size: 48px; margin-bottom: 10px;">üì¶</div>
                                <div style="font-size: 14px; color: #6b7280; font-weight: 600;">No hay productos agregados</div>
                                <div style="font-size: 12px; color: #9ca3af; margin-top: 5px;">Hac√© click en "AGREGAR PRODUCTO" para empezar</div>
                            </div>
                        </div>
                        
                        <!-- Bot√≥n guardar -->
                        <div style="margin-top: 25px; display: flex; gap: 10px;">
                            <button class="btn-primary" style="background: #10b981; font-size: 16px; padding: 12px 30px;" 
                                onclick="guardarCompraManual()">
                                ‚úÖ GUARDAR COMPRA
                            </button>
                            <button class="btn-primary" style="background: #6b7280; font-size: 16px; padding: 12px 30px;" 
                                onclick="cancelarCompra()">
                                ‚ùå CANCELAR
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: IMPORTAR CON IA ==========
        function getPestanaImportarIA() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); border-radius: 12px; color: white;">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">ü§ñ Importar con Inteligencia Artificial</h3>
                        <p style="opacity: 0.9;">Sub√≠ un PDF o imagen del remito y la IA lo procesar√° autom√°ticamente</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üì§ Subir Archivo</h3>
                    </div>
                    <div class="card-body">
                        <!-- Zona de carga -->
                        <div style="margin-bottom: 30px; padding: 40px; background: #f9fafb; border: 3px dashed #8b5cf6; border-radius: 12px; text-align: center;">
                            <div style="font-size: 64px; margin-bottom: 15px;">üìÑ</div>
                            <div style="font-size: 16px; font-weight: 700; color: #1a1f2e; margin-bottom: 10px;">
                                Arrastr√° tu archivo aqu√≠ o hac√© click para seleccionar
                            </div>
                            <div style="font-size: 13px; color: #6b7280; margin-bottom: 20px;">
                                Formatos aceptados: PDF, JPG, PNG | Tama√±o m√°ximo: 10MB
                            </div>
                            <input type="file" id="archivoCompraIA" accept=".pdf,.jpg,.jpeg,.png" 
                                onchange="procesarArchivoIA(this.files[0])"
                                style="display: none;">
                            <button class="btn-primary" style="background: #8b5cf6; font-size: 16px; padding: 12px 30px;" 
                                onclick="document.getElementById('archivoCompraIA').click()">
                                üìÅ SELECCIONAR ARCHIVO
                            </button>
                        </div>
                        
                        <!-- Instrucciones -->
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                            <div style="padding: 20px; background: #f0fdf4; border-radius: 10px; border-left: 4px solid #10b981;">
                                <div style="font-size: 32px; margin-bottom: 10px;">1Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Sub√≠ el archivo</div>
                                <div style="font-size: 12px; color: #6b7280;">PDF o foto del remito del proveedor</div>
                            </div>
                            <div style="padding: 20px; background: #f0f9ff; border-radius: 10px; border-left: 4px solid #3b82f6;">
                                <div style="font-size: 32px; margin-bottom: 10px;">2Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">IA procesa</div>
                                <div style="font-size: 12px; color: #6b7280;">Extrae productos, cantidades y precios</div>
                            </div>
                            <div style="padding: 20px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                                <div style="font-size: 32px; margin-bottom: 10px;">3Ô∏è‚É£</div>
                                <div style="font-weight: 700; margin-bottom: 5px;">Revis√°s y confirm√°s</div>
                                <div style="font-size: 12px; color: #6b7280;">Ajust√°s si hace falta y guard√°s</div>
                            </div>
                        </div>
                        
                        <!-- Resultado del procesamiento IA -->
                        <div id="resultadoIA" style="margin-top: 30px;">
                            ${itemsIA.length > 0 ? getResultadoIA() : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function getResultadoIA() {
            const total = itemsIA.reduce((sum, item) => sum + (item.cantidad * item.precioUnitario), 0);
            
            return `
                <div style="padding: 20px; background: #dcfce7; border-radius: 12px; border-left: 4px solid #10b981; margin-bottom: 20px;">
                    <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                        <div style="font-size: 32px;">‚úÖ</div>
                        <div>
                            <div style="font-weight: 700; font-size: 16px; color: #166534;">¬°Archivo procesado correctamente!</div>
                            <div style="font-size: 13px; color: #166534;">La IA detect√≥ ${itemsIA.length} productos</div>
                        </div>
                    </div>
                </div>
                
                <!-- Datos detectados -->
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Proveedor detectado</label>
                        <input type="text" id="proveedorIA" value="Distribuidora Walker" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Nro. Remito</label>
                        <input type="text" id="remitoIA" value="REM-${Math.floor(Math.random() * 10000)}" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                    <div>
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Fecha</label>
                        <input type="date" id="fechaIA" value="${new Date().toISOString().split('T')[0]}" 
                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 14px;">
                    </div>
                </div>
                
                <!-- Actualizar costos -->
                <div style="margin-bottom: 20px; padding: 15px; background: #fef3c7; border-radius: 10px; border-left: 4px solid #f59e0b;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                        <input type="checkbox" id="actualizarCostosIA" checked 
                            style="width: 20px; height: 20px; cursor: pointer;">
                        <div>
                            <div style="font-weight: 700; font-size: 14px; color: #92400e;">¬øActualizar costos de productos?</div>
                            <div style="font-size: 12px; color: #92400e;">Los precios de compra se actualizar√°n autom√°ticamente</div>
                        </div>
                    </label>
                </div>
                
                <!-- Productos detectados -->
                <div style="margin-bottom: 20px;">
                    <h4 style="font-weight: 700; margin-bottom: 15px;">üì¶ Productos Detectados</h4>
                    <table>
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>C√≥digo</th>
                                <th>Cantidad</th>
                                <th>Precio Unit.</th>
                                <th>Subtotal</th>
                                <th>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${itemsIA.map((item, idx) => `
                                <tr>
                                    <td>
                                        <input type="text" value="${item.nombre}" 
                                            style="width: 100%; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 13px;"
                                            onchange="itemsIA[${idx}].nombre = this.value">
                                    </td>
                                    <td style="font-family: monospace; font-weight: 700;">${item.codigo}</td>
                                    <td>
                                        <input type="number" value="${item.cantidad}" min="1"
                                            style="width: 80px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: center; font-weight: 700;"
                                            onchange="itemsIA[${idx}].cantidad = parseInt(this.value); cargarModulo('compras')">
                                    </td>
                                    <td>
                                        <input type="number" value="${item.precioUnitario}" min="0"
                                            style="width: 100px; padding: 6px; border: 2px solid #e5e7eb; border-radius: 6px; text-align: right; font-weight: 700;"
                                            onchange="itemsIA[${idx}].precioUnitario = parseFloat(this.value); cargarModulo('compras')">
                                    </td>
                                    <td style="font-weight: 800; font-size: 15px;">$${(item.cantidad * item.precioUnitario).toLocaleString()}</td>
                                    <td>
                                        <button class="btn-primary" style="padding: 6px 12px; font-size: 11px; background: #ef4444;" 
                                            onclick="eliminarItemIA(${idx})">
                                            üóëÔ∏è
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                        <tfoot>
                            <tr style="background: #f9fafb; font-weight: 800;">
                                <td colspan="4" style="text-align: right; padding: 15px;">TOTAL:</td>
                                <td style="font-size: 20px; color: #10b981;">$${total.toLocaleString()}</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>
                
                <!-- Botones -->
                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" style="background: #10b981; font-size: 16px; padding: 12px 30px;" 
                        onclick="confirmarCompraIA()">
                        ‚úÖ CONFIRMAR Y GUARDAR
                    </button>
                    <button class="btn-primary" style="background: #6b7280; font-size: 16px; padding: 12px 30px;" 
                        onclick="cancelarCompraIA()">
                        ‚ùå CANCELAR
                    </button>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: HISTORIAL ==========
        function getPestanaHistorial() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìã Historial de Compras</h3>
                    </div>
                    <div class="card-body">
                        <table>
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Proveedor</th>
                                    <th>Nro. Remito</th>
                                    <th>Items</th>
                                    <th>Total</th>
                                    <th>Actualiz√≥ Costos</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${comprasProveedoresProveedores.map(c => `
                                    <tr>
                                        <td style="font-weight: 600;">${c.fecha}</td>
                                        <td style="font-weight: 700;">${c.proveedor}</td>
                                        <td style="font-family: monospace; font-weight: 600;">${c.nroRemito}</td>
                                        <td style="text-align: center;">
                                            <span style="padding: 4px 12px; background: #dbeafe; color: #1e40af; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${c.items} items
                                            </span>
                                        </td>
                                        <td style="font-weight: 800; font-size: 16px; color: #10b981;">$${c.total.toLocaleString()}</td>
                                        <td style="text-align: center;">
                                            ${c.actualizoCostos ? 
                                                '<span style="font-size: 20px;">‚úÖ</span>' : 
                                                '<span style="font-size: 20px;">‚ùå</span>'
                                            }
                                        </td>
                                        <td>
                                            <span style="padding: 6px 12px; background: #dcfce7; color: #16a34a; font-weight: 700; border-radius: 6px; font-size: 11px;">
                                                ${c.estado}
                                            </span>
                                        </td>
                                        <td>
                                            <button class="btn-primary" style="padding: 6px 12px; font-size: 12px;" 
                                                onclick="verDetalleCompra(${c.id})">
                                                üëÅÔ∏è Ver
                                            </button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // ========== PESTA√ëA: ACTUALIZAR COSTOS ==========
        function getPestanaActualizarCostos() {
            return `
                <div style="margin-bottom: 20px;">
                    <div style="padding: 20px; background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 12px; color: white;">
                        <h3 style="font-size: 20px; font-weight: 800; margin-bottom: 5px;">üí∞ Actualizaci√≥n Masiva de Costos</h3>
                        <p style="opacity: 0.9;">Actualiz√° los precios de compra de m√∫ltiples productos a la vez</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üí∞ Actualizar Precios de Compra</h3>
                    </div>
                    <div class="card-body">
                        <!-- Opciones de actualizaci√≥n -->
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-bottom: 25px;">
                            <div style="padding: 20px; background: #f9fafb; border-radius: 10px; border: 2px solid #e5e7eb;">
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üìà Ajuste por Porcentaje</h4>
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <div style="flex: 1;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Porcentaje</label>
                                        <input type="number" id="porcentajeAjuste" value="10" 
                                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px; font-weight: 700;">
                                    </div>
                                    <button class="btn-primary" style="background: #10b981;" onclick="aplicarAjustePorcentaje()">
                                        ‚úÖ APLICAR
                                    </button>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 10px;">
                                    Ejemplo: 10% aumenta todos los costos un 10%
                                </div>
                            </div>
                            
                            <div style="padding: 20px; background: #f9fafb; border-radius: 10px; border: 2px solid #e5e7eb;">
                                <h4 style="font-weight: 700; margin-bottom: 15px;">üíµ Ajuste por Monto Fijo</h4>
                                <div style="display: flex; gap: 10px; align-items: end;">
                                    <div style="flex: 1;">
                                        <label style="display: block; font-weight: 600; margin-bottom: 5px; font-size: 13px;">Monto $</label>
                                        <input type="number" id="montoAjuste" value="50" 
                                            style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px; font-weight: 700;">
                                    </div>
                                    <button class="btn-primary" style="background: #3b82f6;" onclick="aplicarAjusteMonto()">
                                        ‚úÖ APLICAR
                                    </button>
                                </div>
                                <div style="font-size: 12px; color: #6b7280; margin-top: 10px;">
                                    Ejemplo: $50 suma $50 a cada costo
                                </div>
                            </div>
                        </div>
                        
                        <!-- Vista previa de productos -->
                        <div>
                            <h4 style="font-weight: 700; margin-bottom: 15px;">üì¶ Vista Previa de Costos</h4>
                            <table>
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Costo Actual</th>
                                        <th>Precio Venta</th>
                                        <th>Margen Actual</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${productos.slice(0, 10).map((p, idx) => {
                                        const costo = Math.round(p.precio * 0.6);
                                        const margen = Math.round(((p.precio - costo) / costo) * 100);
                                        return `
                                            <tr>
                                                <td>
                                                    <div style="font-weight: 700;">${p.nombre}</div>
                                                    <div style="font-size: 11px; color: #6b7280;">${p.marca}</div>
                                                </td>
                                                <td style="font-weight: 700; font-size: 15px;">$${costo.toLocaleString()}</td>
                                                <td style="font-weight: 700; font-size: 15px; color: #10b981;">$${p.precio.toLocaleString()}</td>
                                                <td>
                                                    <span style="padding: 6px 12px; background: ${margen > 40 ? '#dcfce7' : '#fef3c7'}; color: ${margen > 40 ? '#16a34a' : '#f59e0b'}; font-weight: 700; border-radius: 6px; font-size: 12px;">
                                                        ${margen}%
                                                    </span>
                                                </td>
                                                <td>
                                                    <button class="btn-primary" style="padding: 6px 12px; font-size: 11px;" 
                                                        onclick="editarCosto(${idx})">
                                                        ‚úèÔ∏è Editar
                                                    </button>
                                                </td>
                                            </tr>
                                        `;
                                    }).join('')}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ========== FUNCIONES ==========
        
        
        function guardarCompraManual() {
            const proveedor = document.getElementById('proveedorCompra')?.value;
            const nroRemito = document.getElementById('nroRemitoCompra')?.value;
            const actualizarCostos = document.getElementById('actualizarCostosCheck')?.checked;
            
            if (!proveedor) {
                alert('‚ö†Ô∏è Seleccion√° un proveedor');
                return;
            }
            
            if (itemsCompraActual.length === 0) {
                alert('‚ö†Ô∏è Agreg√° al menos un producto');
                return;
            }
            
            // Actualizar stock y costos si est√° marcado
            if (actualizarCostos) {
                itemsCompraActual.forEach(item => {
                    const producto = productos.find(p => p.codigo === item.codigo);
                    if (producto) {
                        producto.stock += item.cantidad;
                        producto.precioCosto = item.precioUnitario;
                    }
                });
            } else {
                // Solo actualizar stock
                itemsCompraActual.forEach(item => {
                    const producto = productos.find(p => p.codigo === item.codigo);
                    if (producto) {
                        producto.stock += item.cantidad;
                    }
                });
            }
            
            const total = itemsCompraActual.reduce((sum, item) => sum + item.subtotal, 0);
            
            alert(`‚úÖ COMPRA GUARDADA

Proveedor: ${proveedor}
Remito: ${nroRemito || 'Sin remito'}
Productos: ${itemsCompraActual.length}
Total: $${total.toLocaleString()}

${actualizarCostos ? 'üí∞ Costos actualizados' : 'üì¶ Solo stock actualizado'}`);
            
            // Limpiar items
            itemsCompraActual = [];
            
            // Ir al historial
            cambiarPestanaCompras('historial');
        }
            
        
        function cancelarCompra() {
            if (confirm('¬øCancelar la compra?')) {
                cambiarPestanaCompras('historial');
            }
        }
        
        function procesarArchivoIA(archivo) {
            if (!archivo) return;
            
            // Simular procesamiento IA
            alert(`ü§ñ PROCESANDO CON IA...\n\nArchivo: ${archivo.name}\nTama√±o: ${(archivo.size/1024).toFixed(1)} KB\n\n‚è≥ La IA est√° analizando el documento...`);
            
            // Simular items detectados
            setTimeout(() => {
                itemsIA = [
                    { codigo: 'T-001', nombre: 'Tornillo 1/4" x 2"', cantidad: 100, precioUnitario: 25 },
                    { codigo: 'T-002', nombre: 'Tornillo 3/8" x 3"', cantidad: 50, precioUnitario: 45 },
                    { codigo: 'C-001', nombre: 'Clavo 2 1/2"', cantidad: 200, precioUnitario: 15 },
                    { codigo: 'P-001', nombre: 'Pintura Latex Blanca 20L', cantidad: 10, precioUnitario: 3500 },
                    { codigo: 'A-001', nombre: 'Alambre Galvanizado #12', cantidad: 25, precioUnitario: 180 }
                ];
                
                cargarModulo('compras');
                alert('‚úÖ ¬°PROCESAMIENTO COMPLETO!\n\nLa IA detect√≥ 5 productos.\nRevis√° los datos y confirm√°.');
            }, 1500);
        }
        
        function eliminarItemIA(idx) {
            if (confirm('¬øEliminar este producto?')) {
                itemsIA.splice(idx, 1);
                cargarModulo('compras');
            }
        }
        
        function confirmarCompraIA() {
            const actualizar = document.getElementById('actualizarCostosIA')?.checked;
            const total = itemsIA.reduce((sum, item) => sum + (item.cantidad * item.precioUnitario), 0);
            
            if (confirm(`¬øConfirmar compra?\n\nProductos: ${itemsIA.length}\nTotal: $${total.toLocaleString()}\nActualizar costos: ${actualizar ? 'SI' : 'NO'}`)) {
                // Guardar compra
                comprasProveedores.unshift({
                    id: comprasProveedores.length + 1,
                    fecha: new Date().toISOString().split('T')[0],
                    proveedor: document.getElementById('proveedorIA')?.value || 'Proveedor',
                    nroRemito: document.getElementById('remitoIA')?.value || 'REM-0000',
                    items: itemsIA.length,
                    total: total,
                    actualizoCostos: actualizar,
                    estado: 'Ingresada'
                });
                
                itemsIA = [];
                alert('‚úÖ ¬°COMPRA GUARDADA!\n\nLa mercader√≠a fue ingresada correctamente');
                cambiarPestanaCompras('historial');
            }
        }
        
        function cancelarCompraIA() {
            if (confirm('¬øCancelar? Se perder√°n los datos procesados.')) {
                itemsIA = [];
                cargarModulo('compras');
            }
        }
        
        function verDetalleCompra(id) {
            const compra = comprasProveedores.find(c => c.id === id);
            if (compra) {
                alert(`üìã DETALLE DE COMPRA\n\nProveedor: ${compra.proveedor}\nRemito: ${compra.nroRemito}\nFecha: ${compra.fecha}\nItems: ${compra.items}\nTotal: $${compra.total.toLocaleString()}\n\nüí° Funcionalidad completa en desarrollo`);
            }
        }
        
        function aplicarAjustePorcentaje() {
            const porc = document.getElementById('porcentajeAjuste')?.value;
            if (confirm(`¬øAplicar ${porc}% de ajuste a TODOS los costos?`)) {
                alert(`‚úÖ AJUSTE APLICADO\n\nTodos los costos fueron incrementados un ${porc}%`);
            }
        }
        
        function aplicarAjusteMonto() {
            const monto = document.getElementById('montoAjuste')?.value;
            if (confirm(`¬øSumar $${monto} a TODOS los costos?`)) {
                alert(`‚úÖ AJUSTE APLICADO\n\nSe sum√≥ $${monto} a todos los costos`);
            }
        }
        
        function editarCosto(idx) {
            alert(`‚úèÔ∏è EDITAR COSTO\n\nProducto: ${productos[idx].nombre}\n\nüí° Funcionalidad en desarrollo`);
        }


        function getConfiguracionHTML() {
            return `
                <div class="card">
                    <div class="card-header" style="border-bottom: none; padding-bottom: 0;">
                        <h3 class="card-title">‚öôÔ∏è Configuraci√≥n del Sistema</h3>
                    </div>
                    
                    <!-- Pesta√±as de configuraci√≥n -->
                    <div style="border-bottom: 2px solid #f3f4f6; padding: 0 30px; display: flex; gap: 0;">
                        <div class="tab-config active" onclick="cambiarTabConfig('empresa')" data-tab-config="empresa">
                            üè¢ Empresa
                        </div>
                        <div class="tab-config" onclick="cambiarTabConfig('facturacion')" data-tab-config="facturacion">
                            üìÑ Facturaci√≥n ARCA
                        </div>
                        <div class="tab-config" onclick="cambiarTabConfig('impresion')" data-tab-config="impresion">
                            üñ®Ô∏è Impresi√≥n
                        </div>
                        <div class="tab-config" onclick="cambiarTabConfig('backup')" data-tab-config="backup">
                            üíæ Datos & Backup
                        </div>
                        <div class="tab-config" onclick="cambiarTabConfig('modulos')" data-tab-config="modulos">
                            üì¶ M√≥dulos
                        </div>
                        <div class="tab-config" onclick="cambiarTabConfig('formas-pago')" data-tab-config="formas-pago">
                            üí≥ Formas de Pago
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <!-- EMPRESA -->
                        <div id="config-empresa" class="config-content active">
                            <h4 style="font-size: 20px; font-weight: 700; color: #1a1f2e; margin-bottom: 20px;">
                                üè¢ Datos de la Empresa
                            </h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        RAZ√ìN SOCIAL *
                                    </label>
                                    <input type="text" class="input-field" value="Bruzzone Distribuidora" style="margin: 0;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        CUIT *
                                    </label>
                                    <input type="text" class="input-field" value="20-12345678-9" style="margin: 0;">
                                </div>
                                
                                <div style="grid-column: 1 / -1;">
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        DIRECCI√ìN *
                                    </label>
                                    <input type="text" class="input-field" value="Dr. Carlos Rocha 128, Alejandro Roca, C√≥rdoba" style="margin: 0;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        TEL√âFONO
                                    </label>
                                    <input type="text" class="input-field" value="3584-254818" style="margin: 0;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        EMAIL
                                    </label>
                                    <input type="email" class="input-field" value="bruzzoneferreteria@gmail.com" style="margin: 0;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        CONDICI√ìN IVA
                                    </label>
                                    <select class="input-field" style="margin: 0;">
                                        <option>Responsable Inscripto</option>
                                        <option>Monotributista</option>
                                        <option>Exento</option>
                                    </select>
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        INGRESOS BRUTOS
                                    </label>
                                    <input type="text" class="input-field" value="" placeholder="Nro. IIBB" style="margin: 0;">
                                </div>
                            </div>
                            
                            <div style="margin-top: 30px;">
                                <button class="btn-primary">üíæ Guardar Cambios</button>
                            </div>
                        </div>
                        
                        <!-- FACTURACI√ìN ARCA -->
                        <div id="config-facturacion" class="config-content">
                            <h4 style="font-size: 20px; font-weight: 700; color: #1a1f2e; margin-bottom: 20px;">
                                üìÑ Configuraci√≥n de Facturaci√≥n ARCA (AFIP)
                            </h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        PUNTO DE VENTA
                                    </label>
                                    <input type="number" class="input-field" value="1" style="margin: 0;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        √öLTIMO NRO. FACTURA A
                                    </label>
                                    <input type="number" class="input-field" value="0" style="margin: 0;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        √öLTIMO NRO. FACTURA B
                                    </label>
                                    <input type="number" class="input-field" value="0" style="margin: 0;">
                                </div>
                                
                                <div>
                                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                        √öLTIMO NRO. FACTURA C
                                    </label>
                                    <input type="number" class="input-field" value="0" style="margin: 0;">
                                </div>
                            </div>
                            
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 20px;">
                                <h5 style="font-weight: 700; margin-bottom: 15px;">üîë Credenciales AFIP</h5>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <div>
                                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                            CUIT
                                        </label>
                                        <input type="text" class="input-field" value="20-12345678-9" style="margin: 0;">
                                    </div>
                                    
                                    <div>
                                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                            CERTIFICADO (.CRT)
                                        </label>
                                        <input type="file" class="input-field" style="margin: 0;">
                                    </div>
                                    
                                    <div>
                                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                            CLAVE PRIVADA (.KEY)
                                        </label>
                                        <input type="file" class="input-field" style="margin: 0;">
                                    </div>
                                    
                                    <div>
                                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                            AMBIENTE
                                        </label>
                                        <select class="input-field" style="margin: 0;">
                                            <option>Producci√≥n</option>
                                            <option selected>Homologaci√≥n (Testing)</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div style="margin-top: 15px;">
                                    <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                                        üîó Probar Conexi√≥n con AFIP
                                    </button>
                                </div>
                            </div>
                            
                            <div style="margin-top: 20px;">
                                <button class="btn-primary">üíæ Guardar Configuraci√≥n</button>
                            </div>
                        </div>
                        
                        <!-- IMPRESI√ìN -->
                        <div id="config-impresion" class="config-content">
                            <h4 style="font-size: 20px; font-weight: 700; color: #1a1f2e; margin-bottom: 5px;">
                                üñ®Ô∏è Configuraci√≥n de Comprobantes
                            </h4>
                            <p style="color: #6b7280; margin-bottom: 20px;">
                                Configur√° c√≥mo se imprime cada tipo de comprobante (formato, informaci√≥n, impresora, etc.)
                            </p>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px;">
                                ${tiposComprobantes.map(tc => `
                                    <div style="background: #f8f9fa; border: 2px solid ${tc.activo ? '#e5e7eb' : '#f3f4f6'}; border-radius: 12px; padding: 20px; ${!tc.activo ? 'opacity: 0.6;' : ''}">
                                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
                                            <div>
                                                <h5 style="font-weight: 700; font-size: 16px; margin-bottom: 5px;">${tc.nombre}</h5>
                                                <div style="font-size: 12px; color: #6b7280;">
                                                    ${tc.tamanioPapel} ‚Ä¢ ${tc.impresora}
                                                </div>
                                            </div>
                                            <label class="switch" style="flex-shrink: 0;">
                                                <input type="checkbox" ${tc.activo ? 'checked' : ''} onchange="toggleComprobante(${tc.id})">
                                                <span class="slider"></span>
                                            </label>
                                        </div>
                                        
                                        <div style="display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 15px;">
                                            ${tc.incluirLogo ? '<span class="badge" style="background: #dbeafe; color: #1e40af; font-size: 11px;">üì∑ Logo</span>' : ''}
                                            ${tc.incluirQR ? '<span class="badge" style="background: #dcfce7; color: #166534; font-size: 11px;">üì± QR</span>' : ''}
                                            ${tc.incluirCAE ? '<span class="badge" style="background: #fef3c7; color: #92400e; font-size: 11px;">üîê CAE</span>' : ''}
                                            ${tc.incluirDetalleItems ? '<span class="badge" style="background: #f3e8ff; color: #6b21a8; font-size: 11px;">üìã Items</span>' : ''}
                                            ${tc.abrirCajon ? '<span class="badge" style="background: #fee2e2; color: #991b1b; font-size: 11px;">üí∞ Caj√≥n</span>' : ''}
                                        </div>
                                        
                                        <div style="font-size: 13px; color: #6b7280; margin-bottom: 12px;">
                                            Copias: <strong>${tc.copias}</strong>
                                        </div>
                                        
                                        <button class="btn-primary" style="width: 100%; padding: 10px; font-size: 13px;" onclick="editarComprobante(${tc.id})">
                                            ‚öôÔ∏è Configurar
                                        </button>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="background: #fff7f5; border: 2px solid #ff6b35; border-radius: 12px; padding: 20px; margin-top: 30px;">
                                <div style="font-weight: 700; margin-bottom: 10px;">üí° Configuraci√≥n por comprobante</div>
                                <div style="font-size: 14px; color: #6b7280; line-height: 1.6;">
                                    ‚Ä¢ Cada tipo de comprobante tiene su propia configuraci√≥n<br>
                                    ‚Ä¢ Pod√©s elegir qu√© informaci√≥n incluir en cada uno<br>
                                    ‚Ä¢ Los comprobantes desactivados no se podr√°n generar<br>
                                    ‚Ä¢ Click en "Configurar" para personalizar cada comprobante
                                </div>
                            </div>
                        </div>
                        
                        <!-- DATOS & BACKUP -->
                        <div id="config-backup" class="config-content">
                            <h4 style="font-size: 20px; font-weight: 700; color: #1a1f2e; margin-bottom: 20px;">
                                üíæ Respaldo y Restauraci√≥n de Datos
                            </h4>
                            
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px;">
                                    <div style="font-size: 40px; text-align: center; margin-bottom: 15px;">üì§</div>
                                    <h5 style="font-weight: 700; margin-bottom: 10px; text-align: center;">Exportar Datos</h5>
                                    <p style="color: #6b7280; text-align: center; margin-bottom: 20px; font-size: 14px;">
                                        Descarg√° una copia de seguridad de toda tu informaci√≥n
                                    </p>
                                    <button class="btn-primary" style="width: 100%;">
                                        üì• Descargar Backup
                                    </button>
                                </div>
                                
                                <div style="background: #f8f9fa; padding: 25px; border-radius: 12px;">
                                    <div style="font-size: 40px; text-align: center; margin-bottom: 15px;">üì•</div>
                                    <h5 style="font-weight: 700; margin-bottom: 10px; text-align: center;">Importar Datos</h5>
                                    <p style="color: #6b7280; text-align: center; margin-bottom: 20px; font-size: 14px;">
                                        Restaur√° una copia de seguridad previamente guardada
                                    </p>
                                    <button class="btn-primary" style="width: 100%; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                                        üì§ Subir Backup
                                    </button>
                                </div>
                            </div>
                            
                            <div style="background: #fff7f5; border: 2px solid #ff6b35; border-radius: 12px; padding: 20px; margin-top: 20px;">
                                <div style="font-weight: 700; margin-bottom: 10px;">‚ö†Ô∏è Importante</div>
                                <div style="font-size: 14px; color: #6b7280; line-height: 1.6;">
                                    ‚Ä¢ Los backups incluyen: clientes, productos, ventas, remitos y configuraci√≥n<br>
                                    ‚Ä¢ Se recomienda hacer un backup semanal<br>
                                    ‚Ä¢ Al importar datos, se sobrescribir√° toda la informaci√≥n actual<br>
                                    ‚Ä¢ Guard√° tus backups en un lugar seguro (Google Drive, disco externo, etc.)
                                </div>
                            </div>
                            
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 20px;">
                                <h5 style="font-weight: 700; margin-bottom: 15px;">üìä √öltimo Backup</h5>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                    <div>
                                        <div style="font-size: 11px; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px;">Fecha</div>
                                        <div style="font-weight: 600;">29/01/2026</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px;">Hora</div>
                                        <div style="font-weight: 600;">14:30 hs</div>
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #94a3b8; text-transform: uppercase; margin-bottom: 5px;">Tama√±o</div>
                                        <div style="font-weight: 600;">2.5 MB</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- M√ìDULOS -->
                        <div id="config-modulos" class="config-content">
                            <h4 style="font-size: 20px; font-weight: 700; color: #1a1f2e; margin-bottom: 20px;">
                                üì¶ Activar/Desactivar M√≥dulos
                            </h4>
                            
                            <p style="color: #6b7280; margin-bottom: 25px;">
                                Seleccion√° qu√© m√≥dulos quer√©s utilizar en tu sistema. Los m√≥dulos desactivados no aparecer√°n en el men√∫.
                            </p>
                            
                            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                                ${[
                                    { nombre: 'Ventas', icon: 'üí∞', activo: true },
                                    { nombre: 'Remitos', icon: 'üìã', activo: true },
                                    { nombre: 'Cotizaciones', icon: 'üí¨', activo: false },
                                    { nombre: 'Pedidos', icon: 'üìù', activo: false },
                                    { nombre: 'Clientes', icon: 'üë•', activo: true },
                                    { nombre: 'Inventario', icon: 'üì¶', activo: true },
                                    { nombre: 'Proveedores', icon: 'üöö', activo: false },
                                    { nombre: 'Cajas y Pagos', icon: 'üíµ', activo: false },
                                    { nombre: 'E-Commerce', icon: 'üåê', activo: false },
                                    { nombre: 'Fidelizaci√≥n', icon: 'üéÅ', activo: false }
                                ].map(m => `
                                    <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
                                        <div style="display: flex; align-items: center; gap: 12px;">
                                            <div style="font-size: 24px;">${m.icon}</div>
                                            <div style="font-weight: 600;">${m.nombre}</div>
                                        </div>
                                        <label class="switch">
                                            <input type="checkbox" ${m.activo ? 'checked' : ''}>
                                            <span class="slider"></span>
                                        </label>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div style="margin-top: 25px;">
                                <button class="btn-primary">üíæ Guardar Cambios</button>
                            </div>
                        </div>
                        
                        <!-- FORMAS DE PAGO -->
                        <div id="config-formas-pago" class="config-content">
                            <h4 style="font-size: 20px; font-weight: 700; color: #1a1f2e; margin-bottom: 5px;">
                                üí≥ Formas de Pago
                            </h4>
                            <p style="color: #6b7280; margin-bottom: 20px;">
                                Configur√° las formas de pago, recargos y planes de cuotas de tu negocio
                            </p>
                            
                            <button class="btn-primary" onclick="abrirModalFormaPago()" style="margin-bottom: 20px;">
                                + Nueva Forma de Pago
                            </button>
                            
                            <div class="table-container" style="border: 2px solid #f3f4f6; border-radius: 12px; overflow: hidden;">
                                <table>
                                    <thead style="background: #f8f9fa;">
                                        <tr>
                                            <th>Forma de Pago</th>
                                            <th>Recargo</th>
                                            <th>Cuotas</th>
                                            <th>Estado</th>
                                            <th style="text-align: center;">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tablaFormasPago">
                                        ${renderFormasPago()}
                                    </tbody>
                                </table>
                            </div>
                            
                            <div style="background: #fff7f5; border: 2px solid #ff6b35; border-radius: 12px; padding: 20px; margin-top: 20px;">
                                <div style="font-weight: 700; font-size: 16px; margin-bottom: 10px; color: #1a1f2e;">
                                    üí° ¬øC√≥mo funciona?
                                </div>
                                <div style="font-size: 14px; color: #6b7280; line-height: 1.6;">
                                    ‚Ä¢ <strong>Recargo:</strong> Se suma al total de la venta autom√°ticamente<br>
                                    ‚Ä¢ <strong>Cuotas:</strong> El cliente puede elegir pagar en cuotas con el inter√©s configurado<br>
                                    ‚Ä¢ <strong>Estado:</strong> Solo las formas de pago activas aparecen en ventas<br>
                                    ‚Ä¢ <strong>Ejemplo:</strong> Venta de $10,000 con tarjeta cr√©dito (5% recargo) = $10,500
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderFormasPago() {
            const activas = formasPago.filter(f => f.activa);
            const inactivas = formasPago.filter(f => !f.activa);
            const ordenadas = [...activas, ...inactivas];
            
            if (ordenadas.length === 0) {
                return `
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 40px; color: #999;">
                            No hay formas de pago configuradas
                        </td>
                    </tr>
                `;
            }
            
            return ordenadas.map(fp => `
                <tr style="${!fp.activa ? 'opacity: 0.5;' : ''}">
                    <td>
                        <strong style="font-size: 15px;">${fp.nombre}</strong>
                    </td>
                    <td>
                        ${fp.recargo > 0 ? 
                            `<span class="badge" style="background: #fee2e2; color: #991b1b;">
                                ${fp.tipoRecargo === 'porcentaje' ? `+${fp.recargo}%` : `+$${fp.recargo}`}
                            </span>` :
                            '<span style="color: #6b7280;">Sin recargo</span>'
                        }
                    </td>
                    <td>
                        ${fp.permiteCuotas && fp.cuotas.length > 0 ?
                            `<div style="font-size: 13px;">
                                ${fp.cuotas.map(c => `<div style="color: #6b7280; margin-bottom: 3px;">‚Ä¢ ${c.descripcion}</div>`).join('')}
                            </div>` :
                            '<span style="color: #6b7280;">No permite cuotas</span>'
                        }
                    </td>
                    <td>
                        ${fp.activa ?
                            '<span class="badge" style="background: #dcfce7; color: #059669;">‚úÖ ACTIVA</span>' :
                            '<span class="badge" style="background: #f3f4f6; color: #6b7280;">‚ùå INACTIVA</span>'
                        }
                    </td>
                    <td>
                        <div style="display: flex; gap: 5px; justify-content: center;">
                            <button class="btn-action ${fp.activa ? 'btn-warning' : 'btn-success'}" 
                                onclick="toggleFormaPago(${fp.id})" 
                                title="${fp.activa ? 'Desactivar' : 'Activar'}">
                                ${fp.activa ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}
                            </button>
                            <button class="btn-action btn-info" onclick="editarFormaPago(${fp.id})" title="Editar">‚úèÔ∏è</button>
                            <button class="btn-action btn-danger" onclick="eliminarFormaPago(${fp.id})" title="Eliminar">üóëÔ∏è</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        // M√ìDULO IMPORTAR DATOS
        let pasoImportacion = 1;
        let tipoImportacionSeleccionado = '';
        let archivoImportacion = null;
        

        function getImportarDatosHTML() {
            return `
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üì• Importaci√≥n Masiva de Datos</h3>
                    </div>
                    <div class="card-body">
                        <p style="color: #6b7280; margin-bottom: 30px;">
                            Migr√° tu informaci√≥n desde archivos Excel (.xlsx) de forma r√°pida.
                        </p>
                        
                        <!-- Progress Steps -->
                        <div style="display: flex; justify-content: space-between; margin-bottom: 40px; position: relative;">
                            <div style="position: absolute; top: 20px; left: 0; right: 0; height: 2px; background: #e5e7eb; z-index: 0;"></div>
                            
                            <div class="import-step active" id="step-1">
                                <div class="step-number">1</div>
                                <div class="step-label">TIPO</div>
                            </div>
                            <div class="import-step" id="step-2">
                                <div class="step-number">2</div>
                                <div class="step-label">ARCHIVO</div>
                            </div>
                            <div class="import-step" id="step-3">
                                <div class="step-number">3</div>
                                <div class="step-label">MAPEO</div>
                            </div>
                            <div class="import-step" id="step-4">
                                <div class="step-number">4</div>
                                <div class="step-label">RESULTADO</div>
                            </div>
                        </div>
                        
                        <!-- Paso 1: Selecci√≥n de Tipo -->
                        <div id="import-paso-1" class="import-content active">
                            <h4 style="font-size: 20px; font-weight: 700; margin-bottom: 25px; text-align: center;">
                                ¬øQu√© tipo de datos quer√©s importar?
                            </h4>
                            
                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; max-width: 1000px; margin: 0 auto;">
                                <div class="import-type-card" onclick="seleccionarTipoImportacion('productos')">
                                    <div class="icon-circle" style="background: #dbeafe;">
                                        <span style="font-size: 32px;">üì¶</span>
                                    </div>
                                    <div class="type-title">ART√çCULOS</div>
                                    <div class="type-description">Precios, stock y c√≥digos</div>
                                </div>
                                
                                <div class="import-type-card" onclick="seleccionarTipoImportacion('clientes')">
                                    <div class="icon-circle" style="background: #dcfce7;">
                                        <span style="font-size: 32px;">üë•</span>
                                    </div>
                                    <div class="type-title">CLIENTES</div>
                                    <div class="type-description">CUIT, contactos y saldos</div>
                                </div>
                                
                                <div class="import-type-card" onclick="seleccionarTipoImportacion('proveedores')">
                                    <div class="icon-circle" style="background: #fed7aa;">
                                        <span style="font-size: 32px;">üöö</span>
                                    </div>
                                    <div class="type-title">PROVEEDORES</div>
                                    <div class="type-description">Datos fiscales y descuentos</div>
                                </div>
                                
                                <div class="import-type-card" onclick="seleccionarTipoImportacion('marcas')">
                                    <div class="icon-circle" style="background: #e9d5ff;">
                                        <span style="font-size: 32px;">üè∑Ô∏è</span>
                                    </div>
                                    <div class="type-title">MARCAS</div>
                                    <div class="type-description">Listado maestro de marcas</div>
                                </div>
                                
                                <div class="import-type-card" onclick="seleccionarTipoImportacion('rubros')">
                                    <div class="icon-circle" style="background: #fecaca;">
                                        <span style="font-size: 32px;">üìö</span>
                                    </div>
                                    <div class="type-title">RUBROS</div>
                                    <div class="type-description">Categorizaci√≥n del cat√°logo</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Paso 2: Cargar Archivo -->
                        <div id="import-paso-2" class="import-content">
                            <h4 style="font-size: 20px; font-weight: 700; margin-bottom: 10px; text-align: center;" id="titulo-paso-2">
                                Carg√° tu archivo Excel
                            </h4>
                            <p style="text-align: center; color: #6b7280; margin-bottom: 30px;">
                                El archivo debe estar en formato .xlsx
                            </p>
                            
                            <div style="max-width: 600px; margin: 0 auto;">
                                <div style="border: 3px dashed #e5e7eb; border-radius: 12px; padding: 60px 40px; text-align: center; background: #f9fafb;">
                                    <div style="font-size: 64px; margin-bottom: 20px;">üìÑ</div>
                                    <div style="margin-bottom: 20px;">
                                        <button class="btn-primary" onclick="document.getElementById('fileImport').click()" style="font-size: 16px; padding: 15px 30px;">
                                            üìÅ Seleccionar Archivo
                                        </button>
                                        <input type="file" id="fileImport" accept=".xlsx,.xls" style="display: none;" onchange="cargarArchivoImportacion(event)">
                                    </div>
                                    <div id="archivo-info" style="color: #6b7280; font-size: 14px;">
                                        o arrastr√° el archivo aqu√≠
                                    </div>
                                </div>
                                
                                <div style="margin-top: 30px;">
                                    <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); width: 100%;" 
                                        onclick="descargarPlantilla()">
                                        üì• Descargar Plantilla Excel
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Paso 3: Mapeo -->
                        <div id="import-paso-3" class="import-content">
                            <h4 style="font-size: 20px; font-weight: 700; margin-bottom: 10px; text-align: center;">
                                Verific√° el mapeo de columnas
                            </h4>
                            <p style="text-align: center; color: #6b7280; margin-bottom: 30px;">
                                Asegurate que las columnas del Excel coincidan con los campos del sistema
                            </p>
                            
                            <div id="mapeo-container" style="max-width: 800px; margin: 0 auto;">
                                <!-- Aqu√≠ se generar√° din√°micamente el mapeo -->
                            </div>
                        </div>
                        
                        <!-- Paso 4: Resultado -->
                        <div id="import-paso-4" class="import-content">
                            <div style="text-align: center; max-width: 600px; margin: 0 auto;">
                                <div style="font-size: 80px; margin-bottom: 20px;">‚úÖ</div>
                                <h4 style="font-size: 24px; font-weight: 700; margin-bottom: 15px; color: #059669;">
                                    ¬°Importaci√≥n Completada!
                                </h4>
                                <div id="resultado-info" style="font-size: 18px; color: #6b7280; margin-bottom: 30px;">
                                    <!-- Info de resultado -->
                                </div>
                                
                                <button class="btn-primary" onclick="reiniciarImportacion()" style="font-size: 16px; padding: 15px 40px;">
                                    üîÑ Nueva Importaci√≥n
                                </button>
                            </div>
                        </div>
                        
                        <!-- Botones de navegaci√≥n -->
                        <div style="display: flex; justify-content: space-between; margin-top: 40px; padding-top: 30px; border-top: 2px solid #f3f4f6;">
                            <button class="btn-primary" id="btn-anterior" style="background: #6b7280; display: none;" onclick="pasoAnterior()">
                                ‚Üê Anterior
                            </button>
                            <div style="flex: 1;"></div>
                            <button class="btn-primary" id="btn-siguiente" style="display: none;" onclick="pasoSiguiente()">
                                Siguiente ‚Üí
                            </button>
                            <button class="btn-primary" id="btn-importar" style="display: none;" onclick="ejecutarImportacion()">
                                üöÄ Importar Datos
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }



        function getCajasPagosHTML() {
            const totalConsolidado = cajas.reduce((sum, c) => sum + c.saldo, 0);
            const efectivoMano = cajas.filter(c => c.tipo === 'efectivo').reduce((sum, c) => sum + c.saldo, 0);
            const saldosBancos = cajas.filter(c => c.tipo === 'banco').reduce((sum, c) => sum + c.saldo, 0);
            const cuentasDigitales = cajas.filter(c => c.tipo === 'digital').reduce((sum, c) => sum + c.saldo, 0);
            
            return `
                <div style="margin-bottom: 25px;">
                    <h2 style="font-size: 28px; font-weight: 800; margin-bottom: 5px;">üí∞ Cajas y Pagos</h2>
                    <p style="color: #6b7280;">Gestion√° tus fondos y control√° todas tus cajas.</p>
                </div>
                
                <!-- Botones Principales -->
                <div style="display: flex; gap: 15px; margin-bottom: 30px; flex-wrap: wrap;">
                    <button class="btn-primary" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); font-size: 15px; padding: 12px 25px;" onclick="abrirModalMovimiento('egreso')">
                        ‚äñ REGISTRAR GASTO / PAGO
                    </button>
                    <button class="btn-primary" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); font-size: 15px; padding: 12px 25px;" onclick="abrirModalMovimiento('ingreso')">
                        ‚äï INGRESO MANUAL
                    </button>
                    <button class="btn-primary" style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); font-size: 15px; padding: 12px 25px;" onclick="abrirModalGestionCajas()">
                        üíº FONDOS
                    </button>
                    <button class="btn-primary" style="background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%); font-size: 15px; padding: 12px 25px;" onclick="verHistorial()">
                        üìã HISTORIAL
                    </button>
                </div>
                
                <!-- Dashboard de Totales -->
                <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px;">
                    <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border-radius: 16px; padding: 25px; color: white;">
                        <div style="font-size: 12px; font-weight: 600; margin-bottom: 8px;">TOTAL CONSOLIDADO</div>
                        <div style="font-size: 36px; font-weight: 800;">$${totalConsolidado.toLocaleString()}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #10b981;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 3px;">EFECTIVO</div>
                        <div style="font-size: 24px; font-weight: 800;">$${efectivoMano.toLocaleString()}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #3b82f6;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 3px;">BANCOS</div>
                        <div style="font-size: 24px; font-weight: 800;">$${saldosBancos.toLocaleString()}</div>
                    </div>
                    <div class="card" style="border-left: 4px solid #f59e0b;">
                        <div style="font-size: 11px; color: #6b7280; font-weight: 600; margin-bottom: 3px;">DIGITALES</div>
                        <div style="font-size: 24px; font-weight: 800;">$${cuentasDigitales.toLocaleString()}</div>
                    </div>
                </div>
                
                <!-- Listado de Cajas + Nueva Caja -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 style="font-size: 20px; font-weight: 700;">üíº Mis Cajas</h3>
                    <button class="btn-primary" style="font-size: 13px; padding: 8px 16px;" onclick="abrirModalNuevaCaja()">
                        + Nueva Caja
                    </button>
                </div>
                
                <div style="display: grid; gap: 15px;">
                    ${cajas.filter(c => c.activa).map(caja => `
                        <div class="card" style="border: 2px solid ${cajaActiva === caja.id ? '#ff6b35' : '#e5e7eb'}; cursor: pointer;" onclick="seleccionarCaja(${caja.id})">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <div style="display: flex; align-items: center; gap: 15px; flex: 1;">
                                    <div style="font-size: 32px;">${caja.icono}</div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 18px; font-weight: 700;">${caja.nombre}</div>
                                        <div style="font-size: 28px; font-weight: 800; color: ${caja.saldo >= 0 ? '#059669' : '#dc2626'};">
                                            $${caja.saldo.toLocaleString()}
                                        </div>
                                        <div style="font-size: 12px; color: #6b7280; margin-top: 5px;">
                                            üë§ ${caja.responsable} ‚Ä¢ ${caja.sucursal}
                                        </div>
                                    </div>
                                </div>
                                <div style="display: flex; gap: 8px;">
                                    ${cajaActiva === caja.id ? '<span class="badge" style="background: #ff6b35; color: white;">‚úì ACTIVA</span>' : ''}
                                    <button class="btn-primary" style="padding: 8px 16px;" onclick="event.stopPropagation(); arquearCaja(${caja.id})">üìä ARQUEO</button>
                                    <button class="btn-primary" style="padding: 8px 16px;" onclick="event.stopPropagation(); transferirEntreCajas(${caja.id})">üîÑ MOVER</button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }




        function filtrarComprobantes(tipo) {
            alert(`üìÑ FILTRAR: ${tipo.toUpperCase()}\n\nMostrando comprobantes del tipo seleccionado\n\nüí° Funcionalidad en desarrollo`);
        }
        
        function verComprobante(id) {
            alert(`üëÅÔ∏è VER COMPROBANTE ${id}\n\nDetalle completo del comprobante\n\nüí° Funcionalidad en desarrollo`);
        }



        



        
        
        // ==================== FUNCIONES CAJAS Y PAGOS ====================
        
        function abrirModalNuevaCaja() {
            const nombre = prompt('üíº Nombre de la caja:', '');
            if (!nombre) return;
            
            const tipo = prompt('Tipo de caja:\n1 = Efectivo\n2 = Banco\n3 = Digital', '1');
            const tipos = { '1': 'efectivo', '2': 'banco', '3': 'digital' };
            const iconos = { '1': 'üíµ', '2': 'üè¶', '3': 'üí≥' };
            
            if (!tipos[tipo]) {
                alert('‚ùå Tipo inv√°lido');
                return;
            }
            
            const nuevaCaja = {
                id: cajas.length + 1,
                nombre: nombre,
                tipo: tipos[tipo],
                saldo: 0,
                responsable: 'Sistema',
                sucursal: 'Casa Central',
                activa: true,
                icono: iconos[tipo]
            };
            
            cajas.push(nuevaCaja);
            alert(`‚úÖ Caja "${nombre}" creada correctamente`);
            cargarModulo('cajas-pagos');
        }
        
        function arquearCaja(cajaId) {
            const caja = cajas.find(c => c.id === cajaId);
            if (!caja) return;
            
            const saldoSistema = caja.saldo;
            const saldoReal = prompt(`üìä ARQUEO DE CAJA: ${caja.nombre}\n\nSaldo seg√∫n sistema: $${saldoSistema.toLocaleString()}\n\n¬øCu√°l es el saldo REAL contado?`, saldoSistema);
            
            if (saldoReal === null) return;
            
            const real = parseFloat(saldoReal);
            const diferencia = real - saldoSistema;
            
            if (diferencia === 0) {
                alert(`‚úÖ ARQUEO CORRECTO\n\nCaja: ${caja.nombre}\nSaldo Sistema: $${saldoSistema.toLocaleString()}\nSaldo Real: $${real.toLocaleString()}\nDiferencia: $0\n\n¬°Todo coincide!`);
            } else if (diferencia > 0) {
                alert(`‚ö†Ô∏è SOBRANTE DETECTADO\n\nCaja: ${caja.nombre}\nSaldo Sistema: $${saldoSistema.toLocaleString()}\nSaldo Real: $${real.toLocaleString()}\nSOBRANTE: $${diferencia.toLocaleString()}\n\n¬°Hay m√°s dinero del que deber√≠a!`);
            } else {
                alert(`‚ùå FALTANTE DETECTADO\n\nCaja: ${caja.nombre}\nSaldo Sistema: $${saldoSistema.toLocaleString()}\nSaldo Real: $${real.toLocaleString()}\nFALTANTE: $${Math.abs(diferencia).toLocaleString()}\n\n¬°Falta dinero!`);
            }
        }
        
        function transferirEntreCajas(cajaOrigenId) {
            const cajaOrigen = cajas.find(c => c.id === cajaOrigenId);
            if (!cajaOrigen) return;
            
            // Mostrar saldo disponible
            alert(`üí∞ TRANSFERIR DESDE: ${cajaOrigen.nombre}\nSaldo disponible: $${cajaOrigen.saldo.toLocaleString()}`);
            
            // Seleccionar caja destino
            const opcionesDestino = cajas
                .filter(c => c.id !== cajaOrigenId && c.activa)
                .map(c => `${c.id}. ${c.icono} ${c.nombre} (Saldo: $${c.saldo.toLocaleString()})`)
                .join('\n');
            
            if (!opcionesDestino) {
                alert('‚ùå No hay otras cajas disponibles para transferir');
                return;
            }
            
            const destinoId = prompt(`Seleccion√° la caja DESTINO:\n\n${opcionesDestino}\n\nIngres√° el n√∫mero:`, '');
            if (!destinoId) return;
            
            const cajaDestino = cajas.find(c => c.id === parseInt(destinoId));
            if (!cajaDestino) {
                alert('‚ùå Caja destino no v√°lida');
                return;
            }
            
            // Ingresar monto
            const monto = prompt(`üí∏ ¬øCu√°nto quer√©s transferir?\n\nDesde: ${cajaOrigen.nombre} ($${cajaOrigen.saldo.toLocaleString()})\nHacia: ${cajaDestino.nombre}\n\nMonto a transferir:`, '');
            if (!monto) return;
            
            const montoNum = parseFloat(monto);
            if (isNaN(montoNum) || montoNum <= 0) {
                alert('‚ùå Monto inv√°lido');
                return;
            }
            
            if (montoNum > cajaOrigen.saldo) {
                alert(`‚ùå SALDO INSUFICIENTE\n\nMonto solicitado: $${montoNum.toLocaleString()}\nSaldo disponible: $${cajaOrigen.saldo.toLocaleString()}\nFaltante: $${(montoNum - cajaOrigen.saldo).toLocaleString()}`);
                return;
            }
            
            // Realizar transferencia
            cajaOrigen.saldo -= montoNum;
            cajaDestino.saldo += montoNum;
            
            alert(`‚úÖ TRANSFERENCIA EXITOSA\n\nüí∏ Monto: $${montoNum.toLocaleString()}\n\nOrigen: ${cajaOrigen.nombre}\nNuevo saldo: $${cajaOrigen.saldo.toLocaleString()}\n\nDestino: ${cajaDestino.nombre}\nNuevo saldo: $${cajaDestino.saldo.toLocaleString()}`);
            
            cargarModulo('cajas-pagos');
        }
        
        function abrirModalMovimiento(tipo) {
            const caja = cajas.find(c => c.id === cajaActiva);
            if (!caja) {
                alert('‚ùå Seleccion√° una caja primero');
                return;
            }
            
            if (tipo === 'egreso') {
                // Seleccionar categor√≠a
                const opcionesCategorias = categoriasGastos
                    .map(c => `${c.id}. ${c.icono} ${c.nombre} (${c.tipo === 'fijo' ? 'Fijo' : 'Variable'})`)
                    .join('\n');
                
                const catId = prompt(`üìã REGISTRAR GASTO/PAGO\nCaja: ${caja.nombre}\n\nSeleccion√° la categor√≠a:\n\n${opcionesCategorias}\n\nIngres√° el n√∫mero:`, '');
                if (!catId) return;
                
                const categoria = categoriasGastos.find(c => c.id === parseInt(catId));
                if (!categoria) {
                    alert('‚ùå Categor√≠a no v√°lida');
                    return;
                }
                
                // Ingresar monto
                const monto = prompt(`üí∞ Monto del gasto:\n\nCategor√≠a: ${categoria.icono} ${categoria.nombre}\nCaja: ${caja.nombre} (Disponible: $${caja.saldo.toLocaleString()})\n\nMonto:`, '');
                if (!monto) return;
                
                const montoNum = parseFloat(monto);
                if (isNaN(montoNum) || montoNum <= 0) {
                    alert('‚ùå Monto inv√°lido');
                    return;
                }
                
                // Ingresar concepto
                const concepto = prompt(`üìù Concepto del gasto:\n\nCategor√≠a: ${categoria.nombre}\nMonto: $${montoNum.toLocaleString()}`, '');
                if (!concepto) return;
                
                // Registrar gasto
                caja.saldo -= montoNum;
                
                alert(`‚úÖ GASTO REGISTRADO\n\n${categoria.icono} ${categoria.nombre}\nüí∞ Monto: $${montoNum.toLocaleString()}\nüìù ${concepto}\n\nüíº Caja: ${caja.nombre}\nNuevo saldo: $${caja.saldo.toLocaleString()}`);
                
            } else {
                // Ingreso manual
                const monto = prompt(`üí∞ INGRESO MANUAL\nCaja: ${caja.nombre}\n\n¬øCu√°nto ingres√≥?`, '');
                if (!monto) return;
                
                const montoNum = parseFloat(monto);
                if (isNaN(montoNum) || montoNum <= 0) {
                    alert('‚ùå Monto inv√°lido');
                    return;
                }
                
                const concepto = prompt(`üìù Concepto del ingreso:\n\nMonto: $${montoNum.toLocaleString()}`, '');
                if (!concepto) return;
                
                caja.saldo += montoNum;
                
                alert(`‚úÖ INGRESO REGISTRADO\n\nüí∞ Monto: $${montoNum.toLocaleString()}\nüìù ${concepto}\n\nüíº Caja: ${caja.nombre}\nNuevo saldo: $${caja.saldo.toLocaleString()}`);
            }
            
            cargarModulo('cajas-pagos');
        }
        
        function abrirModalGestionCajas() {
            const info = cajas.map(c => 
                `${c.icono} ${c.nombre}\n   Tipo: ${c.tipo}\n   Saldo: $${c.saldo.toLocaleString()}\n   Estado: ${c.activa ? 'Activa' : 'Inactiva'}`
            ).join('\n\n');
            
            alert(`üíº GESTI√ìN DE FONDOS\n\n${info}\n\nüí∞ TOTAL CONSOLIDADO: $${cajas.reduce((sum, c) => sum + c.saldo, 0).toLocaleString()}`);
        }
        
        function verHistorial() {
            alert('üìã HISTORIAL DE MOVIMIENTOS\n\nPr√≥ximamente: Historial completo con filtros por:\n‚Ä¢ Fecha\n‚Ä¢ Caja\n‚Ä¢ Tipo (Ingreso/Egreso)\n‚Ä¢ Categor√≠a\n‚Ä¢ Monto\n\nCon opciones de exportar a Excel y PDF');
        }
        
        function pedirProducto(codigo) {
            const prod = productos.find(p => p.codigo === codigo);
            if (!prod) return;
            
            const cantidad = prompt(`üì¶ ¬øCu√°ntas unidades de "${prod.nombre}" quer√©s pedir?`, '10');
            if (cantidad && parseInt(cantidad) > 0) {
                alert(`‚úÖ Pedido agregado:\n${cantidad} x ${prod.nombre}\nMarca: ${prod.marca}\n\nSe agreg√≥ a Pedidos de Compra`);
                limpiarBusqueda();
            }
        }
        
        function editarProducto(codigo) {
            const prod = productos.find(p => p.codigo === codigo);
            if (!prod) return;
            
            document.getElementById('editCodigo').value = prod.codigo;
            document.getElementById('editNombre').value = prod.nombre;
            document.getElementById('editMarca').value = prod.marca;
            document.getElementById('editStock').value = prod.stock;
            document.getElementById('editPrecio').value = prod.precio;
            
            document.getElementById('modalEditarProducto').classList.add('show');
        }
        
        function guardarEdicionProducto() {
            const codigo = document.getElementById('editCodigo').value;
            const prod = productos.find(p => p.codigo === codigo);
            
            if (prod) {
                prod.nombre = document.getElementById('editNombre').value;
                prod.marca = document.getElementById('editMarca').value;
                prod.stock = parseInt(document.getElementById('editStock').value) || 0;
                prod.precio = parseFloat(document.getElementById('editPrecio').value) || 0;
                
                alert('‚úÖ Producto actualizado exitosamente!');
                cerrarModalEditar();
                limpiarBusqueda();
            }
        }
        
        function cerrarModalEditar() {
            document.getElementById('modalEditarProducto').classList.remove('show');
        }
        
        function borrarProducto(codigo) {
            const prod = productos.find(p => p.codigo === codigo);
            if (!prod) return;
            
            if (confirm(`‚ö†Ô∏è ¬øSeguro que quer√©s ELIMINAR este producto?\n\n${prod.nombre}\nC√≥digo: ${prod.codigo}\n\nEsta acci√≥n no se puede deshacer.`)) {
                const index = productos.findIndex(p => p.codigo === codigo);
                if (index > -1) {
                    productos.splice(index, 1);
                    alert('‚úÖ Producto eliminado exitosamente!');
                    limpiarBusqueda();
                }
            }
        }

        // Cargar dashboard al inicio
        cargarModulo('dashboard');
    </script>

    <!-- Modal Detalle Remito -->
    <div id="modalDetalleRemito" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
                <div>
                    <h3 style="font-size: 28px; font-weight: 700; color: #1a1f2e; margin-bottom: 10px;">
                        üìã REMITO <span id="detalleRemitoId" style="color: #ff6b35;"></span>
                    </h3>
                    <div style="display: flex; gap: 20px; font-size: 14px; color: #6b7280;">
                        <div>
                            <strong>Fecha:</strong> <span id="detalleRemitoFecha"></span>
                        </div>
                    </div>
                </div>
                <div id="detalleRemitoEstado"></div>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <div style="font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">
                    Cliente
                </div>
                <div style="font-size: 20px; font-weight: 700; color: #1a1f2e;" id="detalleRemitoCliente"></div>
            </div>
            
            <div style="margin-bottom: 25px;">
                <h4 style="font-size: 16px; font-weight: 700; color: #1a1f2e; margin-bottom: 15px;">
                    üì¶ Items del Remito
                </h4>
                <div style="border: 2px solid #f3f4f6; border-radius: 12px; overflow: hidden;">
                    <table>
                        <thead style="background: #f8f9fa;">
                            <tr>
                                <th>C√≥digo</th>
                                <th>Producto</th>
                                <th>Marca</th>
                                <th style="text-align: center;">Cantidad</th>
                                <th style="text-align: right;">Precio Unit.</th>
                                <th style="text-align: right;">Subtotal</th>
                            </tr>
                        </thead>
                        <tbody id="detalleRemitoItems">
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div style="background: #1e293b; padding: 25px; border-radius: 12px; text-align: right; margin-bottom: 25px;">
                <div style="font-size: 14px; color: #94a3b8; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                    TOTAL
                </div>
                <div style="font-size: 36px; font-weight: 800; color: #ff6b35;" id="detalleRemitoTotal">
                    $0
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end;">
                <button class="btn-primary" onclick="cerrarModalDetalle()">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- Modal Formulario Cliente -->
    <div id="modalFormularioCliente" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow: hidden; display: flex; flex-direction: column;">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 700;" id="tituloFormCliente">
                üë§ Nuevo Cliente
            </h3>
            
            <input type="hidden" id="clienteIdEdit">
            
            <div style="display: flex; gap: 20px; flex: 1; overflow: hidden;">
                <!-- Men√∫ lateral de pesta√±as -->
                <div style="width: 200px; flex-shrink: 0;">
                    <div class="tab-producto active" onclick="cambiarTabCliente('general')" data-tab="general">
                        <span style="font-size: 18px;">üìã</span>
                        <span>DATOS GENERALES</span>
                    </div>
                    <div class="tab-producto" onclick="cambiarTabCliente('contacto')" data-tab="contacto">
                        <span style="font-size: 18px;">üìû</span>
                        <span>CONTACTO</span>
                    </div>
                    <div class="tab-producto" onclick="cambiarTabCliente('ventas')" data-tab="ventas">
                        <span style="font-size: 18px;">üí∞</span>
                        <span>VENTAS</span>
                    </div>
                    <div class="tab-producto" onclick="cambiarTabCliente('autorizados')" data-tab="autorizados">
                        <span style="font-size: 18px;">üë•</span>
                        <span>AUTORIZADOS</span>
                    </div>
                </div>
                
                <!-- Contenido de las pesta√±as -->
                <div style="flex: 1; overflow-y: auto; padding-right: 10px;">
                    <!-- DATOS GENERALES -->
                    <div id="tab-cliente-general" class="tab-content-producto active">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üìã DATOS GENERALES</h4>
                        
                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    CUIT / CUIL *
                                </label>
                                <input type="text" id="clienteCuit" class="input-field" placeholder="20-12345678-9" 
                                    style="margin: 0;" onblur="buscarDatosCUIT()">
                            </div>
                            <button class="btn-primary" onclick="buscarDatosCUIT()" style="margin-top: 28px; padding: 12px 20px; white-space: nowrap;">
                                üîç Buscar
                            </button>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                NOMBRE / RAZ√ìN SOCIAL *
                            </label>
                            <input type="text" id="clienteNombre" class="input-field" placeholder="Ej: Juan P√©rez o Construcciones SA" style="margin: 0;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    TIPO DE CLIENTE *
                                </label>
                                <select id="clienteTipo" class="input-field" style="margin: 0;">
                                    <option value="Consumidor Final">Consumidor Final</option>
                                    <option value="Monotributista">Monotributista</option>
                                    <option value="Responsable Inscripto">Responsable Inscripto</option>
                                    <option value="Exento">Exento</option>
                                </select>
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    CONDICI√ìN DE VENTA *
                                </label>
                                <select id="clienteCondicion" class="input-field" style="margin: 0;" onchange="toggleLimiteCredito()">
                                    <option value="Contado">Contado</option>
                                    <option value="Cuenta Corriente">Cuenta Corriente</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                DIRECCI√ìN
                            </label>
                            <input type="text" id="clienteDireccion" class="input-field" placeholder="Av. Col√≥n 1234, C√≥rdoba" style="margin: 0;">
                        </div>
                    </div>
                    
                    <!-- CONTACTO -->
                    <div id="tab-cliente-contacto" class="tab-content-producto">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üìû INFORMACI√ìN DE CONTACTO</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    TEL√âFONO *
                                </label>
                                <input type="text" id="clienteTelefono" class="input-field" placeholder="3516789012" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    WHATSAPP *
                                </label>
                                <input type="text" id="clienteWhatsapp" class="input-field" placeholder="3516789012" style="margin: 0;">
                            </div>
                            
                            <div style="grid-column: 1 / -1;">
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    EMAIL (para enviar comprobantes) *
                                </label>
                                <input type="email" id="clienteEmail" class="input-field" placeholder="cliente@email.com" style="margin: 0;">
                            </div>
                        </div>
                        
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-top: 20px;">
                            <div style="font-size: 12px; color: #6b7280; margin-bottom: 10px;">
                                üí° <strong>Importante:</strong> Los comprobantes se enviar√°n autom√°ticamente al email y WhatsApp registrados.
                            </div>
                        </div>
                    </div>
                    
                    <!-- VENTAS -->
                    <div id="tab-cliente-ventas" class="tab-content-producto">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üí∞ CONDICIONES DE VENTA</h4>
                        
                        <div id="divLimiteCreditoVentas" style="display: none; margin-bottom: 15px;">
                            <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                L√çMITE DE CR√âDITO ($)
                            </label>
                            <input type="number" id="clienteLimiteCredito" class="input-field" placeholder="0" value="0" style="margin: 0;">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    DESCUENTO ESPECIAL (%)
                                </label>
                                <input type="number" id="clienteDescuento" class="input-field" placeholder="0" value="0" min="0" max="100" style="margin: 0;">
                            </div>
                            
                            <div>
                                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                    LISTA DE PRECIOS ESPECIAL
                                </label>
                                <select id="clienteListaPrecios" class="input-field" style="margin: 0;">
                                    <option value="">Sin lista especial</option>
                                    <option value="Lista Mayorista">Lista Mayorista</option>
                                    <option value="Lista Constructoras">Lista Constructoras</option>
                                    <option value="Lista Electricistas">Lista Electricistas</option>
                                    <option value="Lista VIP">Lista VIP</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style="background: #fff7f5; border: 2px solid #ff6b35; padding: 20px; border-radius: 12px; margin-top: 20px;">
                            <div style="font-weight: 600; margin-bottom: 10px; color: #1a1f2e;">
                                üìä Condiciones aplicadas:
                            </div>
                            <div style="font-size: 14px; color: #6b7280;">
                                ‚Ä¢ El descuento se aplicar√° autom√°ticamente en cada venta<br>
                                ‚Ä¢ La lista de precios especial reemplaza los precios est√°ndar<br>
                                ‚Ä¢ Estas condiciones son visibles para el vendedor al realizar la venta
                            </div>
                        </div>
                    </div>
                    
                    <!-- AUTORIZADOS -->
                    <div id="tab-cliente-autorizados" class="tab-content-producto">
                        <h4 style="margin-bottom: 20px; color: #ff6b35;">üë• PERSONAS AUTORIZADAS A COMPRAR</h4>
                        
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                            <div style="font-size: 13px; color: #6b7280; margin-bottom: 15px;">
                                Registr√° las personas autorizadas a realizar compras a nombre de este cliente.
                            </div>
                            <button class="btn-primary" onclick="agregarAutorizado()">+ Agregar Autorizado</button>
                        </div>
                        
                        <div id="listaAutorizados">
                            <p style="text-align: center; padding: 40px; color: #999;">
                                No hay personas autorizadas registradas
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botones de acci√≥n -->
            <div style="border-top: 2px solid #f3f4f6; padding-top: 20px; margin-top: 20px; display: flex; justify-content: space-between; align-items: center;">
                <div id="btnCuentaCorriente" style="display: none;">
                    <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);" 
                        onclick="irACuentaCorriente()">
                        üìä Ver Cuenta Corriente
                    </button>
                </div>
                <div style="flex: 1;"></div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn-primary" style="background: #6b7280;" onclick="cerrarFormularioCliente()">CANCELAR</button>
                    <button class="btn-primary" onclick="guardarCliente()">üíæ GUARDAR</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Detalle Cliente -->
    <div id="modalDetalleCliente" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 30px;">
                <div>
                    <h3 style="font-size: 28px; font-weight: 700; color: #1a1f2e; margin-bottom: 10px;" id="detalleClienteNombre">
                        Cliente
                    </h3>
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <span id="detalleClienteTipo"></span>
                        <span id="detalleClienteCondicion"></span>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">
                        SALDO ACTUAL
                    </div>
                    <div id="detalleClienteSaldo"></div>
                </div>
            </div>
            
            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 30px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                    <div style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        üìã CUIT
                    </div>
                    <div style="font-size: 16px; font-weight: 600;" id="detalleClienteCuit"></div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                    <div style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        üìû TEL√âFONO
                    </div>
                    <div style="font-size: 16px; font-weight: 600;" id="detalleClienteTelefono"></div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px;">
                    <div style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        üí∞ L√çMITE CR√âDITO
                    </div>
                    <div style="font-size: 16px; font-weight: 600;" id="detalleClienteLimite"></div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; grid-column: 1 / -1;">
                    <div style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        ‚úâÔ∏è EMAIL
                    </div>
                    <div style="font-size: 16px; font-weight: 600;" id="detalleClienteEmail"></div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; grid-column: 1 / -1;">
                    <div style="font-size: 11px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px;">
                        üìç DIRECCI√ìN
                    </div>
                    <div style="font-size: 16px; font-weight: 600;" id="detalleClienteDireccion"></div>
                </div>
            </div>
            
            <div style="margin-bottom: 25px;">
                <h4 style="font-size: 18px; font-weight: 700; color: #1a1f2e; margin-bottom: 15px;">
                    üìä Historial de Compras
                </h4>
                <div style="border: 2px solid #f3f4f6; border-radius: 12px; overflow: hidden;">
                    <table>
                        <thead style="background: #f8f9fa;">
                            <tr>
                                <th>Fecha</th>
                                <th>Tipo</th>
                                <th>Nro. Comprobante</th>
                                <th>Total</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="detalleClienteHistorial">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px; color: #999;">
                                    No hay compras registradas
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-primary" style="background: #6b7280;" onclick="cerrarModalDetalleCliente()">Cerrar</button>
                <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);" 
                    onclick="cerrarModalDetalleCliente(); abrirCuentaCorriente(parseInt(document.getElementById('detalleClienteNombre').dataset.clienteId))" 
                    id="btnDetalleCuentaCorriente">
                    üìä Ver Cuenta Corriente
                </button>
                <button class="btn-primary" onclick="cerrarModalDetalleCliente(); editarCliente(parseInt(document.getElementById('detalleClienteNombre').dataset.clienteId))">
                    ‚úèÔ∏è Editar Cliente
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Cuenta Corriente -->
    <div id="modalCuentaCorriente" class="modal">
        <div class="modal-content" style="max-width: 1100px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <div>
                    <h3 style="font-size: 28px; font-weight: 700; color: #1a1f2e; margin-bottom: 5px;">
                        üìä Cuenta Corriente
                    </h3>
                    <div style="font-size: 18px; font-weight: 600; color: #6b7280;" id="ctaCtteClienteNombre">
                        Cliente
                    </div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 12px; color: #6b7280; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;">
                        SALDO ACTUAL
                    </div>
                    <div id="ctaCtteSaldo" style="font-size: 36px; font-weight: 800;">
                        $0
                    </div>
                </div>
            </div>
            
            <!-- Botones de acciones r√°pidas -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button class="btn-primary" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);" onclick="abrirModalMovimiento('recibo')">
                    üßæ Nuevo Recibo
                </button>
                <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);" onclick="abrirModalMovimiento('nota-credito')">
                    üìò Nota de Cr√©dito
                </button>
                <button class="btn-primary" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);" onclick="abrirModalMovimiento('nota-debito')">
                    üìï Nota de D√©bito
                </button>
                <button class="btn-primary" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);" onclick="abrirModalMovimiento('ajuste')">
                    ‚öôÔ∏è Ajuste Manual
                </button>
            </div>
            
            <div style="border: 2px solid #f3f4f6; border-radius: 12px; overflow: hidden; margin-bottom: 25px;">
                <table>
                    <thead style="background: #f8f9fa;">
                        <tr>
                            <th>Fecha</th>
                            <th>Tipo</th>
                            <th>Nro. Comprobante</th>
                            <th>Detalle</th>
                            <th style="text-align: right;">Debe</th>
                            <th style="text-align: right;">Haber</th>
                            <th style="text-align: right;">Saldo</th>
                            <th style="text-align: center;">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="tablaCtaCorriente">
                        <tr>
                            <td colspan="8" style="text-align: center; padding: 40px; color: #999;">
                                No hay movimientos
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div style="display: flex; justify-content: flex-end; gap: 10px;">
                <button class="btn-primary" style="background: #6b7280;" onclick="cerrarCuentaCorriente()">Cerrar</button>
                <button class="btn-primary" onclick="alert('Funcionalidad de exportar PDF pr√≥ximamente')">
                    üìÑ Exportar PDF
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Movimiento -->
    <div id="modalNuevoMovimiento" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 700;" id="tituloMovimiento">
                üßæ Nuevo Movimiento
            </h3>
            
            <input type="hidden" id="movTipoOperacion">
            <input type="hidden" id="movClienteId">
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div>
                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                        FECHA *
                    </label>
                    <input type="date" id="movFecha" class="input-field" style="margin: 0;">
                </div>
                
                <div>
                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                        MONTO ($) *
                    </label>
                    <input type="number" id="movMonto" class="input-field" placeholder="0.00" step="any" style="margin: 0;" oninput="actualizarSaldoResultante()">
                </div>
                
                <div style="grid-column: 1 / -1;">
                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                        DETALLE / OBSERVACIONES *
                    </label>
                    <textarea id="movDetalle" class="input-field" rows="3" placeholder="Ej: Pago efectivo" style="margin: 0; resize: vertical;"></textarea>
                </div>
                
                <div id="divFormaPago" style="grid-column: 1 / -1; display: none;">
                    <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                        FORMA DE PAGO
                    </label>
                    <select id="movFormaPago" class="input-field" style="margin: 0;">
                        <option value="Efectivo">Efectivo</option>
                        <option value="Transferencia">Transferencia</option>
                        <option value="Cheque">Cheque</option>
                        <option value="Tarjeta">Tarjeta</option>
                        <option value="Mercado Pago">Mercado Pago</option>
                        <option value="Otro">Otro</option>
                    </select>
                </div>
            </div>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-top: 20px;">
                <div style="font-size: 13px; color: #6b7280; margin-bottom: 10px;" id="infoMovimiento">
                    Este movimiento afectar√° el saldo del cliente
                </div>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span style="font-weight: 600; font-size: 16px;">Saldo resultante:</span>
                    <span id="saldoResultante" style="font-weight: 800; font-size: 20px; color: #ff6b35;">$0</span>
                </div>
            </div>
            
            <div style="margin-top: 25px; display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn-primary" style="background: #6b7280;" onclick="cerrarModalMovimiento()">Cancelar</button>
                <button class="btn-primary" onclick="guardarMovimiento()">üíæ Guardar Movimiento</button>
            </div>
        </div>
    </div>

    <!-- Modal Configuraci√≥n Comprobante -->
    <div id="modalConfigComprobante" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 700;" id="tituloConfigComprobante">
                üñ®Ô∏è Configurar Comprobante
            </h3>
            
            <input type="hidden" id="comprobanteIdEdit">
            
            <!-- INFORMACI√ìN B√ÅSICA -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h5 style="font-weight: 700; margin-bottom: 15px; color: #1a1f2e;">üìÑ Informaci√≥n B√°sica</h5>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                    <div>
                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                            IMPRESORA
                        </label>
                        <select id="compImpresora" class="input-field" style="margin: 0;">
                            <option>Microsoft Print to PDF</option>
                            <option>Impresora T√©rmica</option>
                            <option>Impresora L√°ser</option>
                            <option>Impresora Matricial</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                            TAMA√ëO DE PAPEL
                        </label>
                        <select id="compTamanioPapel" class="input-field" style="margin: 0;">
                            <option>A4 (210 x 297 mm)</option>
                            <option>Ticket 80mm</option>
                            <option>Ticket 58mm</option>
                            <option>Carta (216 x 279 mm)</option>
                            <option>Medio Oficio</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                            ORIENTACI√ìN
                        </label>
                        <select id="compOrientacion" class="input-field" style="margin: 0;">
                            <option value="vertical">Vertical (Portrait)</option>
                            <option value="horizontal">Horizontal (Landscape)</option>
                        </select>
                    </div>
                    
                    <div>
                        <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                            CANTIDAD DE COPIAS
                        </label>
                        <input type="number" id="compCopias" class="input-field" min="1" max="5" value="1" style="margin: 0;">
                    </div>
                </div>
            </div>
            
            <!-- INFORMACI√ìN A INCLUIR -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h5 style="font-weight: 700; margin-bottom: 15px; color: #1a1f2e;">üìã Informaci√≥n a Incluir</h5>
                
                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: white; border-radius: 8px;">
                        <input type="checkbox" id="compIncluirLogo" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600;">üì∑ Logo de la empresa</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: white; border-radius: 8px;">
                        <input type="checkbox" id="compIncluirQR" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600;">üì± C√≥digo QR</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: white; border-radius: 8px;">
                        <input type="checkbox" id="compIncluirCAE" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600;">üîê CAE (AFIP)</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: white; border-radius: 8px;">
                        <input type="checkbox" id="compIncluirDetalleItems" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600;">üìã Detalle de items</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: white; border-radius: 8px;">
                        <input type="checkbox" id="compIncluirObservaciones" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600;">üí¨ Observaciones</span>
                    </label>
                    
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; padding: 10px; background: white; border-radius: 8px;">
                        <input type="checkbox" id="compAbrirCajon" style="width: 20px; height: 20px; cursor: pointer;">
                        <span style="font-weight: 600;">üí∞ Abrir caj√≥n</span>
                    </label>
                </div>
            </div>
            
            <!-- VISTA PREVIA -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h5 style="font-weight: 700; margin-bottom: 15px; color: #1a1f2e;">üëÅÔ∏è Vista Previa</h5>
                <div style="background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 30px; min-height: 200px; text-align: center; color: #6b7280;">
                    <div style="font-size: 48px; margin-bottom: 10px;">üìÑ</div>
                    <div style="font-size: 14px;">Vista previa del comprobante aparecer√° aqu√≠</div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn-primary" style="background: #6b7280;" onclick="cerrarModalConfigComprobante()">Cancelar</button>
                <button class="btn-primary" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);" onclick="imprimirPruebaComprobante()">
                    üñ®Ô∏è Imprimir Prueba
                </button>
                <button class="btn-primary" onclick="guardarConfigComprobante()">üíæ Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Forma de Pago -->
    <div id="modalFormaPago" class="modal">
        <div class="modal-content" style="max-width: 700px;">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 700;" id="tituloFormaPago">
                üí≥ Nueva Forma de Pago
            </h3>
            
            <input type="hidden" id="formaPagoIdEdit">
            
            <div style="margin-bottom: 20px;">
                <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                    NOMBRE DE LA FORMA DE PAGO *
                </label>
                <input type="text" id="formaPagoNombre" class="input-field" placeholder="Ej: Efectivo, Tarjeta Cr√©dito, etc." style="margin: 0;">
            </div>
            
            <!-- RECARGO -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 15px; color: #1a1f2e;">
                    üí∞ Configuraci√≥n de Recargo
                </h4>
                
                <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="formaPagoTieneRecargo" onchange="toggleRecargoConfig()" 
                        style="width: 20px; height: 20px; cursor: pointer;">
                    <span style="font-weight: 600;">Esta forma de pago tiene recargo</span>
                </label>
                
                <div id="divRecargoConfig" style="display: none;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                TIPO DE RECARGO
                            </label>
                            <select id="formaPagoTipoRecargo" class="input-field" style="margin: 0;">
                                <option value="porcentaje">Porcentaje (%)</option>
                                <option value="fijo">Monto Fijo ($)</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="font-size: 11px; color: #94a3b8; text-transform: uppercase; font-weight: 600; display: block; margin-bottom: 5px;">
                                VALOR DEL RECARGO
                            </label>
                            <input type="number" id="formaPagoRecargo" class="input-field" placeholder="0" step="any" style="margin: 0;">
                        </div>
                    </div>
                    
                    <div style="background: #fff7f5; padding: 12px; border-radius: 8px; margin-top: 10px; font-size: 13px; color: #6b7280;">
                        üí° Ejemplo: Venta de $10,000 con 5% de recargo = Total $10,500
                    </div>
                </div>
            </div>
            
            <!-- CUOTAS -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h4 style="font-size: 16px; font-weight: 700; margin-bottom: 15px; color: #1a1f2e;">
                    üî¢ Planes de Cuotas Internas
                </h4>
                
                <label style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px; cursor: pointer;">
                    <input type="checkbox" id="formaPagoPermiteCuotas" onchange="toggleCuotasConfig()" 
                        style="width: 20px; height: 20px; cursor: pointer;">
                    <span style="font-weight: 600;">Esta forma de pago permite cuotas</span>
                </label>
                
                <div id="divCuotasConfig" style="display: none;">
                    <button class="btn-primary" onclick="agregarPlanCuota()" style="margin-bottom: 15px; width: 100%;">
                        + Agregar Plan de Cuotas
                    </button>
                    
                    <div id="listaCuotas">
                        <p style="text-align: center; padding: 20px; color: #999; font-size: 13px;">
                            No hay planes de cuotas configurados
                        </p>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn-primary" style="background: #6b7280;" onclick="cerrarModalFormaPago()">Cancelar</button>
                <button class="btn-primary" onclick="guardarFormaPago()">üíæ Guardar</button>
            </div>
        </div>
    </div>

    <!-- Modal Conversi√≥n Remitos a Factura -->
    <div id="modalConversionFactura" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h3 style="margin-bottom: 25px; font-size: 24px; font-weight: 700; color: #1a1f2e;">
                üìÑ Convertir Remitos a Factura
            </h3>
            
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                <div style="font-size: 14px; color: #6b7280; margin-bottom: 10px;">
                    Remitos seleccionados:
                </div>
                <div style="font-size: 24px; font-weight: 700; color: #ff6b35;" id="cantidadRemitosModal">
                    0 remitos
                </div>
            </div>
            
            <div style="margin-bottom: 30px;">
                <h4 style="margin-bottom: 15px; font-size: 16px; font-weight: 600; color: #1a1f2e;">
                    ¬øC√≥mo quer√©s manejar los precios?
                </h4>
                
                <div style="display: flex; flex-direction: column; gap: 15px;">
                    <div class="opcion-precio" onclick="seleccionarOpcionPrecio('mantener')" data-opcion="mantener">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="radio-custom">
                                <input type="radio" name="opcionPrecio" value="mantener" id="radioMantener">
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 15px; margin-bottom: 5px;">
                                    üíæ Mantener precios del remito
                                </div>
                                <div style="font-size: 13px; color: #6b7280;">
                                    La factura se generar√° con los precios originales del remito
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="opcion-precio" onclick="seleccionarOpcionPrecio('actualizar')" data-opcion="actualizar">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <div class="radio-custom">
                                <input type="radio" name="opcionPrecio" value="actualizar" id="radioActualizar">
                            </div>
                            <div>
                                <div style="font-weight: 600; font-size: 15px; margin-bottom: 5px;">
                                    üîÑ Actualizar a precio actual
                                </div>
                                <div style="font-size: 13px; color: #6b7280;">
                                    La factura se generar√° con los precios actuales de los productos
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button class="btn-primary" style="background: #6b7280;" onclick="cerrarModalConversion()">
                    Cancelar
                </button>
                <button class="btn-primary" id="btnConfirmarConversion" onclick="confirmarConversion()" disabled 
                    style="opacity: 0.5; cursor: not-allowed;">
                    ‚úÖ Confirmar Conversi√≥n
                </button>
            </div>
        </div>
    </div>
</body>
</html>
